253a3e8f891a2dddc1b4243babe3a63a
"use strict";

function _typeof(obj) {
  "@babel/helpers - typeof";

  return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {
    return typeof obj;
  } : function (obj) {
    return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
  }, _typeof(obj);
}

exports.__esModule = true;
exports.setoidTrait = exports.semigroupTrait = exports.ordTrait = exports.functorTrait = exports.chainTrait = exports.applyTrait = void 0;

var _ramda = require("ramda");

var _isString = _interopRequireDefault(require("../isString"));

var _isNumber = _interopRequireDefault(require("../isNumber"));

var _isFunction = _interopRequireDefault(require("../isFunction"));

var _util = require("./util");

var fl = _interopRequireWildcard(require("./mapping"));

function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== "function") return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}

function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") {
    return {
      "default": obj
    };
  }

  var cache = _getRequireWildcardCache(nodeInterop);

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj["default"] = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    "default": obj
  };
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

var functorTrait = _defineProperty({}, fl.map, function (fn) {
  return this.constructor[fl.of](fn(this.value));
});

exports.functorTrait = functorTrait;

var applyTrait = _defineProperty({}, fl.ap, function (applyWithFn) {
  var _this = this;

  return applyWithFn.map(function (fn) {
    return fn(_this.value);
  });
});

exports.applyTrait = applyTrait;

var setoidTrait = _defineProperty({}, fl.equals, function (setoid) {
  return (0, _util.isSameType)(this, setoid) && (0, _ramda.equals)(this.value, setoid.value);
});

exports.setoidTrait = setoidTrait;

var semigroupTrait = _defineProperty({}, fl.concat, function (semigroup) {
  var concatenatedValue = this.value;

  if ((0, _isString["default"])(this.value) || (0, _isNumber["default"])(this.value)) {
    concatenatedValue = this.value + semigroup.value;
  } else if ((0, _ramda.pathSatisfies)(_isFunction["default"], ['value', fl.concat], this)) {
    concatenatedValue = this.value[fl.concat](semigroup.value);
  } else if ((0, _ramda.pathSatisfies)(_isFunction["default"], ['value', 'concat'], this)) {
    concatenatedValue = this.value.concat(semigroup.value);
  }

  return this.constructor[fl.of](concatenatedValue);
});

exports.semigroupTrait = semigroupTrait;

var chainTrait = _defineProperty({}, fl.chain, function (fn) {
  var newChain = fn(this.value);
  return (0, _util.isSameType)(this, newChain) ? newChain : this;
});

exports.chainTrait = chainTrait;

var ordTrait = _defineProperty({}, fl.lte, function (ord) {
  return (0, _util.isSameType)(this, ord) && (this.value < ord.value || this[fl.equals](ord));
});

exports.ordTrait = ordTrait;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYWl0cy5qcyJdLCJuYW1lcyI6WyJfdHlwZW9mIiwib2JqIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJjb25zdHJ1Y3RvciIsInByb3RvdHlwZSIsImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwic2V0b2lkVHJhaXQiLCJzZW1pZ3JvdXBUcmFpdCIsIm9yZFRyYWl0IiwiZnVuY3RvclRyYWl0IiwiY2hhaW5UcmFpdCIsImFwcGx5VHJhaXQiLCJfcmFtZGEiLCJyZXF1aXJlIiwiX2lzU3RyaW5nIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9pc051bWJlciIsIl9pc0Z1bmN0aW9uIiwiX3V0aWwiLCJmbCIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlIiwibm9kZUludGVyb3AiLCJXZWFrTWFwIiwiY2FjaGVCYWJlbEludGVyb3AiLCJjYWNoZU5vZGVJbnRlcm9wIiwiY2FjaGUiLCJoYXMiLCJnZXQiLCJuZXdPYmoiLCJoYXNQcm9wZXJ0eURlc2NyaXB0b3IiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImtleSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImRlc2MiLCJzZXQiLCJfZGVmaW5lUHJvcGVydHkiLCJ2YWx1ZSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIm1hcCIsImZuIiwib2YiLCJhcCIsImFwcGx5V2l0aEZuIiwiX3RoaXMiLCJlcXVhbHMiLCJzZXRvaWQiLCJpc1NhbWVUeXBlIiwiY29uY2F0Iiwic2VtaWdyb3VwIiwiY29uY2F0ZW5hdGVkVmFsdWUiLCJwYXRoU2F0aXNmaWVzIiwiY2hhaW4iLCJuZXdDaGFpbiIsImx0ZSIsIm9yZCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsU0FBU0EsT0FBVCxDQUFpQkMsR0FBakIsRUFBc0I7QUFBRTs7QUFBMkIsU0FBT0QsT0FBTyxHQUFHLGNBQWMsT0FBT0UsTUFBckIs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VUFBVSxHQUFHNkIsZUFBZSxDQUFDLEVBQUQsRUFBS3BCLEVBQUUsQ0FBQ3NDLEtBQVIsRUFBZSxVQUFVWixFQUFWLEVBQWM7QUFDM0QsTUFBSWEsUUFBUSxHQUFHYixFQUFFLENBQUMsS0FBS0wsS0FBTixDQUFqQjtBQUNBLFNBQU8sQ0FBQyxHQUFHdEIsS0FBSyxDQUFDa0MsVUFBVixFQUFzQixJQUF0QixFQUE0Qk0sUUFBNUIsSUFBd0NBLFFBQXhDLEdBQW1ELElBQTFEO0FBQ0QsQ0FIK0IsQ0FBaEM7O0FBS0F0RCxPQUFPLENBQUNNLFVBQVIsR0FBcUJBLFVBQXJCOztBQUVBLElBQUlGLFFBQVEsR0FBRytCLGVBQWUsQ0FBQyxFQUFELEVBQUtwQixFQUFFLENBQUN3QyxHQUFSLEVBQWEsVUFBVUMsR0FBVixFQUFlO0FBQ3hELFNBQU8sQ0FBQyxHQUFHMUMsS0FBSyxDQUFDa0MsVUFBVixFQUFzQixJQUF0QixFQUE0QlEsR0FBNUIsTUFBcUMsS0FBS3BCLEtBQUwsR0FBYW9CLEdBQUcsQ0FBQ3BCLEtBQWpCLElBQTBCLEtBQUtyQixFQUFFLENBQUMrQixNQUFSLEVBQWdCVSxHQUFoQixDQUEvRCxDQUFQO0FBQ0QsQ0FGNkIsQ0FBOUI7O0FBSUF4RCxPQUFPLENBQUNJLFFBQVIsR0FBbUJBLFFBQW5CIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IFwiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2ZcIjsgcmV0dXJuIF90eXBlb2YgPSBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIFN5bWJvbCAmJiBcInN5bWJvbFwiID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgU3ltYm9sICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9LCBfdHlwZW9mKG9iaik7IH1cblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuc2V0b2lkVHJhaXQgPSBleHBvcnRzLnNlbWlncm91cFRyYWl0ID0gZXhwb3J0cy5vcmRUcmFpdCA9IGV4cG9ydHMuZnVuY3RvclRyYWl0ID0gZXhwb3J0cy5jaGFpblRyYWl0ID0gZXhwb3J0cy5hcHBseVRyYWl0ID0gdm9pZCAwO1xuXG52YXIgX3JhbWRhID0gcmVxdWlyZShcInJhbWRhXCIpO1xuXG52YXIgX2lzU3RyaW5nID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vaXNTdHJpbmdcIikpO1xuXG52YXIgX2lzTnVtYmVyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vaXNOdW1iZXJcIikpO1xuXG52YXIgX2lzRnVuY3Rpb24gPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi9pc0Z1bmN0aW9uXCIpKTtcblxudmFyIF91dGlsID0gcmVxdWlyZShcIi4vdXRpbFwiKTtcblxudmFyIGZsID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZShcIi4vbWFwcGluZ1wiKSk7XG5cbmZ1bmN0aW9uIF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZShub2RlSW50ZXJvcCkgeyBpZiAodHlwZW9mIFdlYWtNYXAgIT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIG51bGw7IHZhciBjYWNoZUJhYmVsSW50ZXJvcCA9IG5ldyBXZWFrTWFwKCk7IHZhciBjYWNoZU5vZGVJbnRlcm9wID0gbmV3IFdlYWtNYXAoKTsgcmV0dXJuIChfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUgPSBmdW5jdGlvbiBfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUobm9kZUludGVyb3ApIHsgcmV0dXJuIG5vZGVJbnRlcm9wID8gY2FjaGVOb2RlSW50ZXJvcCA6IGNhY2hlQmFiZWxJbnRlcm9wOyB9KShub2RlSW50ZXJvcCk7IH1cblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqLCBub2RlSW50ZXJvcCkgeyBpZiAoIW5vZGVJbnRlcm9wICYmIG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGlmIChvYmogPT09IG51bGwgfHwgX3R5cGVvZihvYmopICE9PSBcIm9iamVjdFwiICYmIHR5cGVvZiBvYmogIT09IFwiZnVuY3Rpb25cIikgeyByZXR1cm4geyBcImRlZmF1bHRcIjogb2JqIH07IH0gdmFyIGNhY2hlID0gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKG5vZGVJbnRlcm9wKTsgaWYgKGNhY2hlICYmIGNhY2hlLmhhcyhvYmopKSB7IHJldHVybiBjYWNoZS5nZXQob2JqKTsgfSB2YXIgbmV3T2JqID0ge307IHZhciBoYXNQcm9wZXJ0eURlc2NyaXB0b3IgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsgZm9yICh2YXIga2V5IGluIG9iaikgeyBpZiAoa2V5ICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gaGFzUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiBudWxsOyBpZiAoZGVzYyAmJiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7IH0gZWxzZSB7IG5ld09ialtrZXldID0gb2JqW2tleV07IH0gfSB9IG5ld09ialtcImRlZmF1bHRcIl0gPSBvYmo7IGlmIChjYWNoZSkgeyBjYWNoZS5zZXQob2JqLCBuZXdPYmopOyB9IHJldHVybiBuZXdPYmo7IH1cblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgXCJkZWZhdWx0XCI6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9XG5cbnZhciBmdW5jdG9yVHJhaXQgPSBfZGVmaW5lUHJvcGVydHkoe30sIGZsLm1hcCwgZnVuY3Rpb24gKGZuKSB7XG4gIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yW2ZsLm9mXShmbih0aGlzLnZhbHVlKSk7XG59KTtcblxuZXhwb3J0cy5mdW5jdG9yVHJhaXQgPSBmdW5jdG9yVHJhaXQ7XG5cbnZhciBhcHBseVRyYWl0ID0gX2RlZmluZVByb3BlcnR5KHt9LCBmbC5hcCwgZnVuY3Rpb24gKGFwcGx5V2l0aEZuKSB7XG4gIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgcmV0dXJuIGFwcGx5V2l0aEZuLm1hcChmdW5jdGlvbiAoZm4pIHtcbiAgICByZXR1cm4gZm4oX3RoaXMudmFsdWUpO1xuICB9KTtcbn0pO1xuXG5leHBvcnRzLmFwcGx5VHJhaXQgPSBhcHBseVRyYWl0O1xuXG52YXIgc2V0b2lkVHJhaXQgPSBfZGVmaW5lUHJvcGVydHkoe30sIGZsLmVxdWFscywgZnVuY3Rpb24gKHNldG9pZCkge1xuICByZXR1cm4gKDAsIF91dGlsLmlzU2FtZVR5cGUpKHRoaXMsIHNldG9pZCkgJiYgKDAsIF9yYW1kYS5lcXVhbHMpKHRoaXMudmFsdWUsIHNldG9pZC52YWx1ZSk7XG59KTtcblxuZXhwb3J0cy5zZXRvaWRUcmFpdCA9IHNldG9pZFRyYWl0O1xuXG52YXIgc2VtaWdyb3VwVHJhaXQgPSBfZGVmaW5lUHJvcGVydHkoe30sIGZsLmNvbmNhdCwgZnVuY3Rpb24gKHNlbWlncm91cCkge1xuICB2YXIgY29uY2F0ZW5hdGVkVmFsdWUgPSB0aGlzLnZhbHVlO1xuXG4gIGlmICgoMCwgX2lzU3RyaW5nW1wiZGVmYXVsdFwiXSkodGhpcy52YWx1ZSkgfHwgKDAsIF9pc051bWJlcltcImRlZmF1bHRcIl0pKHRoaXMudmFsdWUpKSB7XG4gICAgY29uY2F0ZW5hdGVkVmFsdWUgPSB0aGlzLnZhbHVlICsgc2VtaWdyb3VwLnZhbHVlO1xuICB9IGVsc2UgaWYgKCgwLCBfcmFtZGEucGF0aFNhdGlzZmllcykoX2lzRnVuY3Rpb25bXCJkZWZhdWx0XCJdLCBbJ3ZhbHVlJywgZmwuY29uY2F0XSwgdGhpcykpIHtcbiAgICBjb25jYXRlbmF0ZWRWYWx1ZSA9IHRoaXMudmFsdWVbZmwuY29uY2F0XShzZW1pZ3JvdXAudmFsdWUpO1xuICB9IGVsc2UgaWYgKCgwLCBfcmFtZGEucGF0aFNhdGlzZmllcykoX2lzRnVuY3Rpb25bXCJkZWZhdWx0XCJdLCBbJ3ZhbHVlJywgJ2NvbmNhdCddLCB0aGlzKSkge1xuICAgIGNvbmNhdGVuYXRlZFZhbHVlID0gdGhpcy52YWx1ZS5jb25jYXQoc2VtaWdyb3VwLnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yW2ZsLm9mXShjb25jYXRlbmF0ZWRWYWx1ZSk7XG59KTtcblxuZXhwb3J0cy5zZW1pZ3JvdXBUcmFpdCA9IHNlbWlncm91cFRyYWl0O1xuXG52YXIgY2hhaW5UcmFpdCA9IF9kZWZpbmVQcm9wZXJ0eSh7fSwgZmwuY2hhaW4sIGZ1bmN0aW9uIChmbikge1xuICB2YXIgbmV3Q2hhaW4gPSBmbih0aGlzLnZhbHVlKTtcbiAgcmV0dXJuICgwLCBfdXRpbC5pc1NhbWVUeXBlKSh0aGlzLCBuZXdDaGFpbikgPyBuZXdDaGFpbiA6IHRoaXM7XG59KTtcblxuZXhwb3J0cy5jaGFpblRyYWl0ID0gY2hhaW5UcmFpdDtcblxudmFyIG9yZFRyYWl0ID0gX2RlZmluZVByb3BlcnR5KHt9LCBmbC5sdGUsIGZ1bmN0aW9uIChvcmQpIHtcbiAgcmV0dXJuICgwLCBfdXRpbC5pc1NhbWVUeXBlKSh0aGlzLCBvcmQpICYmICh0aGlzLnZhbHVlIDwgb3JkLnZhbHVlIHx8IHRoaXNbZmwuZXF1YWxzXShvcmQpKTtcbn0pO1xuXG5leHBvcnRzLm9yZFRyYWl0ID0gb3JkVHJhaXQ7Il19