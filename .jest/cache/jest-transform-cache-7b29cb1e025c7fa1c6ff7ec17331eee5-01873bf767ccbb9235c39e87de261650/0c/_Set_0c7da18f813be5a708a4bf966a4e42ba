26de4bf8d19f7b99b95c07c978a351df
var _includes = require("./_includes");

var _Set = function () {
  function _Set() {
    this._nativeSet = typeof Set === 'function' ? new Set() : null;
    this._items = {};
  }

  _Set.prototype.add = function (item) {
    return !hasOrAdd(item, true, this);
  };

  _Set.prototype.has = function (item) {
    return hasOrAdd(item, false, this);
  };

  return _Set;
}();

function hasOrAdd(item, shouldAdd, set) {
  var type = typeof item;
  var prevSize, newSize;

  switch (type) {
    case 'string':
    case 'number':
      if (item === 0 && 1 / item === -Infinity) {
        if (set._items['-0']) {
          return true;
        } else {
          if (shouldAdd) {
            set._items['-0'] = true;
          }

          return false;
        }
      }

      if (set._nativeSet !== null) {
        if (shouldAdd) {
          prevSize = set._nativeSet.size;

          set._nativeSet.add(item);

          newSize = set._nativeSet.size;
          return newSize === prevSize;
        } else {
          return set._nativeSet.has(item);
        }
      } else {
        if (!(type in set._items)) {
          if (shouldAdd) {
            set._items[type] = {};
            set._items[type][item] = true;
          }

          return false;
        } else if (item in set._items[type]) {
          return true;
        } else {
          if (shouldAdd) {
            set._items[type][item] = true;
          }

          return false;
        }
      }

    case 'boolean':
      if (type in set._items) {
        var bIdx = item ? 1 : 0;

        if (set._items[type][bIdx]) {
          return true;
        } else {
          if (shouldAdd) {
            set._items[type][bIdx] = true;
          }

          return false;
        }
      } else {
        if (shouldAdd) {
          set._items[type] = item ? [false, true] : [true, false];
        }

        return false;
      }

    case 'function':
      if (set._nativeSet !== null) {
        if (shouldAdd) {
          prevSize = set._nativeSet.size;

          set._nativeSet.add(item);

          newSize = set._nativeSet.size;
          return newSize === prevSize;
        } else {
          return set._nativeSet.has(item);
        }
      } else {
        if (!(type in set._items)) {
          if (shouldAdd) {
            set._items[type] = [item];
          }

          return false;
        }

        if (!_includes(item, set._items[type])) {
          if (shouldAdd) {
            set._items[type].push(item);
          }

          return false;
        }

        return true;
      }

    case 'undefined':
      if (set._items[type]) {
        return true;
      } else {
        if (shouldAdd) {
          set._items[type] = true;
        }

        return false;
      }

    case 'object':
      if (item === null) {
        if (!set._items['null']) {
          if (shouldAdd) {
            set._items['null'] = true;
          }

          return false;
        }

        return true;
      }

    default:
      type = Object.prototype.toString.call(item);

      if (!(type in set._items)) {
        if (shouldAdd) {
          set._items[type] = [item];
        }

        return false;
      }

      if (!_includes(item, set._items[type])) {
        if (shouldAdd) {
          set._items[type].push(item);
        }

        return false;
      }

      return true;
  }
}

module.exports = _Set;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9TZXQuanMiXSwibmFtZXMiOlsiX2luY2x1ZGVzIiwicmVxdWlyZSIsIl9TZXQiLCJfbmF0aXZlU2V0IiwiU2V0IiwiX2l0ZW1zIiwicHJvdG90eXBlIiwiYWRkIiwiaXRlbSIsImhhc09yQWRkIiwiaGFzIiwic2hvdWxkQWRkIiwic2V0IiwidHlwZSIsInByZXZTaXplIiwibmV3U2l6ZSIsIkluZmluaXR5Iiwic2l6ZSIsImJJZHgiLCJwdXNoIiwiT2JqZWN0IiwidG9TdHJpbmciLCJjYWxsIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsU0FBUyxHQUViQyxPQUFPLENBQUMsYUFBRCxDQUZQOztBQUlBLElBQUlDLElBQUksR0FFUixZQUFZO0FBQ1YsV0FBU0EsSUFBVCxHQUFnQjtBQUVkLFNBQUtDLFVBQUwsR0FBa0IsT0FBT0MsR0FBUCxLQUFlLFVBQWYsR0FBNEIsSUFBSUEsR0FBSixFQUE1QixHQUF3QyxJQUExRDtBQUNBLFNBQUtDLE1BQUwsR0FBYyxFQUFkO0FBQ0Q7O0FBTURILEVBQUFBLElBQUksQ0FBQ0ksU0FBTCxDQUFlQyxHQUFmLEdBQXFCLFVBQVVDLElBQVYsRUFBZ0I7QUFDbkMsV0FBTyxDQUFDQyxRQUFRLENBQUNELElBQUQsRUFBTyxJQUFQLEVBQWEsSUFBYixDQUFoQjtBQUNELEdBRkQ7O0FBUUFOLEVBQUFBLElBQUksQ0FBQ0ksU0FBTCxDQUFlSSxHQUFmLEdBQXFCLFVBQVVGLElBQVYsRUFBZ0I7QUFDbkMsV0FBT0MsUUFBUSxDQUFDRCxJQUFELEVBQU8sS0FBUCxFQUFjLElBQWQsQ0FBZjtBQUNELEdBRkQ7O0FBY0EsU0FBT04sSUFBUDtBQUNELENBbENELEVBRkE7O0FBc0NBLFNBQVNPLFFBQVQsQ0FBa0JELElBQWxCLEVBQXdCRyxTQUF4QixFQUFtQ0MsR0FBbkMsRUFBd0M7QUFDdEMsTUFBSUMsSUFBSSxHQUFHLE9BQU9MLElBQWxCO0FBQ0EsTUFBSU0sUUFBSixFQUFjQyxPQUFkOztBQUVB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RUQsZUFBTyxJQUFQO0FBQ0Q7O0FBSUg7QUFHRVEsTUFBQUEsSUFBSSxHQUFHTyxNQUFNLENBQUNkLFNBQVAsQ0FBaUJlLFFBQWpCLENBQTBCQyxJQUExQixDQUErQmQsSUFBL0IsQ0FBUDs7QUFFQSxVQUFJLEVBQUVLLElBQUksSUFBSUQsR0FBRyxDQUFDUCxNQUFkLENBQUosRUFBMkI7QUFDekIsWUFBSU0sU0FBSixFQUFlO0FBQ2JDLFVBQUFBLEdBQUcsQ0FBQ1AsTUFBSixDQUFXUSxJQUFYLElBQW1CLENBQUNMLElBQUQsQ0FBbkI7QUFDRDs7QUFFRCxlQUFPLEtBQVA7QUFDRDs7QUFHRCxVQUFJLENBQUNSLFNBQVMsQ0FBQ1EsSUFBRCxFQUFPSSxHQUFHLENBQUNQLE1BQUosQ0FBV1EsSUFBWCxDQUFQLENBQWQsRUFBd0M7QUFDdEMsWUFBSUYsU0FBSixFQUFlO0FBQ2JDLFVBQUFBLEdBQUcsQ0FBQ1AsTUFBSixDQUFXUSxJQUFYLEVBQWlCTSxJQUFqQixDQUFzQlgsSUFBdEI7QUFDRDs7QUFFRCxlQUFPLEtBQVA7QUFDRDs7QUFFRCxhQUFPLElBQVA7QUF2Sko7QUF5SkQ7O0FBR0RlLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQnRCLElBQWpCIiwic291cmNlc0NvbnRlbnQiOlsidmFyIF9pbmNsdWRlcyA9XG4vKiNfX1BVUkVfXyovXG5yZXF1aXJlKFwiLi9faW5jbHVkZXNcIik7XG5cbnZhciBfU2V0ID1cbi8qI19fUFVSRV9fKi9cbmZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gX1NldCgpIHtcbiAgICAvKiBnbG9iYWxzIFNldCAqL1xuICAgIHRoaXMuX25hdGl2ZVNldCA9IHR5cGVvZiBTZXQgPT09ICdmdW5jdGlvbicgPyBuZXcgU2V0KCkgOiBudWxsO1xuICAgIHRoaXMuX2l0ZW1zID0ge307XG4gIH1cblxuICAvLyB1bnRpbCB3ZSBmaWd1cmUgb3V0IHdoeSBqc2RvYyBjaG9rZXMgb24gdGhpc1xuICAvLyBAcGFyYW0gaXRlbSBUaGUgaXRlbSB0byBhZGQgdG8gdGhlIFNldFxuICAvLyBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiB0aGUgaXRlbSBkaWQgbm90IGV4aXN0IHByaW9yLCBvdGhlcndpc2UgZmFsc2VcbiAgLy9cbiAgX1NldC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICByZXR1cm4gIWhhc09yQWRkKGl0ZW0sIHRydWUsIHRoaXMpO1xuICB9OyAvL1xuICAvLyBAcGFyYW0gaXRlbSBUaGUgaXRlbSB0byBjaGVjayBmb3IgZXhpc3RlbmNlIGluIHRoZSBTZXRcbiAgLy8gQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgdGhlIGl0ZW0gZXhpc3RzIGluIHRoZSBTZXQsIG90aGVyd2lzZSBmYWxzZVxuICAvL1xuXG5cbiAgX1NldC5wcm90b3R5cGUuaGFzID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICByZXR1cm4gaGFzT3JBZGQoaXRlbSwgZmFsc2UsIHRoaXMpO1xuICB9OyAvL1xuICAvLyBDb21iaW5lcyB0aGUgbG9naWMgZm9yIGNoZWNraW5nIHdoZXRoZXIgYW4gaXRlbSBpcyBhIG1lbWJlciBvZiB0aGUgc2V0IGFuZFxuICAvLyBmb3IgYWRkaW5nIGEgbmV3IGl0ZW0gdG8gdGhlIHNldC5cbiAgLy9cbiAgLy8gQHBhcmFtIGl0ZW0gICAgICAgVGhlIGl0ZW0gdG8gY2hlY2sgb3IgYWRkIHRvIHRoZSBTZXQgaW5zdGFuY2UuXG4gIC8vIEBwYXJhbSBzaG91bGRBZGQgIElmIHRydWUsIHRoZSBpdGVtIHdpbGwgYmUgYWRkZWQgdG8gdGhlIHNldCBpZiBpdCBkb2Vzbid0XG4gIC8vICAgICAgICAgICAgICAgICAgIGFscmVhZHkgZXhpc3QuXG4gIC8vIEBwYXJhbSBzZXQgICAgICAgIFRoZSBzZXQgaW5zdGFuY2UgdG8gY2hlY2sgb3IgYWRkIHRvLlxuICAvLyBAcmV0dXJuIHtib29sZWFufSB0cnVlIGlmIHRoZSBpdGVtIGFscmVhZHkgZXhpc3RlZCwgb3RoZXJ3aXNlIGZhbHNlLlxuICAvL1xuXG5cbiAgcmV0dXJuIF9TZXQ7XG59KCk7XG5cbmZ1bmN0aW9uIGhhc09yQWRkKGl0ZW0sIHNob3VsZEFkZCwgc2V0KSB7XG4gIHZhciB0eXBlID0gdHlwZW9mIGl0ZW07XG4gIHZhciBwcmV2U2l6ZSwgbmV3U2l6ZTtcblxuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlICdzdHJpbmcnOlxuICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAvLyBkaXN0aW5ndWlzaCBiZXR3ZWVuICswIGFuZCAtMFxuICAgICAgaWYgKGl0ZW0gPT09IDAgJiYgMSAvIGl0ZW0gPT09IC1JbmZpbml0eSkge1xuICAgICAgICBpZiAoc2V0Ll9pdGVtc1snLTAnXSkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChzaG91bGRBZGQpIHtcbiAgICAgICAgICAgIHNldC5faXRlbXNbJy0wJ10gPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSAvLyB0aGVzZSB0eXBlcyBjYW4gYWxsIHV0aWxpc2UgdGhlIG5hdGl2ZSBTZXRcblxuXG4gICAgICBpZiAoc2V0Ll9uYXRpdmVTZXQgIT09IG51bGwpIHtcbiAgICAgICAgaWYgKHNob3VsZEFkZCkge1xuICAgICAgICAgIHByZXZTaXplID0gc2V0Ll9uYXRpdmVTZXQuc2l6ZTtcblxuICAgICAgICAgIHNldC5fbmF0aXZlU2V0LmFkZChpdGVtKTtcblxuICAgICAgICAgIG5ld1NpemUgPSBzZXQuX25hdGl2ZVNldC5zaXplO1xuICAgICAgICAgIHJldHVybiBuZXdTaXplID09PSBwcmV2U2l6ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gc2V0Ll9uYXRpdmVTZXQuaGFzKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoISh0eXBlIGluIHNldC5faXRlbXMpKSB7XG4gICAgICAgICAgaWYgKHNob3VsZEFkZCkge1xuICAgICAgICAgICAgc2V0Ll9pdGVtc1t0eXBlXSA9IHt9O1xuICAgICAgICAgICAgc2V0Ll9pdGVtc1t0eXBlXVtpdGVtXSA9IHRydWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKGl0ZW0gaW4gc2V0Ll9pdGVtc1t0eXBlXSkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChzaG91bGRBZGQpIHtcbiAgICAgICAgICAgIHNldC5faXRlbXNbdHlwZV1baXRlbV0gPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAvLyBzZXQuX2l0ZW1zWydib29sZWFuJ10gaG9sZHMgYSB0d28gZWxlbWVudCBhcnJheVxuICAgICAgLy8gcmVwcmVzZW50aW5nIFsgZmFsc2VFeGlzdHMsIHRydWVFeGlzdHMgXVxuICAgICAgaWYgKHR5cGUgaW4gc2V0Ll9pdGVtcykge1xuICAgICAgICB2YXIgYklkeCA9IGl0ZW0gPyAxIDogMDtcblxuICAgICAgICBpZiAoc2V0Ll9pdGVtc1t0eXBlXVtiSWR4XSkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChzaG91bGRBZGQpIHtcbiAgICAgICAgICAgIHNldC5faXRlbXNbdHlwZV1bYklkeF0gPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHNob3VsZEFkZCkge1xuICAgICAgICAgIHNldC5faXRlbXNbdHlwZV0gPSBpdGVtID8gW2ZhbHNlLCB0cnVlXSA6IFt0cnVlLCBmYWxzZV07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICBjYXNlICdmdW5jdGlvbic6XG4gICAgICAvLyBjb21wYXJlIGZ1bmN0aW9ucyBmb3IgcmVmZXJlbmNlIGVxdWFsaXR5XG4gICAgICBpZiAoc2V0Ll9uYXRpdmVTZXQgIT09IG51bGwpIHtcbiAgICAgICAgaWYgKHNob3VsZEFkZCkge1xuICAgICAgICAgIHByZXZTaXplID0gc2V0Ll9uYXRpdmVTZXQuc2l6ZTtcblxuICAgICAgICAgIHNldC5fbmF0aXZlU2V0LmFkZChpdGVtKTtcblxuICAgICAgICAgIG5ld1NpemUgPSBzZXQuX25hdGl2ZVNldC5zaXplO1xuICAgICAgICAgIHJldHVybiBuZXdTaXplID09PSBwcmV2U2l6ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gc2V0Ll9uYXRpdmVTZXQuaGFzKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoISh0eXBlIGluIHNldC5faXRlbXMpKSB7XG4gICAgICAgICAgaWYgKHNob3VsZEFkZCkge1xuICAgICAgICAgICAgc2V0Ll9pdGVtc1t0eXBlXSA9IFtpdGVtXTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIV9pbmNsdWRlcyhpdGVtLCBzZXQuX2l0ZW1zW3R5cGVdKSkge1xuICAgICAgICAgIGlmIChzaG91bGRBZGQpIHtcbiAgICAgICAgICAgIHNldC5faXRlbXNbdHlwZV0ucHVzaChpdGVtKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgIGNhc2UgJ3VuZGVmaW5lZCc6XG4gICAgICBpZiAoc2V0Ll9pdGVtc1t0eXBlXSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChzaG91bGRBZGQpIHtcbiAgICAgICAgICBzZXQuX2l0ZW1zW3R5cGVdID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICBpZiAoaXRlbSA9PT0gbnVsbCkge1xuICAgICAgICBpZiAoIXNldC5faXRlbXNbJ251bGwnXSkge1xuICAgICAgICAgIGlmIChzaG91bGRBZGQpIHtcbiAgICAgICAgICAgIHNldC5faXRlbXNbJ251bGwnXSA9IHRydWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAvKiBmYWxscyB0aHJvdWdoICovXG5cbiAgICBkZWZhdWx0OlxuICAgICAgLy8gcmVkdWNlIHRoZSBzZWFyY2ggc2l6ZSBvZiBoZXRlcm9nZW5lb3VzIHNldHMgYnkgY3JlYXRpbmcgYnVja2V0c1xuICAgICAgLy8gZm9yIGVhY2ggdHlwZS5cbiAgICAgIHR5cGUgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlbSk7XG5cbiAgICAgIGlmICghKHR5cGUgaW4gc2V0Ll9pdGVtcykpIHtcbiAgICAgICAgaWYgKHNob3VsZEFkZCkge1xuICAgICAgICAgIHNldC5faXRlbXNbdHlwZV0gPSBbaXRlbV07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9IC8vIHNjYW4gdGhyb3VnaCBhbGwgcHJldmlvdXNseSBhcHBsaWVkIGl0ZW1zXG5cblxuICAgICAgaWYgKCFfaW5jbHVkZXMoaXRlbSwgc2V0Ll9pdGVtc1t0eXBlXSkpIHtcbiAgICAgICAgaWYgKHNob3VsZEFkZCkge1xuICAgICAgICAgIHNldC5faXRlbXNbdHlwZV0ucHVzaChpdGVtKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gIH1cbn0gLy8gQSBzaW1wbGUgU2V0IHR5cGUgdGhhdCBob25vdXJzIFIuZXF1YWxzIHNlbWFudGljc1xuXG5cbm1vZHVsZS5leHBvcnRzID0gX1NldDsiXX0=