6ed7c7b9da864f50639b5b8e25a52a44
var _concat = require("./_concat");

var _curry2 = require("./_curry2");

var _xfBase = require("./_xfBase");

var XAperture = function () {
  function XAperture(n, xf) {
    this.xf = xf;
    this.pos = 0;
    this.full = false;
    this.acc = new Array(n);
  }

  XAperture.prototype['@@transducer/init'] = _xfBase.init;

  XAperture.prototype['@@transducer/result'] = function (result) {
    this.acc = null;
    return this.xf['@@transducer/result'](result);
  };

  XAperture.prototype['@@transducer/step'] = function (result, input) {
    this.store(input);
    return this.full ? this.xf['@@transducer/step'](result, this.getCopy()) : result;
  };

  XAperture.prototype.store = function (input) {
    this.acc[this.pos] = input;
    this.pos += 1;

    if (this.pos === this.acc.length) {
      this.pos = 0;
      this.full = true;
    }
  };

  XAperture.prototype.getCopy = function () {
    return _concat(Array.prototype.slice.call(this.acc, this.pos), Array.prototype.slice.call(this.acc, 0, this.pos));
  };

  return XAperture;
}();

var _xaperture = _curry2(function _xaperture(n, xf) {
  return new XAperture(n, xf);
});

module.exports = _xaperture;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl94YXBlcnR1cmUuanMiXSwibmFtZXMiOlsiX2NvbmNhdCIsInJlcXVpcmUiLCJfY3VycnkyIiwiX3hmQmFzZSIsIlhBcGVydHVyZSIsIm4iLCJ4ZiIsInBvcyIsImZ1bGwiLCJhY2MiLCJBcnJheSIsInByb3RvdHlwZSIsImluaXQiLCJyZXN1bHQiLCJpbnB1dCIsInN0b3JlIiwiZ2V0Q29weSIsImxlbmd0aCIsInNsaWNlIiwiY2FsbCIsIl94YXBlcnR1cmUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFJQSxPQUFPLEdBRVhDLE9BQU8sQ0FBQyxXQUFELENBRlA7O0FBSUEsSUFBSUMsT0FBTyxHQUVYRCxPQUFPLENBQUMsV0FBRCxDQUZQOztBQUlBLElBQUlFLE9BQU8sR0FFWEYsT0FBTyxDQUFDLFdBQUQsQ0FGUDs7QUFJQSxJQUFJRyxTQUFTLEdBRWIsWUFBWTtBQUNWLFdBQVNBLFNBQVQsQ0FBbUJDLENBQW5CLEVBQXNCQyxFQUF0QixFQUEwQjtBQUN4QixTQUFLQSxFQUFMLEdBQVVBLEVBQVY7QUFDQSxTQUFLQyxHQUFMLEdBQVcsQ0FBWDtBQUNBLFNBQUtDLElBQUwsR0FBWSxLQUFaO0FBQ0EsU0FBS0MsR0FBTCxHQUFXLElBQUlDLEtBQUosQ0FBVUwsQ0FBVixDQUFYO0FBQ0Q7O0FBRURELEVBQUFBLFNBQVMsQ0FBQ08sU0FBVixDQUFvQixtQkFBcEIsSUFBMkNSLE9BQU8sQ0FBQ1MsSUFBbkQ7O0FBRUFSLEVBQUFBLFNBQVMsQ0FBQ08sU0FBVixDQUFvQixxQkFBcEIsSUFBNkMsVUFBVUUsTUFBVixFQUFrQjtBQUM3RCxTQUFLSixHQUFMLEdBQVcsSUFBWDtBQUNBLFdBQU8sS0FBS0gsRUFBTCxDQUFRLHFCQUFSLEVBQStCTyxNQUEvQixDQUFQO0FBQ0QsR0FIRDs7QUFLQVQsRUFBQUEsU0FBUyxDQUFDTyxTQUFWLENBQW9CLG1CQUFwQixJQUEyQyxVQUFVRSxNQUFWLEVBQWtCQyxLQUFsQixFQUF5QjtBQUNsRSxTQUFLQyxLQUFMLENBQVdELEtBQVg7QUFDQSxXQUFPLEtBQUtOLElBQUwsR0FBWSxLQUFLRixFQUFMLENBQVEsbUJBQVIsRUFBNkJPLE1BQTdCLEVBQXFDLEtBQUtHLE9BQUwsRUFBckMsQ0FBWixHQUFtRUgsTUFBMUU7QUFDRCxHQUhEOztBQUtBVCxFQUFBQSxTQUFTLENBQUNPLFNBQVYsQ0FBb0JJLEtBQXBCLEdBQTRCLFVBQVVELEtBQVYsRUFBaUI7QUFDM0MsU0FBS0wsR0FBTCxDQUFTLEtBQUtGLEdBQWQsSUFBcUJPLEtBQXJCO0FBQ0EsU0FBS1AsR0FBTCxJQUFZLENBQVo7O0FBRUEsUUFBSSxLQUFLQSxHQUFMLEtBQWEsS0FBS0UsR0FBTCxDQUFTUSxNQUExQixFQUFrQztBQUNoQyxXQUFLVixHQUFMLEdBQVcsQ0FBWDtBQUNBLFdBQUtDLElBQUwsR0FBWSxJQUFaO0FBQ0Q7QUFDRixHQVJEOztBQVVBSixFQUFBQSxTQUFTLENBQUNPLFNBQVYsQ0FBb0JLLE9BQXBCLEdBQThCLFlBQVk7QUFDeEMsV0FBT2hCLE9BQU8sQ0FBQ1UsS0FBSyxDQUFDQyxTQUFOLENBQWdCTyxLQUFoQixDQUFzQkMsSUFBdEIsQ0FBMkIsS0FBS1YsR0FBaEMsRUFBcUMsS0FBS0YsR0FBMUMsQ0FBRCxFQUFpREcsS0FBSyxDQUFDQyxTQUFOLENBQWdCTyxLQUFoQixDQUFzQkMsSUFBdEIsQ0FBMkIsS0FBS1YsR0FBaEMsRUFBcUMsQ0FBckMsRUFBd0MsS0FBS0YsR0FBN0MsQ0FBakQsQ0FBZDtBQUNELEdBRkQ7O0FBSUEsU0FBT0gsU0FBUDtBQUNELENBbkNELEVBRkE7O0FBdUNBLElBQUlnQixVQUFVLEdBRWRsQixPQUFPLENBQUMsU0FBU2tCLFVBQVQsQ0FBb0JmLENBQXBCLEVBQXVCQyxFQUF2QixFQUEyQjtBQUNqQyxTQUFPLElBQUlGLFNBQUosQ0FBY0MsQ0FBZCxFQUFpQkMsRUFBakIsQ0FBUDtBQUNELENBRk0sQ0FGUDs7QUFNQWUsTUFBTSxDQUFDQyxPQUFQLEdBQWlCRixVQUFqQiIsInNvdXJjZXNDb250ZW50IjpbInZhciBfY29uY2F0ID1cbi8qI19fUFVSRV9fKi9cbnJlcXVpcmUoXCIuL19jb25jYXRcIik7XG5cbnZhciBfY3VycnkyID1cbi8qI19fUFVSRV9fKi9cbnJlcXVpcmUoXCIuL19jdXJyeTJcIik7XG5cbnZhciBfeGZCYXNlID1cbi8qI19fUFVSRV9fKi9cbnJlcXVpcmUoXCIuL194ZkJhc2VcIik7XG5cbnZhciBYQXBlcnR1cmUgPVxuLyojX19QVVJFX18qL1xuZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBYQXBlcnR1cmUobiwgeGYpIHtcbiAgICB0aGlzLnhmID0geGY7XG4gICAgdGhpcy5wb3MgPSAwO1xuICAgIHRoaXMuZnVsbCA9IGZhbHNlO1xuICAgIHRoaXMuYWNjID0gbmV3IEFycmF5KG4pO1xuICB9XG5cbiAgWEFwZXJ0dXJlLnByb3RvdHlwZVsnQEB0cmFuc2R1Y2VyL2luaXQnXSA9IF94ZkJhc2UuaW5pdDtcblxuICBYQXBlcnR1cmUucHJvdG90eXBlWydAQHRyYW5zZHVjZXIvcmVzdWx0J10gPSBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgdGhpcy5hY2MgPSBudWxsO1xuICAgIHJldHVybiB0aGlzLnhmWydAQHRyYW5zZHVjZXIvcmVzdWx0J10ocmVzdWx0KTtcbiAgfTtcblxuICBYQXBlcnR1cmUucHJvdG90eXBlWydAQHRyYW5zZHVjZXIvc3RlcCddID0gZnVuY3Rpb24gKHJlc3VsdCwgaW5wdXQpIHtcbiAgICB0aGlzLnN0b3JlKGlucHV0KTtcbiAgICByZXR1cm4gdGhpcy5mdWxsID8gdGhpcy54ZlsnQEB0cmFuc2R1Y2VyL3N0ZXAnXShyZXN1bHQsIHRoaXMuZ2V0Q29weSgpKSA6IHJlc3VsdDtcbiAgfTtcblxuICBYQXBlcnR1cmUucHJvdG90eXBlLnN0b3JlID0gZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgdGhpcy5hY2NbdGhpcy5wb3NdID0gaW5wdXQ7XG4gICAgdGhpcy5wb3MgKz0gMTtcblxuICAgIGlmICh0aGlzLnBvcyA9PT0gdGhpcy5hY2MubGVuZ3RoKSB7XG4gICAgICB0aGlzLnBvcyA9IDA7XG4gICAgICB0aGlzLmZ1bGwgPSB0cnVlO1xuICAgIH1cbiAgfTtcblxuICBYQXBlcnR1cmUucHJvdG90eXBlLmdldENvcHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIF9jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5hY2MsIHRoaXMucG9zKSwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5hY2MsIDAsIHRoaXMucG9zKSk7XG4gIH07XG5cbiAgcmV0dXJuIFhBcGVydHVyZTtcbn0oKTtcblxudmFyIF94YXBlcnR1cmUgPVxuLyojX19QVVJFX18qL1xuX2N1cnJ5MihmdW5jdGlvbiBfeGFwZXJ0dXJlKG4sIHhmKSB7XG4gIHJldHVybiBuZXcgWEFwZXJ0dXJlKG4sIHhmKTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IF94YXBlcnR1cmU7Il19