1fbff45228efa4f33e1ec7c36ab42435
"use strict";

var __extends = this && this.__extends || function () {
  var _extendStatics = function extendStatics(d, b) {
    _extendStatics = Object.setPrototypeOf || {
      __proto__: []
    } instanceof Array && function (d, b) {
      d.__proto__ = b;
    } || function (d, b) {
      for (var p in b) {
        if (b.hasOwnProperty(p)) d[p] = b[p];
      }
    };

    return _extendStatics(d, b);
  };

  return function (d, b) {
    _extendStatics(d, b);

    function __() {
      this.constructor = d;
    }

    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
  };
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});

var innerSubscribe_1 = require("../innerSubscribe");

exports.defaultThrottleConfig = {
  leading: true,
  trailing: false
};

function throttle(durationSelector, config) {
  if (config === void 0) {
    config = exports.defaultThrottleConfig;
  }

  return function (source) {
    return source.lift(new ThrottleOperator(durationSelector, !!config.leading, !!config.trailing));
  };
}

exports.throttle = throttle;

var ThrottleOperator = function () {
  function ThrottleOperator(durationSelector, leading, trailing) {
    this.durationSelector = durationSelector;
    this.leading = leading;
    this.trailing = trailing;
  }

  ThrottleOperator.prototype.call = function (subscriber, source) {
    return source.subscribe(new ThrottleSubscriber(subscriber, this.durationSelector, this.leading, this.trailing));
  };

  return ThrottleOperator;
}();

var ThrottleSubscriber = function (_super) {
  __extends(ThrottleSubscriber, _super);

  function ThrottleSubscriber(destination, durationSelector, _leading, _trailing) {
    var _this = _super.call(this, destination) || this;

    _this.destination = destination;
    _this.durationSelector = durationSelector;
    _this._leading = _leading;
    _this._trailing = _trailing;
    _this._hasValue = false;
    return _this;
  }

  ThrottleSubscriber.prototype._next = function (value) {
    this._hasValue = true;
    this._sendValue = value;

    if (!this._throttled) {
      if (this._leading) {
        this.send();
      } else {
        this.throttle(value);
      }
    }
  };

  ThrottleSubscriber.prototype.send = function () {
    var _a = this,
        _hasValue = _a._hasValue,
        _sendValue = _a._sendValue;

    if (_hasValue) {
      this.destination.next(_sendValue);
      this.throttle(_sendValue);
    }

    this._hasValue = false;
    this._sendValue = undefined;
  };

  ThrottleSubscriber.prototype.throttle = function (value) {
    var duration = this.tryDurationSelector(value);

    if (!!duration) {
      this.add(this._throttled = innerSubscribe_1.innerSubscribe(duration, new innerSubscribe_1.SimpleInnerSubscriber(this)));
    }
  };

  ThrottleSubscriber.prototype.tryDurationSelector = function (value) {
    try {
      return this.durationSelector(value);
    } catch (err) {
      this.destination.error(err);
      return null;
    }
  };

  ThrottleSubscriber.prototype.throttlingDone = function () {
    var _a = this,
        _throttled = _a._throttled,
        _trailing = _a._trailing;

    if (_throttled) {
      _throttled.unsubscribe();
    }

    this._throttled = undefined;

    if (_trailing) {
      this.send();
    }
  };

  ThrottleSubscriber.prototype.notifyNext = function () {
    this.throttlingDone();
  };

  ThrottleSubscriber.prototype.notifyComplete = function () {
    this.throttlingDone();
  };

  return ThrottleSubscriber;
}(innerSubscribe_1.SimpleOuterSubscriber);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9pbnRlcm5hbC9vcGVyYXRvcnMvdGhyb3R0bGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFNQSxJQUFBLGdCQUFBLEdBQUEsT0FBQSxDQUFBLG1CQUFBLENBQUE7O0FBT2EsT0FBQSxDQUFBLHFCQUFBLEdBQXdDO0FBQ25ELEVBQUEsT0FBTyxFQUFFLElBRDBDO0FBRW5ELEVBQUEsUUFBUSxFQUFFO0FBRnlDLENBQXhDOztBQW1EYixTQUFnQixRQUFoQixDQUE0QixnQkFBNUIsRUFDNEIsTUFENUIsRUFDMEU7QUFBOUMsTUFBQSxNQUFBLEtBQUEsS0FBQSxDQUFBLEVBQUE7QUFBQSxJQUFBLE1BQUEsR0FBeUIsT0FBQSxDQUFBLHFCQUF6QjtBQUE4Qzs7QUFDeEUsU0FBTyxVQUFDLE1BQUQsRUFBc0I7QUFBSyxXQUFBLE1BQU0sQ0FBQyxJQUFQLENBQVksSUFBSSxnQkFBSixDQUFxQixnQkFBckIsRUFBdUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFoRCxFQUF5RCxDQUFDLENBQUMsTUFBTSxDQUE3RSxRQUFZLENBQVosQ0FBQTtBQUF3RixHQUExSDtBQUNEOztBQUhELE9BQUEsQ0FBQSxRQUFBLEdBQUEsUUFBQTs7QUFLQSxJQUFBLGdCQUFBLEdBQUEsWUFBQTtBQUNFLFdBQUEsZ0JBQUEsQ0FBb0IsZ0JBQXBCLEVBQ29CLE9BRHBCLEVBRW9CLFFBRnBCLEVBRXFDO0FBRmpCLFNBQUEsZ0JBQUEsR0FBQSxnQkFBQTtBQUNBLFNBQUEsT0FBQSxHQUFBLE9BQUE7QUFDQSxTQUFBLFFBQUEsR0FBQSxRQUFBO0FBQ25COztBQUVELEVBQUEsZ0JBQUEsQ0FBQSxTQUFBLENBQUEsSUFBQSxHQUFBLFVBQUssVUFBTCxFQUFnQyxNQUFoQyxFQUEyQztBQUN6QyxXQUFPLE1BQU0sQ0FBQyxTQUFQLENBQ0wsSUFBSSxrQkFBSixDQUF1QixVQUF2QixFQUFtQyxLQUFLLGdCQUF4QyxF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