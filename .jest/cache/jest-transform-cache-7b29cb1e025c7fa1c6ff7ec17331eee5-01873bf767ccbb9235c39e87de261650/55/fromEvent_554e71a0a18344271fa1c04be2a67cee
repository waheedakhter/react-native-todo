2df1026cefeb0e232ebb6fc61bd67358
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var Observable_1 = require("../Observable");

var isArray_1 = require("../util/isArray");

var isFunction_1 = require("../util/isFunction");

var map_1 = require("../operators/map");

var toString = function () {
  return Object.prototype.toString;
}();

function fromEvent(target, eventName, options, resultSelector) {
  if (isFunction_1.isFunction(options)) {
    resultSelector = options;
    options = undefined;
  }

  if (resultSelector) {
    return fromEvent(target, eventName, options).pipe(map_1.map(function (args) {
      return isArray_1.isArray(args) ? resultSelector.apply(void 0, args) : resultSelector(args);
    }));
  }

  return new Observable_1.Observable(function (subscriber) {
    function handler(e) {
      if (arguments.length > 1) {
        subscriber.next(Array.prototype.slice.call(arguments));
      } else {
        subscriber.next(e);
      }
    }

    setupSubscription(target, eventName, handler, subscriber, options);
  });
}

exports.fromEvent = fromEvent;

function setupSubscription(sourceObj, eventName, handler, subscriber, options) {
  var unsubscribe;

  if (isEventTarget(sourceObj)) {
    var source_1 = sourceObj;
    sourceObj.addEventListener(eventName, handler, options);

    unsubscribe = function unsubscribe() {
      return source_1.removeEventListener(eventName, handler, options);
    };
  } else if (isJQueryStyleEventEmitter(sourceObj)) {
    var source_2 = sourceObj;
    sourceObj.on(eventName, handler);

    unsubscribe = function unsubscribe() {
      return source_2.off(eventName, handler);
    };
  } else if (isNodeStyleEventEmitter(sourceObj)) {
    var source_3 = sourceObj;
    sourceObj.addListener(eventName, handler);

    unsubscribe = function unsubscribe() {
      return source_3.removeListener(eventName, handler);
    };
  } else if (sourceObj && sourceObj.length) {
    for (var i = 0, len = sourceObj.length; i < len; i++) {
      setupSubscription(sourceObj[i], eventName, handler, subscriber, options);
    }
  } else {
    throw new TypeError('Invalid event target');
  }

  subscriber.add(unsubscribe);
}

function isNodeStyleEventEmitter(sourceObj) {
  return sourceObj && typeof sourceObj.addListener === 'function' && typeof sourceObj.removeListener === 'function';
}

function isJQueryStyleEventEmitter(sourceObj) {
  return sourceObj && typeof sourceObj.on === 'function' && typeof sourceObj.off === 'function';
}

function isEventTarget(sourceObj) {
  return sourceObj && typeof sourceObj.addEventListener === 'function' && typeof sourceObj.removeEventListener === 'function';
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9pbnRlcm5hbC9vYnNlcnZhYmxlL2Zyb21FdmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBLFlBQUEsR0FBQSxPQUFBLENBQUEsZUFBQSxDQUFBOztBQUNBLElBQUEsU0FBQSxHQUFBLE9BQUEsQ0FBQSxpQkFBQSxDQUFBOztBQUNBLElBQUEsWUFBQSxHQUFBLE9BQUEsQ0FBQSxvQkFBQSxDQUFBOztBQUVBLElBQUEsS0FBQSxHQUFBLE9BQUEsQ0FBQSxrQkFBQSxDQUFBOztBQUVBLElBQU0sUUFBUSxHQUFjLFlBQUE7QUFBTSxTQUFBLE1BQU0sQ0FBQyxTQUFQLENBQUEsUUFBQTtBQUF5QixDQUFoQyxFQUEzQjs7QUEwS0EsU0FBZ0IsU0FBaEIsQ0FDRSxNQURGLEVBRUUsU0FGRixFQUdFLE9BSEYsRUFJRSxjQUpGLEVBSTBDO0FBR3hDLE1BQUksWUFBQSxDQUFBLFVBQUEsQ0FBVyxPQUFYLENBQUosRUFBeUI7QUFFdkIsSUFBQSxjQUFjLEdBQUcsT0FBakI7QUFDQSxJQUFBLE9BQU8sR0FBRyxTQUFWO0FBQ0Q7O0FBQ0QsTUFBSSxjQUFKLEVBQW9CO0FBRWxCLFdBQU8sU0FBUyxDQUFJLE1BQUosRUFBWSxTQUFaLEVBQXlELE9BQXpELENBQVQsQ0FBMkUsSUFBM0UsQ0FDTCxLQUFBLENBQUEsR0FBQSxDQUFJLFVBQUEsSUFBQSxFQUFJO0FBQUksYUFBQSxTQUFBLENBQUEsT0FBQSxDQUFRLElBQVIsSUFBZ0IsY0FBYyxDQUFBLEtBQWQsQ0FBYyxLQUFBLENBQWQsRUFBa0IsSUFBbEIsQ0FBaEIsR0FBMEMsY0FBYyxDQUF4RCxJQUF3RCxDQUF4RDtBQUE4RCxLQUExRSxDQURLLENBQVA7QUFHRDs7QUFFRCxTQUFPLElBQUksWUFBQSxDQUFBLFVBQUosQ0FBa0IsVUFBQSxVQUFBLEVBQVU7QUFDakMsYUFBUyxPQUFULENBQWlCLENBQWpCLEVBQXFCO0FBQ25CLFVBQUksU0FBUyxDQUFDLE1BQVYsR0FB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