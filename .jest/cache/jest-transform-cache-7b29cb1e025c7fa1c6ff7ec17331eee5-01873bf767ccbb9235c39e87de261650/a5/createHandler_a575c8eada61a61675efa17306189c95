9ad0c483e4de0234af6f5656f06a6175
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _toConsumableArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault2(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault2(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault2(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault2(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault2(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault2(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty3 = _interopRequireDefault2(require("@babel/runtime/helpers/defineProperty"));

var _extends2 = _interopRequireDefault2(require("@babel/runtime/helpers/extends"));

var _stateToPropMappings;

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createHandler;

var React = _interopRequireWildcard(require("react"));

var _reactNative = require("react-native");

var _areEqual = _interopRequireDefault(require("fbjs/lib/areEqual"));

var _RNGestureHandlerModule = _interopRequireDefault(require("../RNGestureHandlerModule"));

var _State = require("../State");

var _UIManager$getViewMan, _UIManager$getViewMan2, _UIManager$getConstan;

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _getRequireWildcardCache() {
  if (typeof WeakMap !== "function") return null;
  var cache = new WeakMap();

  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };

  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache();

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

function findNodeHandle(node) {
  if (_reactNative.Platform.OS === 'web') return node;
  return (0, _reactNative.findNodeHandle)(node);
}

var _reactNative$NativeMo = _reactNative.NativeModules.UIManager,
    UIManager = _reactNative$NativeMo === void 0 ? {} : _reactNative$NativeMo;
var customGHEventsConfig = {
  onGestureHandlerEvent: {
    registrationName: 'onGestureHandlerEvent'
  },
  onGestureHandlerStateChange: {
    registrationName: 'onGestureHandlerStateChange'
  }
};
UIManager.genericDirectEventTypes = (0, _extends2.default)({}, UIManager.genericDirectEventTypes, customGHEventsConfig);
var UIManagerConstants = (_UIManager$getViewMan = (_UIManager$getViewMan2 = UIManager.getViewManagerConfig) === null || _UIManager$getViewMan2 === void 0 ? void 0 : _UIManager$getViewMan2.call(UIManager, 'getConstants')) !== null && _UIManager$getViewMan !== void 0 ? _UIManager$getViewMan : (_UIManager$getConstan = UIManager.getConstants) === null || _UIManager$getConstan === void 0 ? void 0 : _UIManager$getConstan.call(UIManager);

if (UIManagerConstants) {
  UIManagerConstants.genericDirectEventTypes = (0, _extends2.default)({}, UIManagerConstants.genericDirectEventTypes, customGHEventsConfig);
}

var _UIManager$setJSRespo = UIManager.setJSResponder,
    oldSetJSResponder = _UIManager$setJSRespo === void 0 ? function () {} : _UIManager$setJSRespo,
    _UIManager$clearJSRes = UIManager.clearJSResponder,
    oldClearJSResponder = _UIManager$clearJSRes === void 0 ? function () {} : _UIManager$clearJSRes;

UIManager.setJSResponder = function (tag, blockNativeResponder) {
  _RNGestureHandlerModule.default.handleSetJSResponder(tag, blockNativeResponder);

  oldSetJSResponder(tag, blockNativeResponder);
};

UIManager.clearJSResponder = function () {
  _RNGestureHandlerModule.default.handleClearJSResponder();

  oldClearJSResponder();
};

var handlerTag = 1;
var handlerIDToTag = {};

function isConfigParam(param, name) {
  return param !== undefined && (param !== Object(param) || !('__isNative' in param)) && name !== 'onHandlerStateChange' && name !== 'onGestureEvent';
}

function filterConfig(props, validProps) {
  var defaults = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  var res = (0, _extends2.default)({}, defaults);
  validProps.forEach(function (key) {
    var value = props[key];

    if (isConfigParam(value, key)) {
      var _value = props[key];

      if (key === 'simultaneousHandlers' || key === 'waitFor') {
        _value = transformIntoHandlerTags(props[key]);
      } else if (key === 'hitSlop') {
        if (typeof _value !== 'object') {
          _value = {
            top: _value,
            left: _value,
            bottom: _value,
            right: _value
          };
        }
      }

      res[key] = _value;
    }
  });
  return res;
}

function transformIntoHandlerTags(handlerIDs) {
  if (!Array.isArray(handlerIDs)) {
    handlerIDs = [handlerIDs];
  }

  if (_reactNative.Platform.OS === 'web') {
    return handlerIDs.map(function (_ref) {
      var current = _ref.current;
      return current;
    }).filter(function (handle) {
      return handle;
    });
  }

  return handlerIDs.map(function (handlerID) {
    var _handlerID$current;

    return handlerIDToTag[handlerID] || ((_handlerID$current = handlerID.current) === null || _handlerID$current === void 0 ? void 0 : _handlerID$current.handlerTag) || -1;
  }).filter(function (handlerTag) {
    return handlerTag > 0;
  });
}

function hasUnresolvedRefs(props) {
  var extract = function extract(refs) {
    if (!Array.isArray(refs)) {
      return refs && refs.current === null;
    }

    return refs.some(function (r) {
      return r && r.current === null;
    });
  };

  return extract(props['simultaneousHandlers']) || extract(props['waitFor']);
}

var stateToPropMappings = (_stateToPropMappings = {}, (0, _defineProperty3.default)(_stateToPropMappings, _State.State.UNDETERMINED, undefined), (0, _defineProperty3.default)(_stateToPropMappings, _State.State.BEGAN, 'onBegan'), (0, _defineProperty3.default)(_stateToPropMappings, _State.State.FAILED, 'onFailed'), (0, _defineProperty3.default)(_stateToPropMappings, _State.State.CANCELLED, 'onCancelled'), (0, _defineProperty3.default)(_stateToPropMappings, _State.State.ACTIVE, 'onActivated'), (0, _defineProperty3.default)(_stateToPropMappings, _State.State.END, 'onEnded'), _stateToPropMappings);

function createHandler(_ref2) {
  var name = _ref2.name,
      _ref2$allowedProps = _ref2.allowedProps,
      allowedProps = _ref2$allowedProps === void 0 ? [] : _ref2$allowedProps,
      _ref2$config = _ref2.config,
      config = _ref2$config === void 0 ? {} : _ref2$config,
      transformProps = _ref2.transformProps,
      _ref2$customNativePro = _ref2.customNativeProps,
      customNativeProps = _ref2$customNativePro === void 0 ? [] : _ref2$customNativePro;

  var Handler = function (_React$Component) {
    (0, _inherits2.default)(Handler, _React$Component);

    var _super = _createSuper(Handler);

    function Handler(props) {
      var _this;

      (0, _classCallCheck2.default)(this, Handler);
      _this = _super.call(this, props);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "handlerTag", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "config", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "propsRef", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "viewNode", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "viewTag", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "updateEnqueued", null);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "onGestureHandlerEvent", function (event) {
        if (event.nativeEvent.handlerTag === _this.handlerTag) {
          var _this$props$onGesture, _this$props;

          (_this$props$onGesture = (_this$props = _this.props).onGestureEvent) === null || _this$props$onGesture === void 0 ? void 0 : _this$props$onGesture.call(_this$props, event);
        } else {
          var _this$props$onGesture2, _this$props2;

          (_this$props$onGesture2 = (_this$props2 = _this.props).onGestureHandlerEvent) === null || _this$props$onGesture2 === void 0 ? void 0 : _this$props$onGesture2.call(_this$props2, event);
        }
      });

      _defineProperty((0, _assertThisInitialized2.default)(_this), "onGestureHandlerStateChange", function (event) {
        if (event.nativeEvent.handlerTag === _this.handlerTag) {
          var _this$props$onHandler, _this$props3;

          (_this$props$onHandler = (_this$props3 = _this.props).onHandlerStateChange) === null || _this$props$onHandler === void 0 ? void 0 : _this$props$onHandler.call(_this$props3, event);
          var state = event.nativeEvent.state;
          var stateEventName = stateToPropMappings[state];
          var eventHandler = stateEventName && _this.props[stateEventName];

          if (eventHandler && typeof eventHandler === 'function') {
            eventHandler(event);
          }
        } else {
          var _this$props$onGesture3, _this$props4;

          (_this$props$onGesture3 = (_this$props4 = _this.props).onGestureHandlerStateChange) === null || _this$props$onGesture3 === void 0 ? void 0 : _this$props$onGesture3.call(_this$props4, event);
        }
      });

      _defineProperty((0, _assertThisInitialized2.default)(_this), "refHandler", function (node) {
        _this.viewNode = node;
        var child = React.Children.only(_this.props.children);
        var ref = child.ref;

        if (ref !== null) {
          if (typeof ref === 'function') {
            ref(node);
          } else {
            ref.current = node;
          }
        }
      });

      _defineProperty((0, _assertThisInitialized2.default)(_this), "createGestureHandler", function (newConfig) {
        _this.config = newConfig;

        _RNGestureHandlerModule.default.createGestureHandler(name, _this.handlerTag, newConfig);
      });

      _defineProperty((0, _assertThisInitialized2.default)(_this), "attachGestureHandler", function (newViewTag) {
        _this.viewTag = newViewTag;

        if (_reactNative.Platform.OS === 'web') {
          _RNGestureHandlerModule.default.attachGestureHandler(_this.handlerTag, newViewTag, _this.propsRef);
        } else {
          _RNGestureHandlerModule.default.attachGestureHandler(_this.handlerTag, newViewTag);
        }
      });

      _defineProperty((0, _assertThisInitialized2.default)(_this), "updateGestureHandler", function (newConfig) {
        _this.config = newConfig;

        _RNGestureHandlerModule.default.updateGestureHandler(_this.handlerTag, newConfig);
      });

      _this.handlerTag = handlerTag++;
      _this.config = {};
      _this.propsRef = React.createRef();

      if (props.id) {
        if (handlerIDToTag[props.id] !== undefined) {
          throw new Error("Handler with ID \"".concat(props.id, "\" already registered"));
        }

        handlerIDToTag[props.id] = _this.handlerTag;
      }

      return _this;
    }

    (0, _createClass2.default)(Handler, [{
      key: "componentDidMount",
      value: function componentDidMount() {
        var _this2 = this;

        var props = this.props;

        if (hasUnresolvedRefs(props)) {
          this.updateEnqueued = setImmediate(function () {
            _this2.updateEnqueued = null;

            _this2.update();
          });
        }

        this.createGestureHandler(filterConfig(transformProps ? transformProps(this.props) : this.props, [].concat((0, _toConsumableArray2.default)(allowedProps), (0, _toConsumableArray2.default)(customNativeProps)), config));
        this.attachGestureHandler(findNodeHandle(this.viewNode));
      }
    }, {
      key: "componentDidUpdate",
      value: function componentDidUpdate() {
        var viewTag = findNodeHandle(this.viewNode);

        if (this.viewTag !== viewTag) {
          this.attachGestureHandler(viewTag);
        }

        this.update();
      }
    }, {
      key: "componentWillUnmount",
      value: function componentWillUnmount() {
        _RNGestureHandlerModule.default.dropGestureHandler(this.handlerTag);

        if (this.updateEnqueued) {
          clearImmediate(this.updateEnqueued);
        }

        var handlerID = this.props.id;

        if (handlerID) {
          delete handlerIDToTag[handlerID];
        }
      }
    }, {
      key: "update",
      value: function update() {
        var newConfig = filterConfig(transformProps ? transformProps(this.props) : this.props, [].concat((0, _toConsumableArray2.default)(allowedProps), (0, _toConsumableArray2.default)(customNativeProps)), config);

        if (!(0, _areEqual.default)(this.config, newConfig)) {
          this.updateGestureHandler(newConfig);
        }
      }
    }, {
      key: "setNativeProps",
      value: function setNativeProps(updates) {
        var mergedProps = (0, _extends2.default)({}, this.props, updates);
        var newConfig = filterConfig(transformProps ? transformProps(mergedProps) : mergedProps, [].concat((0, _toConsumableArray2.default)(allowedProps), (0, _toConsumableArray2.default)(customNativeProps)), config);
        this.updateGestureHandler(newConfig);
      }
    }, {
      key: "render",
      value: function render() {
        var gestureEventHandler = this.onGestureHandlerEvent;
        var _this$props5 = this.props,
            onGestureEvent = _this$props5.onGestureEvent,
            onGestureHandlerEvent = _this$props5.onGestureHandlerEvent;

        if (onGestureEvent && typeof onGestureEvent !== 'function') {
          if (onGestureHandlerEvent) {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }

          gestureEventHandler = onGestureEvent;
        } else {
          if (onGestureHandlerEvent && typeof onGestureHandlerEvent !== 'function') {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }
        }

        var gestureStateEventHandler = this.onGestureHandlerStateChange;
        var _this$props6 = this.props,
            onHandlerStateChange = _this$props6.onHandlerStateChange,
            onGestureHandlerStateChange = _this$props6.onGestureHandlerStateChange;

        if (onHandlerStateChange && typeof onHandlerStateChange !== 'function') {
          if (onGestureHandlerStateChange) {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }

          gestureStateEventHandler = onHandlerStateChange;
        } else {
          if (onGestureHandlerStateChange && typeof onGestureHandlerStateChange !== 'function') {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }
        }

        var events = {
          onGestureHandlerEvent: gestureEventHandler,
          onGestureHandlerStateChange: gestureStateEventHandler
        };
        this.propsRef.current = events;
        var child = React.Children.only(this.props.children);
        var grandChildren = child.props.children;

        if (_reactNative.Touchable.TOUCH_TARGET_DEBUG && child.type && (child.type === 'RNGestureHandlerButton' || child.type.name === 'View' || child.type.displayName === 'View')) {
          grandChildren = React.Children.toArray(grandChildren);
          grandChildren.push(_reactNative.Touchable.renderDebugView({
            color: 'mediumspringgreen',
            hitSlop: child.props.hitSlop
          }));
        }

        return React.cloneElement(child, (0, _extends2.default)({
          ref: this.refHandler,
          collapsable: false
        }, events), grandChildren);
      }
    }]);
    return Handler;
  }(React.Component);

  _defineProperty(Handler, "displayName", name);

  return Handler;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZUhhbmRsZXIudHMiXSwibmFtZXMiOlsiUGxhdGZvcm0iLCJVSU1hbmFnZXIiLCJOYXRpdmVNb2R1bGVzIiwiY3VzdG9tR0hFdmVudHNDb25maWciLCJvbkdlc3R1cmVIYW5kbGVyRXZlbnQiLCJyZWdpc3RyYXRpb25OYW1lIiwib25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlIiwiVUlNYW5hZ2VyQ29uc3RhbnRzIiwic2V0SlNSZXNwb25kZXIiLCJvbGRTZXRKU1Jlc3BvbmRlciIsImNsZWFySlNSZXNwb25kZXIiLCJvbGRDbGVhckpTUmVzcG9uZGVyIiwiUk5HZXN0dXJlSGFuZGxlck1vZHVsZSIsImhhbmRsZXJUYWciLCJoYW5kbGVySURUb1RhZyIsInBhcmFtIiwiT2JqZWN0IiwibmFtZSIsImRlZmF1bHRzIiwicmVzIiwidmFsaWRQcm9wcyIsImtleSIsInZhbHVlIiwicHJvcHMiLCJpc0NvbmZpZ1BhcmFtIiwidHJhbnNmb3JtSW50b0hhbmRsZXJUYWdzIiwidG9wIiwibGVmdCIsImJvdHRvbSIsInJpZ2h0IiwiQXJyYXkiLCJoYW5kbGVySURzIiwiY3VycmVudCIsImhhbmRsZSIsImhhbmRsZXJJRCIsImV4dHJhY3QiLCJyZWZzIiwiciIsInN0YXRlVG9Qcm9wTWFwcGluZ3MiLCJTdGF0ZSIsImFsbG93ZWRQcm9wcyIsImNvbmZpZyIsImN1c3RvbU5hdGl2ZVByb3BzIiwiUmVhY3QiLCJjb25zdHJ1Y3RvciIsImNvbXBvbmVudERpZE1vdW50IiwiaGFzVW5yZXNvbHZlZFJlZnMiLCJzZXRJbW1lZGlhdGUiLCJmaWx0ZXJDb25maWciLCJ0cmFuc2Zvcm1Qcm9wcyIsImZpbmROb2RlSGFuZGxlIiwiY29tcG9uZW50RGlkVXBkYXRlIiwidmlld1RhZyIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiY2xlYXJJbW1lZGlhdGUiLCJldmVudCIsInN0YXRlIiwic3RhdGVFdmVudE5hbWUiLCJldmVudEhhbmRsZXIiLCJub2RlIiwiY2hpbGQiLCJyZWYiLCJuZXdDb25maWciLCJuZXdWaWV3VGFnIiwidXBkYXRlIiwic2V0TmF0aXZlUHJvcHMiLCJtZXJnZWRQcm9wcyIsInVwZGF0ZXMiLCJyZW5kZXIiLCJnZXN0dXJlRXZlbnRIYW5kbGVyIiwib25HZXN0dXJlRXZlbnQiLCJnZXN0dXJlU3RhdGVFdmVudEhhbmRsZXIiLCJvbkhhbmRsZXJTdGF0ZUNoYW5nZSIsImV2ZW50cyIsImdyYW5kQ2hpbGRyZW4iLCJUb3VjaGFibGUiLCJjb2xvciIsImhpdFNsb3AiLCJjb2xsYXBzYWJsZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBQSxLQUFBLEdBQUEsdUJBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxZQUFBLEdBQUEsT0FBQSxDQUFBLGNBQUEsQ0FBQTs7QUFPQSxJQUFBLFNBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSxtQkFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSx1QkFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLDJCQUFBLENBQUEsQ0FBQTs7QUFFQSxJQUFBLE1BQUEsR0FBQSxPQUFBLENBQUEsVUFBQSxDQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVNBLFNBQUEsY0FBQSxDQUFBLElBQUEsRUFFeUU7QUFDdkUsTUFBSUEsWUFBQUEsQ0FBQUEsUUFBQUEsQ0FBQUEsRUFBQUEsS0FBSixLQUFBLEVBQTJCLE9BQUEsSUFBQTtBQUMzQixTQUFPLENBQUEsR0FBQSxZQUFBLENBQUEsY0FBQSxFQUFQLElBQU8sQ0FBUDtBQUNEOztBQUVELDRCQUEyQkUsWUFBQUEsQ0FBM0IsYUFBQSxDQUFRRCxTQUFSO0FBQUEsSUFBUUEsU0FBUixzQ0FBb0IsRUFBcEI7QUFFQSxJQUFNRSxvQkFBb0IsR0FBRztBQUMzQkMsRUFBQUEscUJBQXFCLEVBQUU7QUFB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QSxDQUFBLE9BQUEsRUFBQSxhQUFBLEVBQUEsSUFBQSxDQUFBOztBQTZRMUUsU0FBQSxPQUFBO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQge1xuICBmaW5kTm9kZUhhbmRsZSBhcyBmaW5kTm9kZUhhbmRsZVJOLFxuICBOYXRpdmVNb2R1bGVzLFxuICBQbGF0Zm9ybSxcbiAgVG91Y2hhYmxlLFxufSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuLy8gQHRzLWlnbm9yZSAtIGl0IGlzbid0IHR5cGVkIGJ5IFRTICYgZG9uJ3QgaGF2ZSBkZWZpbml0ZWx5VHlwZWQgdHlwZXNcbmltcG9ydCBkZWVwRXF1YWwgZnJvbSAnZmJqcy9saWIvYXJlRXF1YWwnO1xuaW1wb3J0IFJOR2VzdHVyZUhhbmRsZXJNb2R1bGUgZnJvbSAnLi4vUk5HZXN0dXJlSGFuZGxlck1vZHVsZSc7XG5pbXBvcnQgdHlwZSBSTkdlc3R1cmVIYW5kbGVyTW9kdWxlV2ViIGZyb20gJy4uL1JOR2VzdHVyZUhhbmRsZXJNb2R1bGUud2ViJztcbmltcG9ydCB7IFN0YXRlIH0gZnJvbSAnLi4vU3RhdGUnO1xuXG5pbXBvcnQge1xuICBCYXNlR2VzdHVyZUhhbmRsZXJQcm9wcyxcbiAgR2VzdHVyZUV2ZW50LFxuICBIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudCxcbn0gZnJvbSAnLi9nZXN0dXJlSGFuZGxlcnMnO1xuaW1wb3J0IHsgVmFsdWVPZiB9IGZyb20gJy4uL3R5cGVVdGlscyc7XG5cbmZ1bmN0aW9uIGZpbmROb2RlSGFuZGxlKFxuICBub2RlOiBudWxsIHwgbnVtYmVyIHwgUmVhY3QuQ29tcG9uZW50PGFueSwgYW55PiB8IFJlYWN0LkNvbXBvbmVudENsYXNzPGFueT5cbik6IG51bGwgfCBudW1iZXIgfCBSZWFjdC5Db21wb25lbnQ8YW55LCBhbnk+IHwgUmVhY3QuQ29tcG9uZW50Q2xhc3M8YW55PiB7XG4gIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ3dlYicpIHJldHVybiBub2RlO1xuICByZXR1cm4gZmluZE5vZGVIYW5kbGVSTihub2RlKTtcbn1cblxuY29uc3QgeyBVSU1hbmFnZXIgPSB7fSB9ID0gTmF0aXZlTW9kdWxlcztcblxuY29uc3QgY3VzdG9tR0hFdmVudHNDb25maWcgPSB7XG4gIG9uR2VzdHVyZUhhbmRsZXJFdmVudDogeyByZWdpc3RyYXRpb25OYW1lOiAnb25HZXN0dXJlSGFuZGxlckV2ZW50JyB9LFxuICBvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2U6IHtcbiAgICByZWdpc3RyYXRpb25OYW1lOiAnb25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlJyxcbiAgfSxcbn07XG5cbi8vIEFkZCBnZXN0dXJlIHNwZWNpZmljIGV2ZW50cyB0byBnZW5lcmljRGlyZWN0RXZlbnRUeXBlcyBvYmplY3QgZXhwb3J0ZWQgZnJvbSBVSU1hbmFnZXJcbi8vIG5hdGl2ZSBtb2R1bGUuXG4vLyBPbmNlIG5ldyBldmVudCB0eXBlcyBhcmUgcmVnaXN0ZXJlZCB3aXRoIHJlYWN0IGl0IGlzIHBvc3NpYmxlIHRvIGRpc3BhdGNoIHRoZXNlXG4vLyBldmVudHMgdG8gYWxsIGtpbmQgb2YgbmF0aXZlIHZpZXdzLlxuVUlNYW5hZ2VyLmdlbmVyaWNEaXJlY3RFdmVudFR5cGVzID0ge1xuICAuLi5VSU1hbmFnZXIuZ2VuZXJpY0RpcmVjdEV2ZW50VHlwZXMsXG4gIC4uLmN1c3RvbUdIRXZlbnRzQ29uZmlnLFxufTtcbi8vIEluIG5ld2VyIHZlcnNpb25zIG9mIFJOIHRoZSBgZ2VuZXJpY0RpcmVjdEV2ZW50VHlwZXNgIGlzIGxvY2F0ZWQgaW4gdGhlIG9iamVjdFxuLy8gcmV0dXJuZWQgYnkgVUlNYW5hZ2VyLmdldFZpZXdNYW5hZ2VyQ29uZmlnKCdnZXRDb25zdGFudHMnKSBvciBpbiBvbGRlciBSTiBVSU1hbmFnZXIuZ2V0Q29uc3RhbnRzKCksIHdlIG5lZWQgdG8gYWRkIGl0IHRoZXJlIGFzIHdlbGwgdG8gbWFrZVxuLy8gaXQgY29tcGF0aWJsZSB3aXRoIFJOIDYxK1xuY29uc3QgVUlNYW5hZ2VyQ29uc3RhbnRzID1cbiAgVUlNYW5hZ2VyLmdldFZpZXdNYW5hZ2VyQ29uZmlnPy4oJ2dldENvbnN0YW50cycpID8/XG4gIFVJTWFuYWdlci5nZXRDb25zdGFudHM/LigpO1xuXG5pZiAoVUlNYW5hZ2VyQ29uc3RhbnRzKSB7XG4gIFVJTWFuYWdlckNvbnN0YW50cy5nZW5lcmljRGlyZWN0RXZlbnRUeXBlcyA9IHtcbiAgICAuLi5VSU1hbmFnZXJDb25zdGFudHMuZ2VuZXJpY0RpcmVjdEV2ZW50VHlwZXMsXG4gICAgLi4uY3VzdG9tR0hFdmVudHNDb25maWcsXG4gIH07XG59XG5cbi8vIFdyYXAgSlMgcmVzcG9uZGVyIGNhbGxzIGFuZCBub3RpZnkgZ2VzdHVyZSBoYW5kbGVyIG1hbmFnZXJcbmNvbnN0IHtcbiAgc2V0SlNSZXNwb25kZXI6IG9sZFNldEpTUmVzcG9uZGVyID0gKCkgPT4ge1xuICAgIC8vbm8gb3BlcmF0aW9uXG4gIH0sXG4gIGNsZWFySlNSZXNwb25kZXI6IG9sZENsZWFySlNSZXNwb25kZXIgPSAoKSA9PiB7XG4gICAgLy9ubyBvcGVyYXRpb25cbiAgfSxcbn0gPSBVSU1hbmFnZXI7XG5VSU1hbmFnZXIuc2V0SlNSZXNwb25kZXIgPSAodGFnOiBudW1iZXIsIGJsb2NrTmF0aXZlUmVzcG9uZGVyOiBib29sZWFuKSA9PiB7XG4gIFJOR2VzdHVyZUhhbmRsZXJNb2R1bGUuaGFuZGxlU2V0SlNSZXNwb25kZXIodGFnLCBibG9ja05hdGl2ZVJlc3BvbmRlcik7XG4gIG9sZFNldEpTUmVzcG9uZGVyKHRhZywgYmxvY2tOYXRpdmVSZXNwb25kZXIpO1xufTtcblVJTWFuYWdlci5jbGVhckpTUmVzcG9uZGVyID0gKCkgPT4ge1xuICBSTkdlc3R1cmVIYW5kbGVyTW9kdWxlLmhhbmRsZUNsZWFySlNSZXNwb25kZXIoKTtcbiAgb2xkQ2xlYXJKU1Jlc3BvbmRlcigpO1xufTtcblxubGV0IGhhbmRsZXJUYWcgPSAxO1xuY29uc3QgaGFuZGxlcklEVG9UYWc6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcblxuZnVuY3Rpb24gaXNDb25maWdQYXJhbShwYXJhbTogdW5rbm93biwgbmFtZTogc3RyaW5nKSB7XG4gIC8vIHBhcmFtICE9PSBPYmplY3QocGFyYW0pIHJldHVybnMgZmFsc2UgaWYgYHBhcmFtYCBpcyBhIGZ1bmN0aW9uXG4gIC8vIG9yIGFuIG9iamVjdCBhbmQgcmV0dXJucyB0cnVlIGlmIGBwYXJhbWAgaXMgbnVsbFxuICByZXR1cm4gKFxuICAgIHBhcmFtICE9PSB1bmRlZmluZWQgJiZcbiAgICAocGFyYW0gIT09IE9iamVjdChwYXJhbSkgfHxcbiAgICAgICEoJ19faXNOYXRpdmUnIGluIChwYXJhbSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikpKSAmJlxuICAgIG5hbWUgIT09ICdvbkhhbmRsZXJTdGF0ZUNoYW5nZScgJiZcbiAgICBuYW1lICE9PSAnb25HZXN0dXJlRXZlbnQnXG4gICk7XG59XG5cbmZ1bmN0aW9uIGZpbHRlckNvbmZpZyhcbiAgcHJvcHM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB2YWxpZFByb3BzOiBzdHJpbmdbXSxcbiAgZGVmYXVsdHM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbikge1xuICBjb25zdCByZXMgPSB7IC4uLmRlZmF1bHRzIH07XG4gIHZhbGlkUHJvcHMuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSBwcm9wc1trZXldO1xuICAgIGlmIChpc0NvbmZpZ1BhcmFtKHZhbHVlLCBrZXkpKSB7XG4gICAgICBsZXQgdmFsdWUgPSBwcm9wc1trZXldO1xuICAgICAgaWYgKGtleSA9PT0gJ3NpbXVsdGFuZW91c0hhbmRsZXJzJyB8fCBrZXkgPT09ICd3YWl0Rm9yJykge1xuICAgICAgICB2YWx1ZSA9IHRyYW5zZm9ybUludG9IYW5kbGVyVGFncyhwcm9wc1trZXldKTtcbiAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnaGl0U2xvcCcpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICB2YWx1ZSA9IHsgdG9wOiB2YWx1ZSwgbGVmdDogdmFsdWUsIGJvdHRvbTogdmFsdWUsIHJpZ2h0OiB2YWx1ZSB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXNba2V5XSA9IHZhbHVlO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiByZXM7XG59XG5cbmZ1bmN0aW9uIHRyYW5zZm9ybUludG9IYW5kbGVyVGFncyhoYW5kbGVySURzOiBhbnkpIHtcbiAgaWYgKCFBcnJheS5pc0FycmF5KGhhbmRsZXJJRHMpKSB7XG4gICAgaGFuZGxlcklEcyA9IFtoYW5kbGVySURzXTtcbiAgfVxuXG4gIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ3dlYicpIHtcbiAgICByZXR1cm4gaGFuZGxlcklEc1xuICAgICAgLm1hcCgoeyBjdXJyZW50IH06IHsgY3VycmVudDogYW55IH0pID0+IGN1cnJlbnQpXG4gICAgICAuZmlsdGVyKChoYW5kbGU6IGFueSkgPT4gaGFuZGxlKTtcbiAgfVxuICAvLyBjb252ZXJ0cyBoYW5kbGVyIHN0cmluZyBJRHMgaW50byB0aGVpciBudW1lcmljIHRhZ3NcbiAgcmV0dXJuIGhhbmRsZXJJRHNcbiAgICAubWFwKFxuICAgICAgKGhhbmRsZXJJRDogYW55KSA9PlxuICAgICAgICBoYW5kbGVySURUb1RhZ1toYW5kbGVySURdIHx8IGhhbmRsZXJJRC5jdXJyZW50Py5oYW5kbGVyVGFnIHx8IC0xXG4gICAgKVxuICAgIC5maWx0ZXIoKGhhbmRsZXJUYWc6IG51bWJlcikgPT4gaGFuZGxlclRhZyA+IDApO1xufVxuXG50eXBlIEhhbmRsZXJQcm9wczxUIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4+ID0gUmVhZG9ubHk8XG4gIFJlYWN0LlByb3BzV2l0aENoaWxkcmVuPEJhc2VHZXN0dXJlSGFuZGxlclByb3BzPFQ+PlxuPjtcbmZ1bmN0aW9uIGhhc1VucmVzb2x2ZWRSZWZzPFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4oXG4gIHByb3BzOiBIYW5kbGVyUHJvcHM8VD5cbikge1xuICAvLyBUT0RPKFRTKSAtIGFkZCB0eXBlIGZvciBleHRyYWN0IGFyZ1xuICBjb25zdCBleHRyYWN0ID0gKHJlZnM6IGFueSB8IGFueVtdKSA9PiB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHJlZnMpKSB7XG4gICAgICByZXR1cm4gcmVmcyAmJiByZWZzLmN1cnJlbnQgPT09IG51bGw7XG4gICAgfVxuICAgIHJldHVybiByZWZzLnNvbWUoKHIpID0+IHIgJiYgci5jdXJyZW50ID09PSBudWxsKTtcbiAgfTtcbiAgcmV0dXJuIGV4dHJhY3QocHJvcHNbJ3NpbXVsdGFuZW91c0hhbmRsZXJzJ10pIHx8IGV4dHJhY3QocHJvcHNbJ3dhaXRGb3InXSk7XG59XG5cbmNvbnN0IHN0YXRlVG9Qcm9wTWFwcGluZ3MgPSB7XG4gIFtTdGF0ZS5VTkRFVEVSTUlORURdOiB1bmRlZmluZWQsXG4gIFtTdGF0ZS5CRUdBTl06ICdvbkJlZ2FuJyxcbiAgW1N0YXRlLkZBSUxFRF06ICdvbkZhaWxlZCcsXG4gIFtTdGF0ZS5DQU5DRUxMRURdOiAnb25DYW5jZWxsZWQnLFxuICBbU3RhdGUuQUNUSVZFXTogJ29uQWN0aXZhdGVkJyxcbiAgW1N0YXRlLkVORF06ICdvbkVuZGVkJyxcbn0gYXMgY29uc3Q7XG5cbnR5cGUgQ3JlYXRlSGFuZGxlckFyZ3M8XG4gIEhhbmRsZXJQcm9wc1QgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuPiA9IFJlYWRvbmx5PHtcbiAgbmFtZTogc3RyaW5nO1xuICBhbGxvd2VkUHJvcHM6IFJlYWRvbmx5PEV4dHJhY3Q8a2V5b2YgSGFuZGxlclByb3BzVCwgc3RyaW5nPltdPjtcbiAgY29uZmlnOiBSZWFkb25seTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj47XG4gIHRyYW5zZm9ybVByb3BzPzogKHByb3BzOiBIYW5kbGVyUHJvcHNUKSA9PiBIYW5kbGVyUHJvcHNUO1xuICBjdXN0b21OYXRpdmVQcm9wcz86IFJlYWRvbmx5PHN0cmluZ1tdPjtcbn0+O1xuXG4vLyBUT0RPKFRTKSBmaXggZXZlbnQgdHlwZXNcbnR5cGUgSW50ZXJuYWxFdmVudEhhbmRsZXJzID0ge1xuICBvbkdlc3R1cmVIYW5kbGVyRXZlbnQ/OiAoZXZlbnQ6IGFueSkgPT4gdm9pZDtcbiAgb25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlPzogKGV2ZW50OiBhbnkpID0+IHZvaWQ7XG59O1xuXG4vLyBUT0RPKFRTKSAtIG1ha2Ugc3VyZSB0aGF0IEJhc2VHZXN0dXJlSGFuZGxlclByb3BzIGRvZXNuJ3QgbmVlZCBvdGhlciBnZW5lcmljIHBhcmFtZXRlciB0byB3b3JrIHdpdGggY3VzdG9tIHByb3BlcnRpZXMuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVIYW5kbGVyPFxuICBUIGV4dGVuZHMgQmFzZUdlc3R1cmVIYW5kbGVyUHJvcHM8VT4sXG4gIFUgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuPih7XG4gIG5hbWUsXG4gIGFsbG93ZWRQcm9wcyA9IFtdLFxuICBjb25maWcgPSB7fSxcbiAgdHJhbnNmb3JtUHJvcHMsXG4gIGN1c3RvbU5hdGl2ZVByb3BzID0gW10sXG59OiBDcmVhdGVIYW5kbGVyQXJnczxUPik6IFJlYWN0LkNvbXBvbmVudFR5cGU8VCAmIFJlYWN0LlJlZkF0dHJpYnV0ZXM8YW55Pj4ge1xuICBjbGFzcyBIYW5kbGVyIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFQgJiBJbnRlcm5hbEV2ZW50SGFuZGxlcnM+IHtcbiAgICBzdGF0aWMgZGlzcGxheU5hbWUgPSBuYW1lO1xuXG4gICAgcHJpdmF0ZSBoYW5kbGVyVGFnOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBjb25maWc6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgIHByaXZhdGUgcHJvcHNSZWY6IFJlYWN0Lk11dGFibGVSZWZPYmplY3Q8dW5rbm93bj47XG4gICAgcHJpdmF0ZSB2aWV3Tm9kZTogYW55O1xuICAgIHByaXZhdGUgdmlld1RhZz86IG51bWJlcjtcbiAgICBwcml2YXRlIHVwZGF0ZUVucXVldWVkOiBSZXR1cm5UeXBlPHR5cGVvZiBzZXRJbW1lZGlhdGU+IHwgbnVsbCA9IG51bGw7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogVCAmIEludGVybmFsRXZlbnRIYW5kbGVycykge1xuICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgdGhpcy5oYW5kbGVyVGFnID0gaGFuZGxlclRhZysrO1xuICAgICAgdGhpcy5jb25maWcgPSB7fTtcbiAgICAgIHRoaXMucHJvcHNSZWYgPSBSZWFjdC5jcmVhdGVSZWYoKTtcbiAgICAgIGlmIChwcm9wcy5pZCkge1xuICAgICAgICBpZiAoaGFuZGxlcklEVG9UYWdbcHJvcHMuaWRdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhhbmRsZXIgd2l0aCBJRCBcIiR7cHJvcHMuaWR9XCIgYWxyZWFkeSByZWdpc3RlcmVkYCk7XG4gICAgICAgIH1cbiAgICAgICAgaGFuZGxlcklEVG9UYWdbcHJvcHMuaWRdID0gdGhpcy5oYW5kbGVyVGFnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgY29uc3QgcHJvcHM6IEhhbmRsZXJQcm9wczxVPiA9IHRoaXMucHJvcHM7XG4gICAgICBpZiAoaGFzVW5yZXNvbHZlZFJlZnMocHJvcHMpKSB7XG4gICAgICAgIC8vIElmIHRoZXJlIGFyZSB1bnJlc29sdmVkIHJlZnMgKGUuZy4gXCIuY3VycmVudFwiIGhhcyBub3QgeWV0IGJlZW4gc2V0KVxuICAgICAgICAvLyBwYXNzZWQgYXMgYHNpbXVsdGFuZW91c0hhbmRsZXJzYCBvciBgd2FpdEZvcmAsIHdlIGVucXVldWUgYSBjYWxsIHRvXG4gICAgICAgIC8vIF91cGRhdGUgbWV0aG9kIHRoYXQgd2lsbCB0cnkgdG8gdXBkYXRlIG5hdGl2ZSBoYW5kbGVyIHByb3BzIHVzaW5nXG4gICAgICAgIC8vIHNldEltbWVkaWF0ZS4gVGhpcyBtYWtlcyBpdCBzbyBfdXBkYXRlIGZ1bmN0aW9uIGdldHMgY2FsbGVkIGFmdGVyIGFsbFxuICAgICAgICAvLyByZWFjdCBjb21wb25lbnRzIGFyZSBtb3VudGVkIGFuZCB3ZSBleHBlY3QgdGhlIG1pc3NpbmcgcmVmIG9iamVjdCB0b1xuICAgICAgICAvLyBiZSByZXNvbHZlZCBieSB0aGVuLlxuICAgICAgICB0aGlzLnVwZGF0ZUVucXVldWVkID0gc2V0SW1tZWRpYXRlKCgpID0+IHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZUVucXVldWVkID0gbnVsbDtcbiAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jcmVhdGVHZXN0dXJlSGFuZGxlcihcbiAgICAgICAgZmlsdGVyQ29uZmlnKFxuICAgICAgICAgIHRyYW5zZm9ybVByb3BzID8gdHJhbnNmb3JtUHJvcHModGhpcy5wcm9wcykgOiB0aGlzLnByb3BzLFxuICAgICAgICAgIFsuLi5hbGxvd2VkUHJvcHMsIC4uLmN1c3RvbU5hdGl2ZVByb3BzXSxcbiAgICAgICAgICBjb25maWdcbiAgICAgICAgKVxuICAgICAgKTtcblxuICAgICAgdGhpcy5hdHRhY2hHZXN0dXJlSGFuZGxlcihmaW5kTm9kZUhhbmRsZSh0aGlzLnZpZXdOb2RlKSBhcyBudW1iZXIpOyAvLyBUT0RPKFRTKSAtIGNoZWNrIGlmIHRoaXMgY2FuIGJlIG51bGxcbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgICBjb25zdCB2aWV3VGFnID0gZmluZE5vZGVIYW5kbGUodGhpcy52aWV3Tm9kZSk7XG4gICAgICBpZiAodGhpcy52aWV3VGFnICE9PSB2aWV3VGFnKSB7XG4gICAgICAgIHRoaXMuYXR0YWNoR2VzdHVyZUhhbmRsZXIodmlld1RhZyBhcyBudW1iZXIpOyAvLyBUT0RPKFRTKSAtIGNoZWNrIGludGVyYWN0aW9uIGJldHdlZW4gX3ZpZXdUYWcgJiBmaW5kTm9kZUhhbmRsZVxuICAgICAgfVxuICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgIFJOR2VzdHVyZUhhbmRsZXJNb2R1bGUuZHJvcEdlc3R1cmVIYW5kbGVyKHRoaXMuaGFuZGxlclRhZyk7XG4gICAgICBpZiAodGhpcy51cGRhdGVFbnF1ZXVlZCkge1xuICAgICAgICBjbGVhckltbWVkaWF0ZSh0aGlzLnVwZGF0ZUVucXVldWVkKTtcbiAgICAgIH1cbiAgICAgIC8vIFdlIGNhbid0IHVzZSB0aGlzLnByb3BzLmlkIGRpcmVjdGx5IGR1ZSB0byBUUyBnZW5lcmljIHR5cGUgbmFycm93aW5nIGJ1Zywgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMTM5OTUgZm9yIG1vcmUgY29udGV4dFxuICAgICAgY29uc3QgaGFuZGxlcklEOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB0aGlzLnByb3BzLmlkO1xuICAgICAgaWYgKGhhbmRsZXJJRCkge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWR5bmFtaWMtZGVsZXRlXG4gICAgICAgIGRlbGV0ZSBoYW5kbGVySURUb1RhZ1toYW5kbGVySURdO1xuICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgb25HZXN0dXJlSGFuZGxlckV2ZW50ID0gKGV2ZW50OiBHZXN0dXJlRXZlbnQ8VT4pID0+IHtcbiAgICAgIGlmIChldmVudC5uYXRpdmVFdmVudC5oYW5kbGVyVGFnID09PSB0aGlzLmhhbmRsZXJUYWcpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkdlc3R1cmVFdmVudD8uKGV2ZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucHJvcHMub25HZXN0dXJlSGFuZGxlckV2ZW50Py4oZXZlbnQpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBUT0RPKFRTKSAtIG1ha2Ugc3VyZSB0aGlzIGlzIHJpZ2h0IHR5cGUgZm9yIGV2ZW50XG4gICAgcHJpdmF0ZSBvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UgPSAoXG4gICAgICBldmVudDogSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnQ8VT5cbiAgICApID0+IHtcbiAgICAgIGlmIChldmVudC5uYXRpdmVFdmVudC5oYW5kbGVyVGFnID09PSB0aGlzLmhhbmRsZXJUYWcpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkhhbmRsZXJTdGF0ZUNoYW5nZT8uKGV2ZW50KTtcblxuICAgICAgICBjb25zdCBzdGF0ZTogVmFsdWVPZjx0eXBlb2YgU3RhdGU+ID0gZXZlbnQubmF0aXZlRXZlbnQuc3RhdGU7XG4gICAgICAgIGNvbnN0IHN0YXRlRXZlbnROYW1lID0gc3RhdGVUb1Byb3BNYXBwaW5nc1tzdGF0ZV07XG4gICAgICAgIGNvbnN0IGV2ZW50SGFuZGxlciA9IHN0YXRlRXZlbnROYW1lICYmIHRoaXMucHJvcHNbc3RhdGVFdmVudE5hbWVdO1xuICAgICAgICBpZiAoZXZlbnRIYW5kbGVyICYmIHR5cGVvZiBldmVudEhhbmRsZXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBldmVudEhhbmRsZXIoZXZlbnQpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnByb3BzLm9uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZT8uKGV2ZW50KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSByZWZIYW5kbGVyID0gKG5vZGU6IGFueSkgPT4ge1xuICAgICAgdGhpcy52aWV3Tm9kZSA9IG5vZGU7XG5cbiAgICAgIGNvbnN0IGNoaWxkID0gUmVhY3QuQ2hpbGRyZW4ub25seSh0aGlzLnByb3BzLmNoaWxkcmVuKTtcbiAgICAgIC8vIFRPRE8oVFMpIGZpeCByZWYgdHlwZVxuICAgICAgY29uc3QgeyByZWYgfTogYW55ID0gY2hpbGQ7XG4gICAgICBpZiAocmVmICE9PSBudWxsKSB7XG4gICAgICAgIGlmICh0eXBlb2YgcmVmID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgcmVmKG5vZGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlZi5jdXJyZW50ID0gbm9kZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIGNyZWF0ZUdlc3R1cmVIYW5kbGVyID0gKFxuICAgICAgbmV3Q29uZmlnOiBSZWFkb25seTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj5cbiAgICApID0+IHtcbiAgICAgIHRoaXMuY29uZmlnID0gbmV3Q29uZmlnO1xuXG4gICAgICBSTkdlc3R1cmVIYW5kbGVyTW9kdWxlLmNyZWF0ZUdlc3R1cmVIYW5kbGVyKFxuICAgICAgICBuYW1lLFxuICAgICAgICB0aGlzLmhhbmRsZXJUYWcsXG4gICAgICAgIG5ld0NvbmZpZ1xuICAgICAgKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBhdHRhY2hHZXN0dXJlSGFuZGxlciA9IChuZXdWaWV3VGFnOiBudW1iZXIpID0+IHtcbiAgICAgIHRoaXMudmlld1RhZyA9IG5ld1ZpZXdUYWc7XG5cbiAgICAgIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ3dlYicpIHtcbiAgICAgICAgLy8gdHlwZWNhc3QgZHVlIHRvIGR5bmFtaWMgcmVzb2x1dGlvbiwgYXR0YWNoR2VzdHVyZUhhbmRsZXIgc2hvdWxkIGhhdmUgd2ViIHZlcnNpb24gc2lnbmF0dXJlIGluIHRoaXMgYnJhbmNoXG4gICAgICAgIChSTkdlc3R1cmVIYW5kbGVyTW9kdWxlLmF0dGFjaEdlc3R1cmVIYW5kbGVyIGFzIHR5cGVvZiBSTkdlc3R1cmVIYW5kbGVyTW9kdWxlV2ViLmF0dGFjaEdlc3R1cmVIYW5kbGVyKShcbiAgICAgICAgICB0aGlzLmhhbmRsZXJUYWcsXG4gICAgICAgICAgbmV3Vmlld1RhZyxcbiAgICAgICAgICB0aGlzLnByb3BzUmVmXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBSTkdlc3R1cmVIYW5kbGVyTW9kdWxlLmF0dGFjaEdlc3R1cmVIYW5kbGVyKFxuICAgICAgICAgIHRoaXMuaGFuZGxlclRhZyxcbiAgICAgICAgICBuZXdWaWV3VGFnXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgdXBkYXRlR2VzdHVyZUhhbmRsZXIgPSAoXG4gICAgICBuZXdDb25maWc6IFJlYWRvbmx5PFJlY29yZDxzdHJpbmcsIHVua25vd24+PlxuICAgICkgPT4ge1xuICAgICAgdGhpcy5jb25maWcgPSBuZXdDb25maWc7XG5cbiAgICAgIFJOR2VzdHVyZUhhbmRsZXJNb2R1bGUudXBkYXRlR2VzdHVyZUhhbmRsZXIodGhpcy5oYW5kbGVyVGFnLCBuZXdDb25maWcpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIHVwZGF0ZSgpIHtcbiAgICAgIGNvbnN0IG5ld0NvbmZpZyA9IGZpbHRlckNvbmZpZyhcbiAgICAgICAgdHJhbnNmb3JtUHJvcHMgPyB0cmFuc2Zvcm1Qcm9wcyh0aGlzLnByb3BzKSA6IHRoaXMucHJvcHMsXG4gICAgICAgIFsuLi5hbGxvd2VkUHJvcHMsIC4uLmN1c3RvbU5hdGl2ZVByb3BzXSxcbiAgICAgICAgY29uZmlnXG4gICAgICApO1xuICAgICAgaWYgKCFkZWVwRXF1YWwodGhpcy5jb25maWcsIG5ld0NvbmZpZykpIHtcbiAgICAgICAgdGhpcy51cGRhdGVHZXN0dXJlSGFuZGxlcihuZXdDb25maWcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHNldE5hdGl2ZVByb3BzKHVwZGF0ZXM6IGFueSkge1xuICAgICAgY29uc3QgbWVyZ2VkUHJvcHMgPSB7IC4uLnRoaXMucHJvcHMsIC4uLnVwZGF0ZXMgfTtcbiAgICAgIGNvbnN0IG5ld0NvbmZpZyA9IGZpbHRlckNvbmZpZyhcbiAgICAgICAgdHJhbnNmb3JtUHJvcHMgPyB0cmFuc2Zvcm1Qcm9wcyhtZXJnZWRQcm9wcykgOiBtZXJnZWRQcm9wcyxcbiAgICAgICAgWy4uLmFsbG93ZWRQcm9wcywgLi4uY3VzdG9tTmF0aXZlUHJvcHNdLFxuICAgICAgICBjb25maWdcbiAgICAgICk7XG4gICAgICB0aGlzLnVwZGF0ZUdlc3R1cmVIYW5kbGVyKG5ld0NvbmZpZyk7XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgbGV0IGdlc3R1cmVFdmVudEhhbmRsZXIgPSB0aGlzLm9uR2VzdHVyZUhhbmRsZXJFdmVudDtcbiAgICAgIC8vIEFub3RoZXIgaW5zdGFuY2Ugb2YgaHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC9UeXBlU2NyaXB0L2lzc3Vlcy8xMzk5NVxuICAgICAgdHlwZSBPbkdlc3R1cmVFdmVudEhhbmRsZXJzID0ge1xuICAgICAgICBvbkdlc3R1cmVFdmVudD86IEJhc2VHZXN0dXJlSGFuZGxlclByb3BzPFU+Wydvbkdlc3R1cmVFdmVudCddO1xuICAgICAgICBvbkdlc3R1cmVIYW5kbGVyRXZlbnQ/OiBJbnRlcm5hbEV2ZW50SGFuZGxlcnNbJ29uR2VzdHVyZUhhbmRsZXJFdmVudCddO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgb25HZXN0dXJlRXZlbnQsXG4gICAgICAgIG9uR2VzdHVyZUhhbmRsZXJFdmVudCxcbiAgICAgIH06IE9uR2VzdHVyZUV2ZW50SGFuZGxlcnMgPSB0aGlzLnByb3BzO1xuICAgICAgaWYgKG9uR2VzdHVyZUV2ZW50ICYmIHR5cGVvZiBvbkdlc3R1cmVFdmVudCAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAvLyBJZiBpdCdzIG5vdCBhIG1ldGhvZCBpdCBzaG91bGQgYmUgYW4gbmF0aXZlIEFuaW1hdGVkLmV2ZW50XG4gICAgICAgIC8vIG9iamVjdC4gV2Ugc2V0IGl0IGRpcmVjdGx5IGFzIHRoZSBoYW5kbGVyIGZvciB0aGUgdmlld1xuICAgICAgICAvLyBJbiB0aGlzIGNhc2UgbmVzdGVkIGhhbmRsZXJzIGFyZSBub3QgZ29pbmcgdG8gYmUgc3VwcG9ydGVkXG4gICAgICAgIGlmIChvbkdlc3R1cmVIYW5kbGVyRXZlbnQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnTmVzdGluZyB0b3VjaCBoYW5kbGVycyB3aXRoIG5hdGl2ZSBhbmltYXRlZCBkcml2ZXIgaXMgbm90IHN1cHBvcnRlZCB5ZXQnXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBnZXN0dXJlRXZlbnRIYW5kbGVyID0gb25HZXN0dXJlRXZlbnQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgb25HZXN0dXJlSGFuZGxlckV2ZW50ICYmXG4gICAgICAgICAgdHlwZW9mIG9uR2VzdHVyZUhhbmRsZXJFdmVudCAhPT0gJ2Z1bmN0aW9uJ1xuICAgICAgICApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnTmVzdGluZyB0b3VjaCBoYW5kbGVycyB3aXRoIG5hdGl2ZSBhbmltYXRlZCBkcml2ZXIgaXMgbm90IHN1cHBvcnRlZCB5ZXQnXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBsZXQgZ2VzdHVyZVN0YXRlRXZlbnRIYW5kbGVyID0gdGhpcy5vbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2U7XG4gICAgICAvLyBBbm90aGVyIGluc3RhbmNlIG9mIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMTM5OTVcbiAgICAgIHR5cGUgT25HZXN0dXJlU3RhdGVDaGFuZ2VIYW5kbGVycyA9IHtcbiAgICAgICAgb25IYW5kbGVyU3RhdGVDaGFuZ2U/OiBCYXNlR2VzdHVyZUhhbmRsZXJQcm9wczxVPlsnb25IYW5kbGVyU3RhdGVDaGFuZ2UnXTtcbiAgICAgICAgb25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlPzogSW50ZXJuYWxFdmVudEhhbmRsZXJzWydvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UnXTtcbiAgICAgIH07XG4gICAgICBjb25zdCB7XG4gICAgICAgIG9uSGFuZGxlclN0YXRlQ2hhbmdlLFxuICAgICAgICBvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UsXG4gICAgICB9OiBPbkdlc3R1cmVTdGF0ZUNoYW5nZUhhbmRsZXJzID0gdGhpcy5wcm9wcztcbiAgICAgIGlmIChvbkhhbmRsZXJTdGF0ZUNoYW5nZSAmJiB0eXBlb2Ygb25IYW5kbGVyU3RhdGVDaGFuZ2UgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgLy8gSWYgaXQncyBub3QgYSBtZXRob2QgaXQgc2hvdWxkIGJlIGFuIG5hdGl2ZSBBbmltYXRlZC5ldmVudFxuICAgICAgICAvLyBvYmplY3QuIFdlIHNldCBpdCBkaXJlY3RseSBhcyB0aGUgaGFuZGxlciBmb3IgdGhlIHZpZXdcbiAgICAgICAgLy8gSW4gdGhpcyBjYXNlIG5lc3RlZCBoYW5kbGVycyBhcmUgbm90IGdvaW5nIHRvIGJlIHN1cHBvcnRlZFxuICAgICAgICBpZiAob25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgJ05lc3RpbmcgdG91Y2ggaGFuZGxlcnMgd2l0aCBuYXRpdmUgYW5pbWF0ZWQgZHJpdmVyIGlzIG5vdCBzdXBwb3J0ZWQgeWV0J1xuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgZ2VzdHVyZVN0YXRlRXZlbnRIYW5kbGVyID0gb25IYW5kbGVyU3RhdGVDaGFuZ2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgb25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlICYmXG4gICAgICAgICAgdHlwZW9mIG9uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZSAhPT0gJ2Z1bmN0aW9uJ1xuICAgICAgICApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnTmVzdGluZyB0b3VjaCBoYW5kbGVycyB3aXRoIG5hdGl2ZSBhbmltYXRlZCBkcml2ZXIgaXMgbm90IHN1cHBvcnRlZCB5ZXQnXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc3QgZXZlbnRzID0ge1xuICAgICAgICBvbkdlc3R1cmVIYW5kbGVyRXZlbnQ6IGdlc3R1cmVFdmVudEhhbmRsZXIsXG4gICAgICAgIG9uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZTogZ2VzdHVyZVN0YXRlRXZlbnRIYW5kbGVyLFxuICAgICAgfTtcblxuICAgICAgdGhpcy5wcm9wc1JlZi5jdXJyZW50ID0gZXZlbnRzO1xuXG4gICAgICBjb25zdCBjaGlsZDogYW55ID0gUmVhY3QuQ2hpbGRyZW4ub25seSh0aGlzLnByb3BzLmNoaWxkcmVuKTtcbiAgICAgIGxldCBncmFuZENoaWxkcmVuID0gY2hpbGQucHJvcHMuY2hpbGRyZW47XG4gICAgICBpZiAoXG4gICAgICAgIFRvdWNoYWJsZS5UT1VDSF9UQVJHRVRfREVCVUcgJiZcbiAgICAgICAgY2hpbGQudHlwZSAmJlxuICAgICAgICAoY2hpbGQudHlwZSA9PT0gJ1JOR2VzdHVyZUhhbmRsZXJCdXR0b24nIHx8XG4gICAgICAgICAgY2hpbGQudHlwZS5uYW1lID09PSAnVmlldycgfHxcbiAgICAgICAgICBjaGlsZC50eXBlLmRpc3BsYXlOYW1lID09PSAnVmlldycpXG4gICAgICApIHtcbiAgICAgICAgZ3JhbmRDaGlsZHJlbiA9IFJlYWN0LkNoaWxkcmVuLnRvQXJyYXkoZ3JhbmRDaGlsZHJlbik7XG4gICAgICAgIGdyYW5kQ2hpbGRyZW4ucHVzaChcbiAgICAgICAgICBUb3VjaGFibGUucmVuZGVyRGVidWdWaWV3KHtcbiAgICAgICAgICAgIGNvbG9yOiAnbWVkaXVtc3ByaW5nZ3JlZW4nLFxuICAgICAgICAgICAgaGl0U2xvcDogY2hpbGQucHJvcHMuaGl0U2xvcCxcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gUmVhY3QuY2xvbmVFbGVtZW50KFxuICAgICAgICBjaGlsZCxcbiAgICAgICAge1xuICAgICAgICAgIHJlZjogdGhpcy5yZWZIYW5kbGVyLFxuICAgICAgICAgIGNvbGxhcHNhYmxlOiBmYWxzZSxcbiAgICAgICAgICAuLi5ldmVudHMsXG4gICAgICAgIH0sXG4gICAgICAgIGdyYW5kQ2hpbGRyZW5cbiAgICAgICk7XG4gICAgfVxuICB9XG4gIHJldHVybiBIYW5kbGVyO1xufVxuIl19