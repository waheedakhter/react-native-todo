86fc36342a2aab85aa058af374d8a7c9
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = getActionFromState;

function getActionFromState(state, options) {
  var _state$index, _normalizedConfig$scr;

  var normalizedConfig = options ? createNormalizedConfigItem(options) : {};
  var routes = state.index != null ? state.routes.slice(0, state.index + 1) : state.routes;

  if (routes.length === 0) {
    return undefined;
  }

  if (!(routes.length === 1 && routes[0].key === undefined || routes.length === 2 && routes[0].key === undefined && routes[0].name === (normalizedConfig === null || normalizedConfig === void 0 ? void 0 : normalizedConfig.initialRouteName) && routes[1].key === undefined)) {
    return {
      type: 'RESET',
      payload: state
    };
  }

  var route = state.routes[(_state$index = state.index) !== null && _state$index !== void 0 ? _state$index : state.routes.length - 1];
  var current = route === null || route === void 0 ? void 0 : route.state;
  var config = normalizedConfig === null || normalizedConfig === void 0 ? void 0 : (_normalizedConfig$scr = normalizedConfig.screens) === null || _normalizedConfig$scr === void 0 ? void 0 : _normalizedConfig$scr[route === null || route === void 0 ? void 0 : route.name];
  var params = (0, _extends2.default)({}, route.params);
  var payload = route ? {
    name: route.name,
    params: params
  } : undefined;

  while (current) {
    var _config, _config2, _config2$screens;

    if (current.routes.length === 0) {
      return undefined;
    }

    var _routes = current.index != null ? current.routes.slice(0, current.index + 1) : current.routes;

    var _route = _routes[_routes.length - 1];
    (0, _extends2.default)(params, {
      initial: undefined,
      screen: undefined,
      params: undefined,
      state: undefined
    });

    if (_routes.length === 1 && _routes[0].key === undefined) {
      params.initial = true;
      params.screen = _route.name;
    } else if (_routes.length === 2 && _routes[0].key === undefined && _routes[0].name === ((_config = config) === null || _config === void 0 ? void 0 : _config.initialRouteName) && _routes[1].key === undefined) {
      params.initial = false;
      params.screen = _route.name;
    } else {
      params.state = current;
      break;
    }

    if (_route.state) {
      params.params = (0, _extends2.default)({}, _route.params);
      params = params.params;
    } else {
      params.params = _route.params;
    }

    current = _route.state;
    config = (_config2 = config) === null || _config2 === void 0 ? void 0 : (_config2$screens = _config2.screens) === null || _config2$screens === void 0 ? void 0 : _config2$screens[_route.name];
  }

  if (!payload) {
    return;
  }

  return {
    type: 'NAVIGATE',
    payload: payload
  };
}

var createNormalizedConfigItem = function createNormalizedConfigItem(config) {
  return typeof config === 'object' && config != null ? {
    initialRouteName: config.initialRouteName,
    screens: config.screens != null ? createNormalizedConfigs(config.screens) : undefined
  } : {};
};

var createNormalizedConfigs = function createNormalizedConfigs(options) {
  return Object.entries(options).reduce(function (acc, _ref) {
    var _ref2 = (0, _slicedToArray2.default)(_ref, 2),
        k = _ref2[0],
        v = _ref2[1];

    acc[k] = createNormalizedConfigItem(v);
    return acc;
  }, {});
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdldEFjdGlvbkZyb21TdGF0ZS50c3giXSwibmFtZXMiOlsibm9ybWFsaXplZENvbmZpZyIsIm9wdGlvbnMiLCJjcmVhdGVOb3JtYWxpemVkQ29uZmlnSXRlbSIsInJvdXRlcyIsInN0YXRlIiwidHlwZSIsInBheWxvYWQiLCJyb3V0ZSIsImN1cnJlbnQiLCJjb25maWciLCJwYXJhbXMiLCJuYW1lIiwiT2JqZWN0IiwiaW5pdGlhbCIsInNjcmVlbiIsInVuZGVmaW5lZCIsImluaXRpYWxSb3V0ZU5hbWUiLCJzY3JlZW5zIiwiY3JlYXRlTm9ybWFsaXplZENvbmZpZ3MiLCJhY2MiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUF5QmUsU0FBQSxrQkFBQSxDQUFBLEtBQUEsRUFBQSxPQUFBLEVBR3VEO0FBQUEsTUFBQSxZQUFBLEVBQUEscUJBQUE7O0FBRXBFLE1BQU1BLGdCQUFnQixHQUFHQyxPQUFPLEdBQUdDLDBCQUEwQixDQUE3QixPQUE2QixDQUE3QixHQUFoQyxFQUFBO0FBRUEsTUFBTUMsTUFBTSxHQUNWQyxLQUFLLENBQUxBLEtBQUFBLElBQUFBLElBQUFBLEdBQXNCQSxLQUFLLENBQUxBLE1BQUFBLENBQUFBLEtBQUFBLENBQUFBLENBQUFBLEVBQXNCQSxLQUFLLENBQUxBLEtBQUFBLEdBQTVDQSxDQUFzQkEsQ0FBdEJBLEdBQStEQSxLQUFLLENBRHRFLE1BQUE7O0FBR0EsTUFBSUQsTUFBTSxDQUFOQSxNQUFBQSxLQUFKLENBQUEsRUFBeUI7QUFDdkIsV0FBQSxTQUFBO0FBQ0Q7O0FBRUQsTUFDRSxFQUNHQSxNQUFNLENBQU5BLE1BQUFBLEtBQUFBLENBQUFBLElBQXVCQSxNQUFNLENBQU5BLENBQU0sQ0FBTkEsQ0FBQUEsR0FBQUEsS0FBeEIsU0FBQ0EsSUFDQUEsTUFBTSxDQUFOQSxNQUFBQSxLQUFBQSxDQUFBQSxJQUNDQSxNQUFNLENBQU5BLENBQU0sQ0FBTkEsQ0FBQUEsR0FBQUEsS0FEREEsU0FBQUEsSUFFQ0EsTUFBTSxDQUFOQSxD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QUFBLEVBQWM7QUFDWjtBQXpGa0U7O0FBOEZwRSxTQUFPO0FBQ0xKLElBQUFBLElBQUksRUFEQyxVQUFBO0FBRUxDLElBQUFBLE9BQUFBLEVBQUFBO0FBRkssR0FBUDtBQUlEOztBQUVELElBQU1KLDBCQUEwQixHQUFJTyxTQUE5QlAsMEJBQThCTyxDQUFBQSxNQUFEO0FBQUEsU0FDakMsT0FBQSxNQUFBLEtBQUEsUUFBQSxJQUE4QkEsTUFBTSxJQUFwQyxJQUFBLEdBQ0k7QUFDRU8sSUFBQUEsZ0JBQWdCLEVBQUVQLE1BQU0sQ0FEMUIsZ0JBQUE7QUFFRVEsSUFBQUEsT0FBTyxFQUNMUixNQUFNLENBQU5BLE9BQUFBLElBQUFBLElBQUFBLEdBQ0lTLHVCQUF1QixDQUFDVCxNQUFNLENBRGxDQSxPQUMyQixDQUQzQkEsR0FFSU07QUFMUixHQURKLEdBREYsRUFBbUM7QUFBQSxDQUFuQzs7QUFXQSxJQUFNRyx1QkFBdUIsR0FBSWpCLFNBQTNCaUIsdUJBQTJCakIsQ0FBQUEsT0FBRDtBQUFBLFNBQzlCLE1BQU0sQ0FBTixPQUFBLENBQUEsT0FBQSxFQUFBLE1BQUEsQ0FBMkQsVUFBQSxHQUFBLFFBQWlCO0FBQUE7QUFBQSxRQUFYLENBQVc7QUFBQSxRQUFqQixDQUFpQjs7QUFDMUVrQixJQUFBQSxHQUFHLENBQUhBLENBQUcsQ0FBSEEsR0FBU2pCLDBCQUEwQixDQUFuQ2lCLENBQW1DLENBQW5DQTtBQUNBLFdBQUEsR0FBQTtBQUZGLEdBQUEsRUFERixFQUNFLENBRDhCO0FBQUEsQ0FBaEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7XG4gIFJvdXRlLFxuICBQYXJ0aWFsUm91dGUsXG4gIFBhcmFtTGlzdEJhc2UsXG4gIE5hdmlnYXRpb25TdGF0ZSxcbiAgUGFydGlhbFN0YXRlLFxuICBDb21tb25BY3Rpb25zLFxufSBmcm9tICdAcmVhY3QtbmF2aWdhdGlvbi9yb3V0ZXJzJztcbmltcG9ydCB0eXBlIHsgUGF0aENvbmZpZywgUGF0aENvbmZpZ01hcCwgTmF2aWdhdG9yU2NyZWVuUGFyYW1zIH0gZnJvbSAnLi90eXBlcyc7XG5cbnR5cGUgQ29uZmlnSXRlbSA9IHtcbiAgaW5pdGlhbFJvdXRlTmFtZT86IHN0cmluZztcbiAgc2NyZWVucz86IFJlY29yZDxzdHJpbmcsIENvbmZpZ0l0ZW0+O1xufTtcblxudHlwZSBPcHRpb25zID0geyBpbml0aWFsUm91dGVOYW1lPzogc3RyaW5nOyBzY3JlZW5zOiBQYXRoQ29uZmlnTWFwIH07XG5cbnR5cGUgTmF2aWdhdGVBY3Rpb248U3RhdGUgZXh0ZW5kcyBOYXZpZ2F0aW9uU3RhdGU+ID0ge1xuICB0eXBlOiAnTkFWSUdBVEUnO1xuICBwYXlsb2FkOiB7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHBhcmFtcz86IE5hdmlnYXRvclNjcmVlblBhcmFtczxTdGF0ZT47XG4gIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBnZXRBY3Rpb25Gcm9tU3RhdGUoXG4gIHN0YXRlOiBQYXJ0aWFsU3RhdGU8TmF2aWdhdGlvblN0YXRlPixcbiAgb3B0aW9ucz86IE9wdGlvbnNcbik6IE5hdmlnYXRlQWN0aW9uPE5hdmlnYXRpb25TdGF0ZT4gfCBDb21tb25BY3Rpb25zLkFjdGlvbiB8IHVuZGVmaW5lZCB7XG4gIC8vIENyZWF0ZSBhIG5vcm1hbGl6ZWQgY29uZmlncyBvYmplY3Qgd2hpY2ggd2lsbCBiZSBlYXNpZXIgdG8gdXNlXG4gIGNvbnN0IG5vcm1hbGl6ZWRDb25maWcgPSBvcHRpb25zID8gY3JlYXRlTm9ybWFsaXplZENvbmZpZ0l0ZW0ob3B0aW9ucykgOiB7fTtcblxuICBjb25zdCByb3V0ZXMgPVxuICAgIHN0YXRlLmluZGV4ICE9IG51bGwgPyBzdGF0ZS5yb3V0ZXMuc2xpY2UoMCwgc3RhdGUuaW5kZXggKyAxKSA6IHN0YXRlLnJvdXRlcztcblxuICBpZiAocm91dGVzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBpZiAoXG4gICAgIShcbiAgICAgIChyb3V0ZXMubGVuZ3RoID09PSAxICYmIHJvdXRlc1swXS5rZXkgPT09IHVuZGVmaW5lZCkgfHxcbiAgICAgIChyb3V0ZXMubGVuZ3RoID09PSAyICYmXG4gICAgICAgIHJvdXRlc1swXS5rZXkgPT09IHVuZGVmaW5lZCAmJlxuICAgICAgICByb3V0ZXNbMF0ubmFtZSA9PT0gbm9ybWFsaXplZENvbmZpZz8uaW5pdGlhbFJvdXRlTmFtZSAmJlxuICAgICAgICByb3V0ZXNbMV0ua2V5ID09PSB1bmRlZmluZWQpXG4gICAgKVxuICApIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ1JFU0VUJyxcbiAgICAgIHBheWxvYWQ6IHN0YXRlLFxuICAgIH07XG4gIH1cblxuICBjb25zdCByb3V0ZSA9IHN0YXRlLnJvdXRlc1tzdGF0ZS5pbmRleCA/PyBzdGF0ZS5yb3V0ZXMubGVuZ3RoIC0gMV07XG5cbiAgbGV0IGN1cnJlbnQ6IFBhcnRpYWxTdGF0ZTxOYXZpZ2F0aW9uU3RhdGU+IHwgdW5kZWZpbmVkID0gcm91dGU/LnN0YXRlO1xuICBsZXQgY29uZmlnOiBDb25maWdJdGVtIHwgdW5kZWZpbmVkID0gbm9ybWFsaXplZENvbmZpZz8uc2NyZWVucz8uW3JvdXRlPy5uYW1lXTtcbiAgbGV0IHBhcmFtcyA9IHsgLi4ucm91dGUucGFyYW1zIH0gYXMgTmF2aWdhdG9yU2NyZWVuUGFyYW1zPFxuICAgIFBhcmFtTGlzdEJhc2UsXG4gICAgTmF2aWdhdGlvblN0YXRlXG4gID47XG5cbiAgbGV0IHBheWxvYWQgPSByb3V0ZSA/IHsgbmFtZTogcm91dGUubmFtZSwgcGFyYW1zIH0gOiB1bmRlZmluZWQ7XG5cbiAgd2hpbGUgKGN1cnJlbnQpIHtcbiAgICBpZiAoY3VycmVudC5yb3V0ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGNvbnN0IHJvdXRlcyA9XG4gICAgICBjdXJyZW50LmluZGV4ICE9IG51bGxcbiAgICAgICAgPyBjdXJyZW50LnJvdXRlcy5zbGljZSgwLCBjdXJyZW50LmluZGV4ICsgMSlcbiAgICAgICAgOiBjdXJyZW50LnJvdXRlcztcblxuICAgIGNvbnN0IHJvdXRlOiBSb3V0ZTxzdHJpbmc+IHwgUGFydGlhbFJvdXRlPFJvdXRlPHN0cmluZz4+ID1cbiAgICAgIHJvdXRlc1tyb3V0ZXMubGVuZ3RoIC0gMV07XG5cbiAgICAvLyBFeHBsaWNpdGx5IHNldCB0byBvdmVycmlkZSBleGlzdGluZyB2YWx1ZSB3aGVuIG1lcmdpbmcgcGFyYW1zXG4gICAgT2JqZWN0LmFzc2lnbihwYXJhbXMsIHtcbiAgICAgIGluaXRpYWw6IHVuZGVmaW5lZCxcbiAgICAgIHNjcmVlbjogdW5kZWZpbmVkLFxuICAgICAgcGFyYW1zOiB1bmRlZmluZWQsXG4gICAgICBzdGF0ZTogdW5kZWZpbmVkLFxuICAgIH0pO1xuXG4gICAgaWYgKHJvdXRlcy5sZW5ndGggPT09IDEgJiYgcm91dGVzWzBdLmtleSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBwYXJhbXMuaW5pdGlhbCA9IHRydWU7XG4gICAgICBwYXJhbXMuc2NyZWVuID0gcm91dGUubmFtZTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgcm91dGVzLmxlbmd0aCA9PT0gMiAmJlxuICAgICAgcm91dGVzWzBdLmtleSA9PT0gdW5kZWZpbmVkICYmXG4gICAgICByb3V0ZXNbMF0ubmFtZSA9PT0gY29uZmlnPy5pbml0aWFsUm91dGVOYW1lICYmXG4gICAgICByb3V0ZXNbMV0ua2V5ID09PSB1bmRlZmluZWRcbiAgICApIHtcbiAgICAgIHBhcmFtcy5pbml0aWFsID0gZmFsc2U7XG4gICAgICBwYXJhbXMuc2NyZWVuID0gcm91dGUubmFtZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcGFyYW1zLnN0YXRlID0gY3VycmVudDtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIGlmIChyb3V0ZS5zdGF0ZSkge1xuICAgICAgcGFyYW1zLnBhcmFtcyA9IHsgLi4ucm91dGUucGFyYW1zIH07XG4gICAgICBwYXJhbXMgPSBwYXJhbXMucGFyYW1zIGFzIE5hdmlnYXRvclNjcmVlblBhcmFtczxcbiAgICAgICAgUGFyYW1MaXN0QmFzZSxcbiAgICAgICAgTmF2aWdhdGlvblN0YXRlXG4gICAgICA+O1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXJhbXMucGFyYW1zID0gcm91dGUucGFyYW1zO1xuICAgIH1cblxuICAgIGN1cnJlbnQgPSByb3V0ZS5zdGF0ZTtcbiAgICBjb25maWcgPSBjb25maWc/LnNjcmVlbnM/Lltyb3V0ZS5uYW1lXTtcbiAgfVxuXG4gIGlmICghcGF5bG9hZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIFRyeSB0byBjb25zdHJ1Y3QgcGF5bG9hZCBmb3IgYSBgTkFWSUdBVEVgIGFjdGlvbiBmcm9tIHRoZSBzdGF0ZVxuICAvLyBUaGlzIGxldHMgdXMgcHJlc2VydmUgdGhlIG5hdmlnYXRpb24gc3RhdGUgYW5kIG5vdCBsb3NlIGl0XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ05BVklHQVRFJyxcbiAgICBwYXlsb2FkLFxuICB9O1xufVxuXG5jb25zdCBjcmVhdGVOb3JtYWxpemVkQ29uZmlnSXRlbSA9IChjb25maWc6IFBhdGhDb25maWcgfCBzdHJpbmcpID0+XG4gIHR5cGVvZiBjb25maWcgPT09ICdvYmplY3QnICYmIGNvbmZpZyAhPSBudWxsXG4gICAgPyB7XG4gICAgICAgIGluaXRpYWxSb3V0ZU5hbWU6IGNvbmZpZy5pbml0aWFsUm91dGVOYW1lLFxuICAgICAgICBzY3JlZW5zOlxuICAgICAgICAgIGNvbmZpZy5zY3JlZW5zICE9IG51bGxcbiAgICAgICAgICAgID8gY3JlYXRlTm9ybWFsaXplZENvbmZpZ3MoY29uZmlnLnNjcmVlbnMpXG4gICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgIH1cbiAgICA6IHt9O1xuXG5jb25zdCBjcmVhdGVOb3JtYWxpemVkQ29uZmlncyA9IChvcHRpb25zOiBQYXRoQ29uZmlnTWFwKSA9PlxuICBPYmplY3QuZW50cmllcyhvcHRpb25zKS5yZWR1Y2U8UmVjb3JkPHN0cmluZywgQ29uZmlnSXRlbT4+KChhY2MsIFtrLCB2XSkgPT4ge1xuICAgIGFjY1trXSA9IGNyZWF0ZU5vcm1hbGl6ZWRDb25maWdJdGVtKHYpO1xuICAgIHJldHVybiBhY2M7XG4gIH0sIHt9KTtcbiJdfQ==