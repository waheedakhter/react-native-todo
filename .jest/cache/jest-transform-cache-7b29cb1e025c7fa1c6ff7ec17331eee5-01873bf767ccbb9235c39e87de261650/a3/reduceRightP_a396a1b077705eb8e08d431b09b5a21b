1d0d5ef4dd3ec47fe756e3db87b601ff
"use strict";

exports.__esModule = true;
exports["default"] = void 0;

var _ramda = require("ramda");

var _isUndefined = _interopRequireDefault(require("./isUndefined"));

var _resolveP = _interopRequireDefault(require("./resolveP"));

var _allP = _interopRequireDefault(require("./allP"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    "default": obj
  };
}

function _slicedToArray(arr, i) {
  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();
}

function _nonIterableRest() {
  throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}

function _unsupportedIterableToArray(o, minLen) {
  if (!o) return;
  if (typeof o === "string") return _arrayLikeToArray(o, minLen);
  var n = Object.prototype.toString.call(o).slice(8, -1);
  if (n === "Object" && o.constructor) n = o.constructor.name;
  if (n === "Map" || n === "Set") return Array.from(o);
  if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}

function _arrayLikeToArray(arr, len) {
  if (len == null || len > arr.length) len = arr.length;

  for (var i = 0, arr2 = new Array(len); i < len; i++) {
    arr2[i] = arr[i];
  }

  return arr2;
}

function _iterableToArrayLimit(arr, i) {
  var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"];

  if (_i == null) return;
  var _arr = [];
  var _n = true;
  var _d = false;

  var _s, _e;

  try {
    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {
      _arr.push(_s.value);

      if (i && _arr.length === i) break;
    }
  } catch (err) {
    _d = true;
    _e = err;
  } finally {
    try {
      if (!_n && _i["return"] != null) _i["return"]();
    } finally {
      if (_d) throw _e;
    }
  }

  return _arr;
}

function _arrayWithHoles(arr) {
  if (Array.isArray(arr)) return arr;
}

var flipArgs = (0, _ramda.pipe)((0, _ramda.reduceRight)(_ramda.concat, ''), (0, _ramda.equals)('ba'))(['a', 'b']);
var reduceRightP = (0, _ramda.curryN)(3, function (fn, acc, list) {
  return (0, _resolveP["default"])(list).then(function (iterable) {
    var listLength = (0, _ramda.length)(iterable);

    if (listLength === 0) {
      return acc;
    }

    var reducer = (0, _ramda.reduceRight)(function (arg1, arg2) {
      var accP;
      var currentValueP;

      if (flipArgs) {
        accP = arg1;
        currentValueP = arg2;
      } else {
        accP = arg2;
        currentValueP = arg1;
      }

      return accP.then(function (previousValue) {
        return (0, _allP["default"])([previousValue, currentValueP]);
      }).then(function (_ref) {
        var _ref2 = _slicedToArray(_ref, 2),
            previousValue = _ref2[0],
            currentValue = _ref2[1];

        if ((0, _isUndefined["default"])(previousValue) && listLength === 1) {
          return currentValue;
        }

        return fn(currentValue, previousValue);
      });
    });
    return reducer((0, _resolveP["default"])(acc), iterable);
  });
});
var _default = reduceRightP;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZHVjZVJpZ2h0UC5qcyJdLCJuYW1lcyI6WyJleHBvcnRzIiwiX19lc01vZHVsZSIsIl9yYW1kYSIsInJlcXVpcmUiLCJfaXNVbmRlZmluZWQiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX3Jlc29sdmVQIiwiX2FsbFAiLCJvYmoiLCJfc2xpY2VkVG9BcnJheSIsImFyciIsImkiLCJfYXJyYXlXaXRoSG9sZXMiLCJfaXRlcmFibGVUb0FycmF5TGltaXQiLCJfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkiLCJfbm9uSXRlcmFibGVSZXN0IiwiVHlwZUVycm9yIiwibyIsIm1pbkxlbiIsIl9hcnJheUxpa2VUb0FycmF5IiwibiIsIk9iamVjdCIsInByb3RvdHlwZSIsInRvU3RyaW5nIiwiY2FsbCIsInNsaWNlIiwiY29uc3RydWN0b3IiLCJuYW1lIiwiQXJyYXkiLCJmcm9tIiwidGVzdCIsImxlbiIsImxlbmd0aCIsImFycjIiLCJfaSIsIlN5bWJvbCIsIml0ZXJhdG9yIiwiX2FyciIsIl9uIiwiX2QiLCJfcyIsIl9lIiwibmV4dCIsImRvbmUiLCJwdXNoIiwidmFsdWUiLCJlcnIiLCJpc0FycmF5IiwiZmxpcEFyZ3MiLCJwaXBlIiwicmVkdWNlUmlnaHQiLCJjb25jYXQiLCJlcXVhbHMiLCJyZWR1Y2VSaWdodFAiLCJjdXJyeU4iLCJmbiIsImFjYyIsImxpc3QiLCJ0aGVuIiwiaXRlcmFibGUiLCJsaXN0TGVuZ3RoIiwicmVkdWNlciIsImFyZzEiLCJhcmcyIiwiYWNjUCIsImN1cnJlbnRWYWx1ZVAiLCJwcmV2aW91c1ZhbHVlIiwiX3JlZiIsIl9yZWYyIiwiY3VycmVudFZhbHVlIiwiX2RlZmF1bHQiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBQSxPQUFPLENBQUNDLFVBQVIsR0FBcUIsSUFBckI7QUFDQUQsT0FBTyxDQUFDLFNBQUQsQ0FBUCxHQUFxQixLQUFLLENBQTFCOztBQUVBLElBQUlFLE1BQU0sR0FBR0MsT0FBTyxDQUFDLE9BQUQsQ0FB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RCxJQUFELEVBQU8sQ0FBUCxDQUExQjtBQUFBLFlBQ0lELGFBQWEsR0FBR0UsS0FBSyxDQUFDLENBQUQsQ0FEekI7QUFBQSxZQUVJQyxZQUFZLEdBQUdELEtBQUssQ0FBQyxDQUFELENBRnhCOztBQUlBLFlBQUksQ0FBQyxHQUFHaEUsWUFBWSxDQUFDLFNBQUQsQ0FBaEIsRUFBNkI4RCxhQUE3QixLQUErQ04sVUFBVSxLQUFLLENBQWxFLEVBQXFFO0FBQ25FLGlCQUFPUyxZQUFQO0FBQ0Q7O0FBRUQsZUFBT2QsRUFBRSxDQUFDYyxZQUFELEVBQWVILGFBQWYsQ0FBVDtBQUNELE9BWk0sQ0FBUDtBQWFELEtBekJhLENBQWQ7QUEwQkEsV0FBT0wsT0FBTyxDQUFDLENBQUMsR0FBR3ZELFNBQVMsQ0FBQyxTQUFELENBQWIsRUFBMEJrRCxHQUExQixDQUFELEVBQWlDRyxRQUFqQyxDQUFkO0FBQ0QsR0FsQ00sQ0FBUDtBQW1DRCxDQXBDa0IsQ0FBbkI7QUFxQ0EsSUFBSVcsUUFBUSxHQUFHakIsWUFBZjtBQUNBckQsT0FBTyxDQUFDLFNBQUQsQ0FBUCxHQUFxQnNFLFFBQXJCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IHZvaWQgMDtcblxudmFyIF9yYW1kYSA9IHJlcXVpcmUoXCJyYW1kYVwiKTtcblxudmFyIF9pc1VuZGVmaW5lZCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vaXNVbmRlZmluZWRcIikpO1xuXG52YXIgX3Jlc29sdmVQID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9yZXNvbHZlUFwiKSk7XG5cbnZhciBfYWxsUCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vYWxsUFwiKSk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IFwiZGVmYXVsdFwiOiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTsgfVxuXG5mdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuXCIpOyB9XG5cbmZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHsgaWYgKCFvKSByZXR1cm47IGlmICh0eXBlb2YgbyA9PT0gXCJzdHJpbmdcIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IHZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTsgaWYgKG4gPT09IFwiT2JqZWN0XCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTsgaWYgKG4gPT09IFwiTWFwXCIgfHwgbiA9PT0gXCJTZXRcIikgcmV0dXJuIEFycmF5LmZyb20obyk7IGlmIChuID09PSBcIkFyZ3VtZW50c1wiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsgfVxuXG5mdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikgeyBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH1cblxuZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgeyB2YXIgX2kgPSBhcnIgPT0gbnVsbCA/IG51bGwgOiB0eXBlb2YgU3ltYm9sICE9PSBcInVuZGVmaW5lZFwiICYmIGFycltTeW1ib2wuaXRlcmF0b3JdIHx8IGFycltcIkBAaXRlcmF0b3JcIl07IGlmIChfaSA9PSBudWxsKSByZXR1cm47IHZhciBfYXJyID0gW107IHZhciBfbiA9IHRydWU7IHZhciBfZCA9IGZhbHNlOyB2YXIgX3MsIF9lOyB0cnkgeyBmb3IgKF9pID0gX2kuY2FsbChhcnIpOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7IF9hcnIucHVzaChfcy52YWx1ZSk7IGlmIChpICYmIF9hcnIubGVuZ3RoID09PSBpKSBicmVhazsgfSB9IGNhdGNoIChlcnIpIHsgX2QgPSB0cnVlOyBfZSA9IGVycjsgfSBmaW5hbGx5IHsgdHJ5IHsgaWYgKCFfbiAmJiBfaVtcInJldHVyblwiXSAhPSBudWxsKSBfaVtcInJldHVyblwiXSgpOyB9IGZpbmFsbHkgeyBpZiAoX2QpIHRocm93IF9lOyB9IH0gcmV0dXJuIF9hcnI7IH1cblxuZnVuY3Rpb24gX2FycmF5V2l0aEhvbGVzKGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyOyB9XG5cbi8vIGluIG9sZGVyIHJhbWRhIHZlcnNpb25zIHRoZSBvcmRlciBvZiB0aGUgYXJndW1lbnRzIGlzIGZsaXBwZWRcbnZhciBmbGlwQXJncyA9ICgwLCBfcmFtZGEucGlwZSkoKDAsIF9yYW1kYS5yZWR1Y2VSaWdodCkoX3JhbWRhLmNvbmNhdCwgJycpLCAoMCwgX3JhbWRhLmVxdWFscykoJ2JhJykpKFsnYScsICdiJ10pO1xuLyogZXNsaW50LWRpc2FibGUgbWF4LWxlbiAqL1xuXG4vKipcbiAqIEdpdmVuIGFuIGBJdGVyYWJsZWAoYXJyYXlzIGFyZSBgSXRlcmFibGVgKSwgb3IgYSBwcm9taXNlIG9mIGFuIGBJdGVyYWJsZWAsXG4gKiB3aGljaCBwcm9kdWNlcyBwcm9taXNlcyAob3IgYSBtaXggb2YgcHJvbWlzZXMgYW5kIHZhbHVlcyksXG4gKiBpdGVyYXRlIG92ZXIgYWxsIHRoZSB2YWx1ZXMgaW4gdGhlIGBJdGVyYWJsZWAgaW50byBhbiBhcnJheSBhbmRcbiAqIHJlZHVjZSB0aGUgYXJyYXkgdG8gYSB2YWx1ZSB1c2luZyB0aGUgZ2l2ZW4gaXRlcmF0b3IgZnVuY3Rpb24uXG4gKlxuICogU2ltaWxhciB0byB7QGxpbmsgUkEucmVkdWNlUHxyZWR1Y2VQfSBleGNlcHQgbW92ZXMgdGhyb3VnaCB0aGUgaW5wdXQgbGlzdCBmcm9tIHRoZSByaWdodCB0byB0aGUgbGVmdC5cbiAqIFRoZSBpdGVyYXRvciBmdW5jdGlvbiByZWNlaXZlcyB0d28gdmFsdWVzOiAodmFsdWUsIGFjYyksXG4gKiB3aGlsZSB0aGUgYXJndW1lbnRzJyBvcmRlciBvZiByZWR1Y2VQJ3MgaXRlcmF0b3IgZnVuY3Rpb24gaXMgKGFjYywgdmFsdWUpLlxuICpcbiAqIEBmdW5jIHJlZHVjZVJpZ2h0UFxuICogQG1lbWJlck9mIFJBXG4gKiBAc2luY2Uge0BsaW5rIGh0dHBzOi8vY2hhcjBuLmdpdGh1Yi5pby9yYW1kYS1hZGp1bmN0LzEuMTMuMHx2MS4xMy4wfVxuICogQGNhdGVnb3J5IExpc3RcbiAqIEB0eXBlZGVmIE1heWJlUHJvbWlzZSA9IFByb21pc2UuPCo+IHwgKlxuICogQHNpZyAoKE1heWJlUHJvbWlzZSBiLCBQcm9taXNlIGEpIC0+IFByb21pc2UgYSkgLT4gTWF5YmVQcm9taXNlIGEgLT4gTWF5YmVQcm9taXNlIFtNYXliZVByb21pc2UgYl0gLT4gUHJvbWlzZSBhXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgaXRlcmF0b3IgZnVuY3Rpb24uIFJlY2VpdmVzIHR3byB2YWx1ZXMsIHRoZSBjdXJyZW50IGVsZW1lbnQgZnJvbSB0aGUgbGlzdCBhbmQgdGhlIGFjY3VtdWxhdG9yXG4gKiBAcGFyYW0geyp8UHJvbWlzZS48Kj59IGFjYyBUaGUgYWNjdW11bGF0b3IgdmFsdWVcbiAqIEBwYXJhbSB7QXJyYXkuPCo+fFByb21pc2UuPEFycmF5PCp8UHJvbWlzZS48Kj4+Pn0gbGlzdCBUaGUgbGlzdCB0byBpdGVyYXRlIG92ZXJcbiAqIEByZXR1cm4ge1Byb21pc2V9IFRoZSBmaW5hbCwgYWNjdW11bGF0ZWQgdmFsdWVcbiAqIEBzZWUge0BsaW5rIFJBLnJlZHVjZVB8cmVkdWNlUH0sIHtAbGluayBodHRwOi8vYmx1ZWJpcmRqcy5jb20vZG9jcy9hcGkvcHJvbWlzZS5yZWR1Y2UuaHRtbHxibHVlYmlyZC5yZWR1Y2V9XG4gKiBAZXhhbXBsZVxuICpcbiAqIFJBLnJlZHVjZVJpZ2h0UChcbiAqICAgKGZpbGVOYW1lLCB0b3RhbCkgPT4gZnNcbiAqICAgICAucmVhZEZpbGVBc3luYyhmaWxlTmFtZSwgJ3V0ZjgnKVxuICogICAgIC50aGVuKGNvbnRlbnRzID0+IHRvdGFsICsgcGFyc2VJbnQoY29udGVudHMsIDEwKSksXG4gKiAgIDAsXG4gKiAgIFsnZmlsZTEudHh0JywgJ2ZpbGUyLnR4dCcsICdmaWxlMy50eHQnXVxuICogKTsgLy8gPT4gUHJvbWlzZSgxMClcbiAqXG4gKiBSQS5yZWR1Y2VSaWdodFAoXG4gKiAgIChmaWxlTmFtZSwgdG90YWwpID0+IGZzXG4gKiAgICAgLnJlYWRGaWxlQXN5bmMoZmlsZU5hbWUsICd1dGY4JylcbiAqICAgICAudGhlbihjb250ZW50cyA9PiB0b3RhbCArIHBhcnNlSW50KGNvbnRlbnRzLCAxMCkpLFxuICogICBQcm9taXNlLnJlc29sdmUoMCksXG4gKiAgIFsnZmlsZTEudHh0JywgJ2ZpbGUyLnR4dCcsICdmaWxlMy50eHQnXVxuICogKTsgLy8gPT4gUHJvbWlzZSgxMClcbiAqXG4gKiBSQS5yZWR1Y2VSaWdodFAoXG4gKiAgIChmaWxlTmFtZSwgdG90YWwpID0+IGZzXG4gKiAgICAgLnJlYWRGaWxlQXN5bmMoZmlsZU5hbWUsICd1dGY4JylcbiAqICAgICAudGhlbihjb250ZW50cyA9PiB0b3RhbCArIHBhcnNlSW50KGNvbnRlbnRzLCAxMCkpLFxuICogICAwLFxuICogICBbUHJvbWlzZS5yZXNvbHZlKCdmaWxlMS50eHQnKSwgJ2ZpbGUyLnR4dCcsICdmaWxlMy50eHQnXVxuICogKTsgLy8gPT4gUHJvbWlzZSgxMClcbiAqXG4gKiBSQS5yZWR1Y2VSaWdodFAoXG4gKiAgIChmaWxlTmFtZSwgdG90YWwpID0+IGZzXG4gKiAgICAgLnJlYWRGaWxlQXN5bmMoZmlsZU5hbWUsICd1dGY4JylcbiAqICAgICAudGhlbihjb250ZW50cyA9PiB0b3RhbCArIHBhcnNlSW50KGNvbnRlbnRzLCAxMCkpLFxuICogICAwLFxuICogICBQcm9taXNlLnJlc29sdmUoW1Byb21pc2UucmVzb2x2ZSgnZmlsZTEudHh0JyksICdmaWxlMi50eHQnLCAnZmlsZTMudHh0J10pXG4gKiApOyAvLyA9PiBQcm9taXNlKDEwKVxuICpcbiAqL1xuXG4vKiBlc2xpbmUtZW5hYmxlIG1heC1sZW4gKi9cblxudmFyIHJlZHVjZVJpZ2h0UCA9ICgwLCBfcmFtZGEuY3VycnlOKSgzLCBmdW5jdGlvbiAoZm4sIGFjYywgbGlzdCkge1xuICByZXR1cm4gKDAsIF9yZXNvbHZlUFtcImRlZmF1bHRcIl0pKGxpc3QpLnRoZW4oZnVuY3Rpb24gKGl0ZXJhYmxlKSB7XG4gICAgdmFyIGxpc3RMZW5ndGggPSAoMCwgX3JhbWRhLmxlbmd0aCkoaXRlcmFibGUpO1xuXG4gICAgaWYgKGxpc3RMZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfVxuXG4gICAgdmFyIHJlZHVjZXIgPSAoMCwgX3JhbWRhLnJlZHVjZVJpZ2h0KShmdW5jdGlvbiAoYXJnMSwgYXJnMikge1xuICAgICAgdmFyIGFjY1A7XG4gICAgICB2YXIgY3VycmVudFZhbHVlUDtcblxuICAgICAgaWYgKGZsaXBBcmdzKSB7XG4gICAgICAgIGFjY1AgPSBhcmcxO1xuICAgICAgICBjdXJyZW50VmFsdWVQID0gYXJnMjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFjY1AgPSBhcmcyO1xuICAgICAgICBjdXJyZW50VmFsdWVQID0gYXJnMTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGFjY1AudGhlbihmdW5jdGlvbiAocHJldmlvdXNWYWx1ZSkge1xuICAgICAgICByZXR1cm4gKDAsIF9hbGxQW1wiZGVmYXVsdFwiXSkoW3ByZXZpb3VzVmFsdWUsIGN1cnJlbnRWYWx1ZVBdKTtcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKF9yZWYpIHtcbiAgICAgICAgdmFyIF9yZWYyID0gX3NsaWNlZFRvQXJyYXkoX3JlZiwgMiksXG4gICAgICAgICAgICBwcmV2aW91c1ZhbHVlID0gX3JlZjJbMF0sXG4gICAgICAgICAgICBjdXJyZW50VmFsdWUgPSBfcmVmMlsxXTtcblxuICAgICAgICBpZiAoKDAsIF9pc1VuZGVmaW5lZFtcImRlZmF1bHRcIl0pKHByZXZpb3VzVmFsdWUpICYmIGxpc3RMZW5ndGggPT09IDEpIHtcbiAgICAgICAgICByZXR1cm4gY3VycmVudFZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZuKGN1cnJlbnRWYWx1ZSwgcHJldmlvdXNWYWx1ZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVkdWNlcigoMCwgX3Jlc29sdmVQW1wiZGVmYXVsdFwiXSkoYWNjKSwgaXRlcmFibGUpO1xuICB9KTtcbn0pO1xudmFyIF9kZWZhdWx0ID0gcmVkdWNlUmlnaHRQO1xuZXhwb3J0c1tcImRlZmF1bHRcIl0gPSBfZGVmYXVsdDsiXX0=