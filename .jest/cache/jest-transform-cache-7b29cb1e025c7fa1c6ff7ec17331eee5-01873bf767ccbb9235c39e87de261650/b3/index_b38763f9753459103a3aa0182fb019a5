f1e61ee5ca2188eeb2f5f02c2279f484
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

function _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

var strictUriEncode = require('strict-uri-encode');

var decodeComponent = require('decode-uri-component');

var splitOnFirst = require('split-on-first');

var filterObject = require('filter-obj');

var isNullOrUndefined = function isNullOrUndefined(value) {
  return value === null || value === undefined;
};

function encoderForArrayFormat(options) {
  switch (options.arrayFormat) {
    case 'index':
      return function (key) {
        return function (result, value) {
          var index = result.length;

          if (value === undefined || options.skipNull && value === null || options.skipEmptyString && value === '') {
            return result;
          }

          if (value === null) {
            return [].concat((0, _toConsumableArray2.default)(result), [[encode(key, options), '[', index, ']'].join('')]);
          }

          return [].concat((0, _toConsumableArray2.default)(result), [[encode(key, options), '[', encode(index, options), ']=', encode(value, options)].join('')]);
        };
      };

    case 'bracket':
      return function (key) {
        return function (result, value) {
          if (value === undefined || options.skipNull && value === null || options.skipEmptyString && value === '') {
            return result;
          }

          if (value === null) {
            return [].concat((0, _toConsumableArray2.default)(result), [[encode(key, options), '[]'].join('')]);
          }

          return [].concat((0, _toConsumableArray2.default)(result), [[encode(key, options), '[]=', encode(value, options)].join('')]);
        };
      };

    case 'comma':
    case 'separator':
      return function (key) {
        return function (result, value) {
          if (value === null || value === undefined || value.length === 0) {
            return result;
          }

          if (result.length === 0) {
            return [[encode(key, options), '=', encode(value, options)].join('')];
          }

          return [[result, encode(value, options)].join(options.arrayFormatSeparator)];
        };
      };

    default:
      return function (key) {
        return function (result, value) {
          if (value === undefined || options.skipNull && value === null || options.skipEmptyString && value === '') {
            return result;
          }

          if (value === null) {
            return [].concat((0, _toConsumableArray2.default)(result), [encode(key, options)]);
          }

          return [].concat((0, _toConsumableArray2.default)(result), [[encode(key, options), '=', encode(value, options)].join('')]);
        };
      };
  }
}

function parserForArrayFormat(options) {
  var result;

  switch (options.arrayFormat) {
    case 'index':
      return function (key, value, accumulator) {
        result = /\[(\d*)\]$/.exec(key);
        key = key.replace(/\[\d*\]$/, '');

        if (!result) {
          accumulator[key] = value;
          return;
        }

        if (accumulator[key] === undefined) {
          accumulator[key] = {};
        }

        accumulator[key][result[1]] = value;
      };

    case 'bracket':
      return function (key, value, accumulator) {
        result = /(\[\])$/.exec(key);
        key = key.replace(/\[\]$/, '');

        if (!result) {
          accumulator[key] = value;
          return;
        }

        if (accumulator[key] === undefined) {
          accumulator[key] = [value];
          return;
        }

        accumulator[key] = [].concat(accumulator[key], value);
      };

    case 'comma':
    case 'separator':
      return function (key, value, accumulator) {
        var isArray = typeof value === 'string' && value.includes(options.arrayFormatSeparator);
        var isEncodedArray = typeof value === 'string' && !isArray && decode(value, options).includes(options.arrayFormatSeparator);
        value = isEncodedArray ? decode(value, options) : value;
        var newValue = isArray || isEncodedArray ? value.split(options.arrayFormatSeparator).map(function (item) {
          return decode(item, options);
        }) : value === null ? value : decode(value, options);
        accumulator[key] = newValue;
      };

    default:
      return function (key, value, accumulator) {
        if (accumulator[key] === undefined) {
          accumulator[key] = value;
          return;
        }

        accumulator[key] = [].concat(accumulator[key], value);
      };
  }
}

function validateArrayFormatSeparator(value) {
  if (typeof value !== 'string' || value.length !== 1) {
    throw new TypeError('arrayFormatSeparator must be single character string');
  }
}

function encode(value, options) {
  if (options.encode) {
    return options.strict ? strictUriEncode(value) : encodeURIComponent(value);
  }

  return value;
}

function decode(value, options) {
  if (options.decode) {
    return decodeComponent(value);
  }

  return value;
}

function keysSorter(input) {
  if (Array.isArray(input)) {
    return input.sort();
  }

  if (typeof input === 'object') {
    return keysSorter(Object.keys(input)).sort(function (a, b) {
      return Number(a) - Number(b);
    }).map(function (key) {
      return input[key];
    });
  }

  return input;
}

function removeHash(input) {
  var hashStart = input.indexOf('#');

  if (hashStart !== -1) {
    input = input.slice(0, hashStart);
  }

  return input;
}

function getHash(url) {
  var hash = '';
  var hashStart = url.indexOf('#');

  if (hashStart !== -1) {
    hash = url.slice(hashStart);
  }

  return hash;
}

function extract(input) {
  input = removeHash(input);
  var queryStart = input.indexOf('?');

  if (queryStart === -1) {
    return '';
  }

  return input.slice(queryStart + 1);
}

function parseValue(value, options) {
  if (options.parseNumbers && !Number.isNaN(Number(value)) && typeof value === 'string' && value.trim() !== '') {
    value = Number(value);
  } else if (options.parseBooleans && value !== null && (value.toLowerCase() === 'true' || value.toLowerCase() === 'false')) {
    value = value.toLowerCase() === 'true';
  }

  return value;
}

function parse(query, options) {
  options = (0, _extends2.default)({
    decode: true,
    sort: true,
    arrayFormat: 'none',
    arrayFormatSeparator: ',',
    parseNumbers: false,
    parseBooleans: false
  }, options);
  validateArrayFormatSeparator(options.arrayFormatSeparator);
  var formatter = parserForArrayFormat(options);
  var ret = Object.create(null);

  if (typeof query !== 'string') {
    return ret;
  }

  query = query.trim().replace(/^[?#&]/, '');

  if (!query) {
    return ret;
  }

  for (var _iterator = _createForOfIteratorHelperLoose(query.split('&')), _step; !(_step = _iterator()).done;) {
    var param = _step.value;

    if (param === '') {
      continue;
    }

    var _splitOnFirst = splitOnFirst(options.decode ? param.replace(/\+/g, ' ') : param, '='),
        _splitOnFirst2 = (0, _slicedToArray2.default)(_splitOnFirst, 2),
        key = _splitOnFirst2[0],
        value = _splitOnFirst2[1];

    value = value === undefined ? null : ['comma', 'separator'].includes(options.arrayFormat) ? value : decode(value, options);
    formatter(decode(key, options), value, ret);
  }

  for (var _i = 0, _Object$keys = Object.keys(ret); _i < _Object$keys.length; _i++) {
    var _key = _Object$keys[_i];
    var _value = ret[_key];

    if (typeof _value === 'object' && _value !== null) {
      for (var _i2 = 0, _Object$keys2 = Object.keys(_value); _i2 < _Object$keys2.length; _i2++) {
        var k = _Object$keys2[_i2];
        _value[k] = parseValue(_value[k], options);
      }
    } else {
      ret[_key] = parseValue(_value, options);
    }
  }

  if (options.sort === false) {
    return ret;
  }

  return (options.sort === true ? Object.keys(ret).sort() : Object.keys(ret).sort(options.sort)).reduce(function (result, key) {
    var value = ret[key];

    if (Boolean(value) && typeof value === 'object' && !Array.isArray(value)) {
      result[key] = keysSorter(value);
    } else {
      result[key] = value;
    }

    return result;
  }, Object.create(null));
}

exports.extract = extract;
exports.parse = parse;

exports.stringify = function (object, options) {
  if (!object) {
    return '';
  }

  options = (0, _extends2.default)({
    encode: true,
    strict: true,
    arrayFormat: 'none',
    arrayFormatSeparator: ','
  }, options);
  validateArrayFormatSeparator(options.arrayFormatSeparator);

  var shouldFilter = function shouldFilter(key) {
    return options.skipNull && isNullOrUndefined(object[key]) || options.skipEmptyString && object[key] === '';
  };

  var formatter = encoderForArrayFormat(options);
  var objectCopy = {};

  for (var _i3 = 0, _Object$keys3 = Object.keys(object); _i3 < _Object$keys3.length; _i3++) {
    var key = _Object$keys3[_i3];

    if (!shouldFilter(key)) {
      objectCopy[key] = object[key];
    }
  }

  var keys = Object.keys(objectCopy);

  if (options.sort !== false) {
    keys.sort(options.sort);
  }

  return keys.map(function (key) {
    var value = object[key];

    if (value === undefined) {
      return '';
    }

    if (value === null) {
      return encode(key, options);
    }

    if (Array.isArray(value)) {
      return value.reduce(formatter(key), []).join('&');
    }

    return encode(key, options) + '=' + encode(value, options);
  }).filter(function (x) {
    return x.length > 0;
  }).join('&');
};

exports.parseUrl = function (url, options) {
  options = (0, _extends2.default)({
    decode: true
  }, options);

  var _splitOnFirst3 = splitOnFirst(url, '#'),
      _splitOnFirst4 = (0, _slicedToArray2.default)(_splitOnFirst3, 2),
      url_ = _splitOnFirst4[0],
      hash = _splitOnFirst4[1];

  return (0, _extends2.default)({
    url: url_.split('?')[0] || '',
    query: parse(extract(url), options)
  }, options && options.parseFragmentIdentifier && hash ? {
    fragmentIdentifier: decode(hash, options)
  } : {});
};

exports.stringifyUrl = function (object, options) {
  options = (0, _extends2.default)({
    encode: true,
    strict: true
  }, options);
  var url = removeHash(object.url).split('?')[0] || '';
  var queryFromUrl = exports.extract(object.url);
  var parsedQueryFromUrl = exports.parse(queryFromUrl, {
    sort: false
  });
  var query = (0, _extends2.default)(parsedQueryFromUrl, object.query);
  var queryString = exports.stringify(query, options);

  if (queryString) {
    queryString = "?" + queryString;
  }

  var hash = getHash(object.url);

  if (object.fragmentIdentifier) {
    hash = "#" + encode(object.fragmentIdentifier, options);
  }

  return "" + url + queryString + hash;
};

exports.pick = function (input, filter, options) {
  options = (0, _extends2.default)({
    parseFragmentIdentifier: true
  }, options);

  var _exports$parseUrl = exports.parseUrl(input, options),
      url = _exports$parseUrl.url,
      query = _exports$parseUrl.query,
      fragmentIdentifier = _exports$parseUrl.fragmentIdentifier;

  return exports.stringifyUrl({
    url: url,
    query: filterObject(query, filter),
    fragmentIdentifier: fragmentIdentifier
  }, options);
};

exports.exclude = function (input, filter, options) {
  var exclusionFilter = Array.isArray(filter) ? function (key) {
    return !filter.includes(key);
  } : function (key, value) {
    return !filter(key, value);
  };
  return exports.pick(input, exclusionFilter, options);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInN0cmljdFVyaUVuY29kZSIsInJlcXVpcmUiLCJkZWNvZGVDb21wb25lbnQiLCJzcGxpdE9uRmlyc3QiLCJmaWx0ZXJPYmplY3QiLCJpc051bGxPclVuZGVmaW5lZCIsInZhbHVlIiwidW5kZWZpbmVkIiwiZW5jb2RlckZvckFycmF5Rm9ybWF0Iiwib3B0aW9ucyIsImFycmF5Rm9ybWF0Iiwia2V5IiwicmVzdWx0IiwiaW5kZXgiLCJsZW5ndGgiLCJza2lwTnVsbCIsInNraXBFbXB0eVN0cmluZyIsImVuY29kZSIsImpvaW4iLCJhcnJheUZvcm1hdFNlcGFyYXRvciIsInBhcnNlckZvckFycmF5Rm9ybWF0IiwiYWNjdW11bGF0b3IiLCJleGVjIiwicmVwbGFjZSIsImNvbmNhdCIsImlzQXJyYXkiLCJpbmNsdWRlcyIsImlzRW5jb2RlZEFycmF5IiwiZGVjb2RlIiwibmV3VmFsdWUiLCJzcGxpdCIsIm1hcCIsIml0ZW0iLCJ2YWxpZGF0ZUFycmF5Rm9ybWF0U2VwYXJhdG9yIiwiVHlwZUVycm9yIiwic3RyaWN0IiwiZW5jb2RlVVJJQ29tcG9uZW50Iiwia2V5c1NvcnRlciIsImlucHV0IiwiQXJyYXkiLCJzb3J0IiwiT2JqZWN0Iiwia2V5cyIsImEiLCJiIiwiTnVtYmVyIiwicmVtb3ZlSGFzaCIsImhhc2hTdGFydCIsImluZGV4T2YiLCJzbGljZSIsImdldEhhc2giLCJ1cmwiLCJoYXNoIiwiZXh0cmFjdCIsInF1ZXJ5U3RhcnQiLCJwYXJzZVZhbHVlIiwicGFyc2VOdW1iZXJzIiwiaXNOYU4iLCJ0cmltIiwicGFyc2VCb29sZWFucyIsInRvTG93ZXJDYXNlIiwicGFyc2UiLCJxdWVyeSIsImZvcm1hdHRlciIsInJldCIsImNyZWF0ZSIsInBhcmFtIiwiayIsInJlZHVjZSIsIkJvb2xlYW4iLCJleHBvcnRzIiwic3RyaW5naWZ5Iiwib2JqZWN0Iiwic2hvdWxkRmlsdGVyIiwib2JqZWN0Q29weSIsImZpbHRlciIsIngiLCJwYXJzZVVybCIsInVybF8iLCJwYXJzZUZyYWdtZW50SWRlbnRpZmllciIsImZyYWdtZW50SWRlbnRpZmllciIsInN0cmluZ2lmeVVybCIsInF1ZXJ5RnJvbVVybCIsInBhcnNlZFF1ZXJ5RnJvbVVybCIsInF1ZXJ5U3RyaW5nIiwicGljayIsImV4Y2x1ZGUiLCJleGNsdXNpb25GaWx0ZXIiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EsSUFBTUEsZUFBZSxHQUFHQyxPQUFPLENBQUMsbUJBQUQsQ0FBL0I7O0FBQ0EsSUFBTUMsZUFBZSxHQUFHRCxPQUFPLENBQUMsc0JBQUQsQ0FBL0I7O0FBQ0EsSUFBTUUsWUFBWSxHQUFHRixPQUFPLENBQUMsZ0JBQUQsQ0FBNUI7O0FBQ0EsSUFBTUcsWUFBWSxHQUFHSCxPQUFPLENBQUMsWUFBRCxDQUE1Qjs7QUFFQSxJQUFNSSxpQkFBaUIsR0FBRyxTQUFwQkEsaUJBQW9CLENBQUFDLEtBQUs7QUFBQSxTQUFJQSxLQUFLLEtBQUssSUFBVixJQUFrQkEsS0FBSyxLQUFLQyxTQUFoQztBQUFBLENBQS9COztBQUVBLFNBQVNDLHFCQUFULENBQStCQyxPQUEvQixFQUF3QztBQUN2QyxVQUFRQSxPQUFPLENBQUNDLFdBQWhCO0FBQ0MsU0FBSyxPQUFMO0FBQ0MsYUFBTyxVQUFBQyxHQUFHO0FBQUEsZUFBSSxVQUFDQyxNQUFELEVBQVNOLEtBQVQsRUFBbUI7QUFDaEMsY0FBTU8sS0FBSyxHQUFHRCxNQUFNLENBQUNFLE1BQXJCOztBQUVBLGNBQ0NSLEtBQUssS0FBS0MsU0FBVixJQUNDRSxPQUFPLENBQUNNLFFBQVIsSUFBb0JULEtBQUssS0FBSyxJQUQvQixJQUVDRyxPQUFPLENBQUNPLGVBQVIsSUFBMkJWLEtBQUssS0FBSyxFQUh2QyxFQUlFO0FBQ0QsbUJBQU9NLE1BQVA7QUFDQTs7QUFFRCxjQUFJTixLQUFLLEtBQUssSUFBZCxFQUFvQjtBQUNuQiw4REFBV00sTUFBWCxJQUFtQixDQUFDSyxNQUFNLENBQUNOLEdBQUQsRUFBTUYsT0FB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QkFBWUEsS0FBWjtBQUFBLE1BQW1Ca0Isa0JBQW5CLHFCQUFtQkEsa0JBQW5COztBQUNBLFNBQU9WLE9BQU8sQ0FBQ1csWUFBUixDQUFxQjtBQUMzQjlCLElBQUFBLEdBQUcsRUFBSEEsR0FEMkI7QUFFM0JXLElBQUFBLEtBQUssRUFBRTFELFlBQVksQ0FBQzBELEtBQUQsRUFBUWEsTUFBUixDQUZRO0FBRzNCSyxJQUFBQSxrQkFBa0IsRUFBbEJBO0FBSDJCLEdBQXJCLEVBSUp2RSxPQUpJLENBQVA7QUFLQSxDQVhEOztBQWFBNkQsT0FBTyxDQUFDZ0IsT0FBUixHQUFrQixVQUFDaEQsS0FBRCxFQUFRcUMsTUFBUixFQUFnQmxFLE9BQWhCLEVBQTRCO0FBQzdDLE1BQU04RSxlQUFlLEdBQUdoRCxLQUFLLENBQUNkLE9BQU4sQ0FBY2tELE1BQWQsSUFBd0IsVUFBQWhFLEdBQUc7QUFBQSxXQUFJLENBQUNnRSxNQUFNLENBQUNqRCxRQUFQLENBQWdCZixHQUFoQixDQUFMO0FBQUEsR0FBM0IsR0FBdUQsVUFBQ0EsR0FBRCxFQUFNTCxLQUFOO0FBQUEsV0FBZ0IsQ0FBQ3FFLE1BQU0sQ0FBQ2hFLEdBQUQsRUFBTUwsS0FBTixDQUF2QjtBQUFBLEdBQS9FO0FBRUEsU0FBT2dFLE9BQU8sQ0FBQ2UsSUFBUixDQUFhL0MsS0FBYixFQUFvQmlELGVBQXBCLEVBQXFDOUUsT0FBckMsQ0FBUDtBQUNBLENBSkQiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5jb25zdCBzdHJpY3RVcmlFbmNvZGUgPSByZXF1aXJlKCdzdHJpY3QtdXJpLWVuY29kZScpO1xuY29uc3QgZGVjb2RlQ29tcG9uZW50ID0gcmVxdWlyZSgnZGVjb2RlLXVyaS1jb21wb25lbnQnKTtcbmNvbnN0IHNwbGl0T25GaXJzdCA9IHJlcXVpcmUoJ3NwbGl0LW9uLWZpcnN0Jyk7XG5jb25zdCBmaWx0ZXJPYmplY3QgPSByZXF1aXJlKCdmaWx0ZXItb2JqJyk7XG5cbmNvbnN0IGlzTnVsbE9yVW5kZWZpbmVkID0gdmFsdWUgPT4gdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZDtcblxuZnVuY3Rpb24gZW5jb2RlckZvckFycmF5Rm9ybWF0KG9wdGlvbnMpIHtcblx0c3dpdGNoIChvcHRpb25zLmFycmF5Rm9ybWF0KSB7XG5cdFx0Y2FzZSAnaW5kZXgnOlxuXHRcdFx0cmV0dXJuIGtleSA9PiAocmVzdWx0LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRjb25zdCBpbmRleCA9IHJlc3VsdC5sZW5ndGg7XG5cblx0XHRcdFx0aWYgKFxuXHRcdFx0XHRcdHZhbHVlID09PSB1bmRlZmluZWQgfHxcblx0XHRcdFx0XHQob3B0aW9ucy5za2lwTnVsbCAmJiB2YWx1ZSA9PT0gbnVsbCkgfHxcblx0XHRcdFx0XHQob3B0aW9ucy5za2lwRW1wdHlTdHJpbmcgJiYgdmFsdWUgPT09ICcnKVxuXHRcdFx0XHQpIHtcblx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHZhbHVlID09PSBudWxsKSB7XG5cdFx0XHRcdFx0cmV0dXJuIFsuLi5yZXN1bHQsIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgJ1snLCBpbmRleCwgJ10nXS5qb2luKCcnKV07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gW1xuXHRcdFx0XHRcdC4uLnJlc3VsdCxcblx0XHRcdFx0XHRbZW5jb2RlKGtleSwgb3B0aW9ucyksICdbJywgZW5jb2RlKGluZGV4LCBvcHRpb25zKSwgJ109JywgZW5jb2RlKHZhbHVlLCBvcHRpb25zKV0uam9pbignJylcblx0XHRcdFx0XTtcblx0XHRcdH07XG5cblx0XHRjYXNlICdicmFja2V0Jzpcblx0XHRcdHJldHVybiBrZXkgPT4gKHJlc3VsdCwgdmFsdWUpID0+IHtcblx0XHRcdFx0aWYgKFxuXHRcdFx0XHRcdHZhbHVlID09PSB1bmRlZmluZWQgfHxcblx0XHRcdFx0XHQob3B0aW9ucy5za2lwTnVsbCAmJiB2YWx1ZSA9PT0gbnVsbCkgfHxcblx0XHRcdFx0XHQob3B0aW9ucy5za2lwRW1wdHlTdHJpbmcgJiYgdmFsdWUgPT09ICcnKVxuXHRcdFx0XHQpIHtcblx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHZhbHVlID09PSBudWxsKSB7XG5cdFx0XHRcdFx0cmV0dXJuIFsuLi5yZXN1bHQsIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgJ1tdJ10uam9pbignJyldO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIFsuLi5yZXN1bHQsIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgJ1tdPScsIGVuY29kZSh2YWx1ZSwgb3B0aW9ucyldLmpvaW4oJycpXTtcblx0XHRcdH07XG5cblx0XHRjYXNlICdjb21tYSc6XG5cdFx0Y2FzZSAnc2VwYXJhdG9yJzpcblx0XHRcdHJldHVybiBrZXkgPT4gKHJlc3VsdCwgdmFsdWUpID0+IHtcblx0XHRcdFx0aWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChyZXN1bHQubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRcdFx0cmV0dXJuIFtbZW5jb2RlKGtleSwgb3B0aW9ucyksICc9JywgZW5jb2RlKHZhbHVlLCBvcHRpb25zKV0uam9pbignJyldO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIFtbcmVzdWx0LCBlbmNvZGUodmFsdWUsIG9wdGlvbnMpXS5qb2luKG9wdGlvbnMuYXJyYXlGb3JtYXRTZXBhcmF0b3IpXTtcblx0XHRcdH07XG5cblx0XHRkZWZhdWx0OlxuXHRcdFx0cmV0dXJuIGtleSA9PiAocmVzdWx0LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0dmFsdWUgPT09IHVuZGVmaW5lZCB8fFxuXHRcdFx0XHRcdChvcHRpb25zLnNraXBOdWxsICYmIHZhbHVlID09PSBudWxsKSB8fFxuXHRcdFx0XHRcdChvcHRpb25zLnNraXBFbXB0eVN0cmluZyAmJiB2YWx1ZSA9PT0gJycpXG5cdFx0XHRcdCkge1xuXHRcdFx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodmFsdWUgPT09IG51bGwpIHtcblx0XHRcdFx0XHRyZXR1cm4gWy4uLnJlc3VsdCwgZW5jb2RlKGtleSwgb3B0aW9ucyldO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIFsuLi5yZXN1bHQsIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgJz0nLCBlbmNvZGUodmFsdWUsIG9wdGlvbnMpXS5qb2luKCcnKV07XG5cdFx0XHR9O1xuXHR9XG59XG5cbmZ1bmN0aW9uIHBhcnNlckZvckFycmF5Rm9ybWF0KG9wdGlvbnMpIHtcblx0bGV0IHJlc3VsdDtcblxuXHRzd2l0Y2ggKG9wdGlvbnMuYXJyYXlGb3JtYXQpIHtcblx0XHRjYXNlICdpbmRleCc6XG5cdFx0XHRyZXR1cm4gKGtleSwgdmFsdWUsIGFjY3VtdWxhdG9yKSA9PiB7XG5cdFx0XHRcdHJlc3VsdCA9IC9cXFsoXFxkKilcXF0kLy5leGVjKGtleSk7XG5cblx0XHRcdFx0a2V5ID0ga2V5LnJlcGxhY2UoL1xcW1xcZCpcXF0kLywgJycpO1xuXG5cdFx0XHRcdGlmICghcmVzdWx0KSB7XG5cdFx0XHRcdFx0YWNjdW11bGF0b3Jba2V5XSA9IHZhbHVlO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChhY2N1bXVsYXRvcltrZXldID09PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRhY2N1bXVsYXRvcltrZXldID0ge307XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRhY2N1bXVsYXRvcltrZXldW3Jlc3VsdFsxXV0gPSB2YWx1ZTtcblx0XHRcdH07XG5cblx0XHRjYXNlICdicmFja2V0Jzpcblx0XHRcdHJldHVybiAoa2V5LCB2YWx1ZSwgYWNjdW11bGF0b3IpID0+IHtcblx0XHRcdFx0cmVzdWx0ID0gLyhcXFtcXF0pJC8uZXhlYyhrZXkpO1xuXHRcdFx0XHRrZXkgPSBrZXkucmVwbGFjZSgvXFxbXFxdJC8sICcnKTtcblxuXHRcdFx0XHRpZiAoIXJlc3VsdCkge1xuXHRcdFx0XHRcdGFjY3VtdWxhdG9yW2tleV0gPSB2YWx1ZTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoYWNjdW11bGF0b3Jba2V5XSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0YWNjdW11bGF0b3Jba2V5XSA9IFt2YWx1ZV07XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0YWNjdW11bGF0b3Jba2V5XSA9IFtdLmNvbmNhdChhY2N1bXVsYXRvcltrZXldLCB2YWx1ZSk7XG5cdFx0XHR9O1xuXG5cdFx0Y2FzZSAnY29tbWEnOlxuXHRcdGNhc2UgJ3NlcGFyYXRvcic6XG5cdFx0XHRyZXR1cm4gKGtleSwgdmFsdWUsIGFjY3VtdWxhdG9yKSA9PiB7XG5cdFx0XHRcdGNvbnN0IGlzQXJyYXkgPSB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHZhbHVlLmluY2x1ZGVzKG9wdGlvbnMuYXJyYXlGb3JtYXRTZXBhcmF0b3IpO1xuXHRcdFx0XHRjb25zdCBpc0VuY29kZWRBcnJheSA9ICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmICFpc0FycmF5ICYmIGRlY29kZSh2YWx1ZSwgb3B0aW9ucykuaW5jbHVkZXMob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcikpO1xuXHRcdFx0XHR2YWx1ZSA9IGlzRW5jb2RlZEFycmF5ID8gZGVjb2RlKHZhbHVlLCBvcHRpb25zKSA6IHZhbHVlO1xuXHRcdFx0XHRjb25zdCBuZXdWYWx1ZSA9IGlzQXJyYXkgfHwgaXNFbmNvZGVkQXJyYXkgPyB2YWx1ZS5zcGxpdChvcHRpb25zLmFycmF5Rm9ybWF0U2VwYXJhdG9yKS5tYXAoaXRlbSA9PiBkZWNvZGUoaXRlbSwgb3B0aW9ucykpIDogdmFsdWUgPT09IG51bGwgPyB2YWx1ZSA6IGRlY29kZSh2YWx1ZSwgb3B0aW9ucyk7XG5cdFx0XHRcdGFjY3VtdWxhdG9yW2tleV0gPSBuZXdWYWx1ZTtcblx0XHRcdH07XG5cblx0XHRkZWZhdWx0OlxuXHRcdFx0cmV0dXJuIChrZXksIHZhbHVlLCBhY2N1bXVsYXRvcikgPT4ge1xuXHRcdFx0XHRpZiAoYWNjdW11bGF0b3Jba2V5XSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0YWNjdW11bGF0b3Jba2V5XSA9IHZhbHVlO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGFjY3VtdWxhdG9yW2tleV0gPSBbXS5jb25jYXQoYWNjdW11bGF0b3Jba2V5XSwgdmFsdWUpO1xuXHRcdFx0fTtcblx0fVxufVxuXG5mdW5jdGlvbiB2YWxpZGF0ZUFycmF5Rm9ybWF0U2VwYXJhdG9yKHZhbHVlKSB7XG5cdGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnIHx8IHZhbHVlLmxlbmd0aCAhPT0gMSkge1xuXHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ2FycmF5Rm9ybWF0U2VwYXJhdG9yIG11c3QgYmUgc2luZ2xlIGNoYXJhY3RlciBzdHJpbmcnKTtcblx0fVxufVxuXG5mdW5jdGlvbiBlbmNvZGUodmFsdWUsIG9wdGlvbnMpIHtcblx0aWYgKG9wdGlvbnMuZW5jb2RlKSB7XG5cdFx0cmV0dXJuIG9wdGlvbnMuc3RyaWN0ID8gc3RyaWN0VXJpRW5jb2RlKHZhbHVlKSA6IGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7XG5cdH1cblxuXHRyZXR1cm4gdmFsdWU7XG59XG5cbmZ1bmN0aW9uIGRlY29kZSh2YWx1ZSwgb3B0aW9ucykge1xuXHRpZiAob3B0aW9ucy5kZWNvZGUpIHtcblx0XHRyZXR1cm4gZGVjb2RlQ29tcG9uZW50KHZhbHVlKTtcblx0fVxuXG5cdHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24ga2V5c1NvcnRlcihpbnB1dCkge1xuXHRpZiAoQXJyYXkuaXNBcnJheShpbnB1dCkpIHtcblx0XHRyZXR1cm4gaW5wdXQuc29ydCgpO1xuXHR9XG5cblx0aWYgKHR5cGVvZiBpbnB1dCA9PT0gJ29iamVjdCcpIHtcblx0XHRyZXR1cm4ga2V5c1NvcnRlcihPYmplY3Qua2V5cyhpbnB1dCkpXG5cdFx0XHQuc29ydCgoYSwgYikgPT4gTnVtYmVyKGEpIC0gTnVtYmVyKGIpKVxuXHRcdFx0Lm1hcChrZXkgPT4gaW5wdXRba2V5XSk7XG5cdH1cblxuXHRyZXR1cm4gaW5wdXQ7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZUhhc2goaW5wdXQpIHtcblx0Y29uc3QgaGFzaFN0YXJ0ID0gaW5wdXQuaW5kZXhPZignIycpO1xuXHRpZiAoaGFzaFN0YXJ0ICE9PSAtMSkge1xuXHRcdGlucHV0ID0gaW5wdXQuc2xpY2UoMCwgaGFzaFN0YXJ0KTtcblx0fVxuXG5cdHJldHVybiBpbnB1dDtcbn1cblxuZnVuY3Rpb24gZ2V0SGFzaCh1cmwpIHtcblx0bGV0IGhhc2ggPSAnJztcblx0Y29uc3QgaGFzaFN0YXJ0ID0gdXJsLmluZGV4T2YoJyMnKTtcblx0aWYgKGhhc2hTdGFydCAhPT0gLTEpIHtcblx0XHRoYXNoID0gdXJsLnNsaWNlKGhhc2hTdGFydCk7XG5cdH1cblxuXHRyZXR1cm4gaGFzaDtcbn1cblxuZnVuY3Rpb24gZXh0cmFjdChpbnB1dCkge1xuXHRpbnB1dCA9IHJlbW92ZUhhc2goaW5wdXQpO1xuXHRjb25zdCBxdWVyeVN0YXJ0ID0gaW5wdXQuaW5kZXhPZignPycpO1xuXHRpZiAocXVlcnlTdGFydCA9PT0gLTEpIHtcblx0XHRyZXR1cm4gJyc7XG5cdH1cblxuXHRyZXR1cm4gaW5wdXQuc2xpY2UocXVlcnlTdGFydCArIDEpO1xufVxuXG5mdW5jdGlvbiBwYXJzZVZhbHVlKHZhbHVlLCBvcHRpb25zKSB7XG5cdGlmIChvcHRpb25zLnBhcnNlTnVtYmVycyAmJiAhTnVtYmVyLmlzTmFOKE51bWJlcih2YWx1ZSkpICYmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHZhbHVlLnRyaW0oKSAhPT0gJycpKSB7XG5cdFx0dmFsdWUgPSBOdW1iZXIodmFsdWUpO1xuXHR9IGVsc2UgaWYgKG9wdGlvbnMucGFyc2VCb29sZWFucyAmJiB2YWx1ZSAhPT0gbnVsbCAmJiAodmFsdWUudG9Mb3dlckNhc2UoKSA9PT0gJ3RydWUnIHx8IHZhbHVlLnRvTG93ZXJDYXNlKCkgPT09ICdmYWxzZScpKSB7XG5cdFx0dmFsdWUgPSB2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSAndHJ1ZSc7XG5cdH1cblxuXHRyZXR1cm4gdmFsdWU7XG59XG5cbmZ1bmN0aW9uIHBhcnNlKHF1ZXJ5LCBvcHRpb25zKSB7XG5cdG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcblx0XHRkZWNvZGU6IHRydWUsXG5cdFx0c29ydDogdHJ1ZSxcblx0XHRhcnJheUZvcm1hdDogJ25vbmUnLFxuXHRcdGFycmF5Rm9ybWF0U2VwYXJhdG9yOiAnLCcsXG5cdFx0cGFyc2VOdW1iZXJzOiBmYWxzZSxcblx0XHRwYXJzZUJvb2xlYW5zOiBmYWxzZVxuXHR9LCBvcHRpb25zKTtcblxuXHR2YWxpZGF0ZUFycmF5Rm9ybWF0U2VwYXJhdG9yKG9wdGlvbnMuYXJyYXlGb3JtYXRTZXBhcmF0b3IpO1xuXG5cdGNvbnN0IGZvcm1hdHRlciA9IHBhcnNlckZvckFycmF5Rm9ybWF0KG9wdGlvbnMpO1xuXG5cdC8vIENyZWF0ZSBhbiBvYmplY3Qgd2l0aCBubyBwcm90b3R5cGVcblx0Y29uc3QgcmV0ID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblxuXHRpZiAodHlwZW9mIHF1ZXJ5ICE9PSAnc3RyaW5nJykge1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRxdWVyeSA9IHF1ZXJ5LnRyaW0oKS5yZXBsYWNlKC9eWz8jJl0vLCAnJyk7XG5cblx0aWYgKCFxdWVyeSkge1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRmb3IgKGNvbnN0IHBhcmFtIG9mIHF1ZXJ5LnNwbGl0KCcmJykpIHtcblx0XHRpZiAocGFyYW0gPT09ICcnKSB7XG5cdFx0XHRjb250aW51ZTtcblx0XHR9XG5cblx0XHRsZXQgW2tleSwgdmFsdWVdID0gc3BsaXRPbkZpcnN0KG9wdGlvbnMuZGVjb2RlID8gcGFyYW0ucmVwbGFjZSgvXFwrL2csICcgJykgOiBwYXJhbSwgJz0nKTtcblxuXHRcdC8vIE1pc3NpbmcgYD1gIHNob3VsZCBiZSBgbnVsbGA6XG5cdFx0Ly8gaHR0cDovL3czLm9yZy9UUi8yMDEyL1dELXVybC0yMDEyMDUyNC8jY29sbGVjdC11cmwtcGFyYW1ldGVyc1xuXHRcdHZhbHVlID0gdmFsdWUgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBbJ2NvbW1hJywgJ3NlcGFyYXRvciddLmluY2x1ZGVzKG9wdGlvbnMuYXJyYXlGb3JtYXQpID8gdmFsdWUgOiBkZWNvZGUodmFsdWUsIG9wdGlvbnMpO1xuXHRcdGZvcm1hdHRlcihkZWNvZGUoa2V5LCBvcHRpb25zKSwgdmFsdWUsIHJldCk7XG5cdH1cblxuXHRmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhyZXQpKSB7XG5cdFx0Y29uc3QgdmFsdWUgPSByZXRba2V5XTtcblx0XHRpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAhPT0gbnVsbCkge1xuXHRcdFx0Zm9yIChjb25zdCBrIG9mIE9iamVjdC5rZXlzKHZhbHVlKSkge1xuXHRcdFx0XHR2YWx1ZVtrXSA9IHBhcnNlVmFsdWUodmFsdWVba10sIG9wdGlvbnMpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXRba2V5XSA9IHBhcnNlVmFsdWUodmFsdWUsIG9wdGlvbnMpO1xuXHRcdH1cblx0fVxuXG5cdGlmIChvcHRpb25zLnNvcnQgPT09IGZhbHNlKSB7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdHJldHVybiAob3B0aW9ucy5zb3J0ID09PSB0cnVlID8gT2JqZWN0LmtleXMocmV0KS5zb3J0KCkgOiBPYmplY3Qua2V5cyhyZXQpLnNvcnQob3B0aW9ucy5zb3J0KSkucmVkdWNlKChyZXN1bHQsIGtleSkgPT4ge1xuXHRcdGNvbnN0IHZhbHVlID0gcmV0W2tleV07XG5cdFx0aWYgKEJvb2xlYW4odmFsdWUpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG5cdFx0XHQvLyBTb3J0IG9iamVjdCBrZXlzLCBub3QgdmFsdWVzXG5cdFx0XHRyZXN1bHRba2V5XSA9IGtleXNTb3J0ZXIodmFsdWUpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXN1bHRba2V5XSA9IHZhbHVlO1xuXHRcdH1cblxuXHRcdHJldHVybiByZXN1bHQ7XG5cdH0sIE9iamVjdC5jcmVhdGUobnVsbCkpO1xufVxuXG5leHBvcnRzLmV4dHJhY3QgPSBleHRyYWN0O1xuZXhwb3J0cy5wYXJzZSA9IHBhcnNlO1xuXG5leHBvcnRzLnN0cmluZ2lmeSA9IChvYmplY3QsIG9wdGlvbnMpID0+IHtcblx0aWYgKCFvYmplY3QpIHtcblx0XHRyZXR1cm4gJyc7XG5cdH1cblxuXHRvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7XG5cdFx0ZW5jb2RlOiB0cnVlLFxuXHRcdHN0cmljdDogdHJ1ZSxcblx0XHRhcnJheUZvcm1hdDogJ25vbmUnLFxuXHRcdGFycmF5Rm9ybWF0U2VwYXJhdG9yOiAnLCdcblx0fSwgb3B0aW9ucyk7XG5cblx0dmFsaWRhdGVBcnJheUZvcm1hdFNlcGFyYXRvcihvcHRpb25zLmFycmF5Rm9ybWF0U2VwYXJhdG9yKTtcblxuXHRjb25zdCBzaG91bGRGaWx0ZXIgPSBrZXkgPT4gKFxuXHRcdChvcHRpb25zLnNraXBOdWxsICYmIGlzTnVsbE9yVW5kZWZpbmVkKG9iamVjdFtrZXldKSkgfHxcblx0XHQob3B0aW9ucy5za2lwRW1wdHlTdHJpbmcgJiYgb2JqZWN0W2tleV0gPT09ICcnKVxuXHQpO1xuXG5cdGNvbnN0IGZvcm1hdHRlciA9IGVuY29kZXJGb3JBcnJheUZvcm1hdChvcHRpb25zKTtcblxuXHRjb25zdCBvYmplY3RDb3B5ID0ge307XG5cblx0Zm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMob2JqZWN0KSkge1xuXHRcdGlmICghc2hvdWxkRmlsdGVyKGtleSkpIHtcblx0XHRcdG9iamVjdENvcHlba2V5XSA9IG9iamVjdFtrZXldO1xuXHRcdH1cblx0fVxuXG5cdGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3RDb3B5KTtcblxuXHRpZiAob3B0aW9ucy5zb3J0ICE9PSBmYWxzZSkge1xuXHRcdGtleXMuc29ydChvcHRpb25zLnNvcnQpO1xuXHR9XG5cblx0cmV0dXJuIGtleXMubWFwKGtleSA9PiB7XG5cdFx0Y29uc3QgdmFsdWUgPSBvYmplY3Rba2V5XTtcblxuXHRcdGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRyZXR1cm4gJyc7XG5cdFx0fVxuXG5cdFx0aWYgKHZhbHVlID09PSBudWxsKSB7XG5cdFx0XHRyZXR1cm4gZW5jb2RlKGtleSwgb3B0aW9ucyk7XG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG5cdFx0XHRyZXR1cm4gdmFsdWVcblx0XHRcdFx0LnJlZHVjZShmb3JtYXR0ZXIoa2V5KSwgW10pXG5cdFx0XHRcdC5qb2luKCcmJyk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGVuY29kZShrZXksIG9wdGlvbnMpICsgJz0nICsgZW5jb2RlKHZhbHVlLCBvcHRpb25zKTtcblx0fSkuZmlsdGVyKHggPT4geC5sZW5ndGggPiAwKS5qb2luKCcmJyk7XG59O1xuXG5leHBvcnRzLnBhcnNlVXJsID0gKHVybCwgb3B0aW9ucykgPT4ge1xuXHRvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7XG5cdFx0ZGVjb2RlOiB0cnVlXG5cdH0sIG9wdGlvbnMpO1xuXG5cdGNvbnN0IFt1cmxfLCBoYXNoXSA9IHNwbGl0T25GaXJzdCh1cmwsICcjJyk7XG5cblx0cmV0dXJuIE9iamVjdC5hc3NpZ24oXG5cdFx0e1xuXHRcdFx0dXJsOiB1cmxfLnNwbGl0KCc/JylbMF0gfHwgJycsXG5cdFx0XHRxdWVyeTogcGFyc2UoZXh0cmFjdCh1cmwpLCBvcHRpb25zKVxuXHRcdH0sXG5cdFx0b3B0aW9ucyAmJiBvcHRpb25zLnBhcnNlRnJhZ21lbnRJZGVudGlmaWVyICYmIGhhc2ggPyB7ZnJhZ21lbnRJZGVudGlmaWVyOiBkZWNvZGUoaGFzaCwgb3B0aW9ucyl9IDoge31cblx0KTtcbn07XG5cbmV4cG9ydHMuc3RyaW5naWZ5VXJsID0gKG9iamVjdCwgb3B0aW9ucykgPT4ge1xuXHRvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7XG5cdFx0ZW5jb2RlOiB0cnVlLFxuXHRcdHN0cmljdDogdHJ1ZVxuXHR9LCBvcHRpb25zKTtcblxuXHRjb25zdCB1cmwgPSByZW1vdmVIYXNoKG9iamVjdC51cmwpLnNwbGl0KCc/JylbMF0gfHwgJyc7XG5cdGNvbnN0IHF1ZXJ5RnJvbVVybCA9IGV4cG9ydHMuZXh0cmFjdChvYmplY3QudXJsKTtcblx0Y29uc3QgcGFyc2VkUXVlcnlGcm9tVXJsID0gZXhwb3J0cy5wYXJzZShxdWVyeUZyb21VcmwsIHtzb3J0OiBmYWxzZX0pO1xuXG5cdGNvbnN0IHF1ZXJ5ID0gT2JqZWN0LmFzc2lnbihwYXJzZWRRdWVyeUZyb21VcmwsIG9iamVjdC5xdWVyeSk7XG5cdGxldCBxdWVyeVN0cmluZyA9IGV4cG9ydHMuc3RyaW5naWZ5KHF1ZXJ5LCBvcHRpb25zKTtcblx0aWYgKHF1ZXJ5U3RyaW5nKSB7XG5cdFx0cXVlcnlTdHJpbmcgPSBgPyR7cXVlcnlTdHJpbmd9YDtcblx0fVxuXG5cdGxldCBoYXNoID0gZ2V0SGFzaChvYmplY3QudXJsKTtcblx0aWYgKG9iamVjdC5mcmFnbWVudElkZW50aWZpZXIpIHtcblx0XHRoYXNoID0gYCMke2VuY29kZShvYmplY3QuZnJhZ21lbnRJZGVudGlmaWVyLCBvcHRpb25zKX1gO1xuXHR9XG5cblx0cmV0dXJuIGAke3VybH0ke3F1ZXJ5U3RyaW5nfSR7aGFzaH1gO1xufTtcblxuZXhwb3J0cy5waWNrID0gKGlucHV0LCBmaWx0ZXIsIG9wdGlvbnMpID0+IHtcblx0b3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xuXHRcdHBhcnNlRnJhZ21lbnRJZGVudGlmaWVyOiB0cnVlXG5cdH0sIG9wdGlvbnMpO1xuXG5cdGNvbnN0IHt1cmwsIHF1ZXJ5LCBmcmFnbWVudElkZW50aWZpZXJ9ID0gZXhwb3J0cy5wYXJzZVVybChpbnB1dCwgb3B0aW9ucyk7XG5cdHJldHVybiBleHBvcnRzLnN0cmluZ2lmeVVybCh7XG5cdFx0dXJsLFxuXHRcdHF1ZXJ5OiBmaWx0ZXJPYmplY3QocXVlcnksIGZpbHRlciksXG5cdFx0ZnJhZ21lbnRJZGVudGlmaWVyXG5cdH0sIG9wdGlvbnMpO1xufTtcblxuZXhwb3J0cy5leGNsdWRlID0gKGlucHV0LCBmaWx0ZXIsIG9wdGlvbnMpID0+IHtcblx0Y29uc3QgZXhjbHVzaW9uRmlsdGVyID0gQXJyYXkuaXNBcnJheShmaWx0ZXIpID8ga2V5ID0+ICFmaWx0ZXIuaW5jbHVkZXMoa2V5KSA6IChrZXksIHZhbHVlKSA9PiAhZmlsdGVyKGtleSwgdmFsdWUpO1xuXG5cdHJldHVybiBleHBvcnRzLnBpY2soaW5wdXQsIGV4Y2x1c2lvbkZpbHRlciwgb3B0aW9ucyk7XG59O1xuIl19