d20317cc5c7e3df8d4a144377f8524b9
var _arrayFromIterator = require("./_arrayFromIterator");

var _includesWith = require("./_includesWith");

var _functionName = require("./_functionName");

var _has = require("./_has");

var _objectIs = require("./_objectIs");

var keys = require("../keys");

var type = require("../type");

function _uniqContentEquals(aIterator, bIterator, stackA, stackB) {
  var a = _arrayFromIterator(aIterator);

  var b = _arrayFromIterator(bIterator);

  function eq(_a, _b) {
    return _equals(_a, _b, stackA.slice(), stackB.slice());
  }

  return !_includesWith(function (b, aItem) {
    return !_includesWith(eq, aItem, b);
  }, b, a);
}

function _equals(a, b, stackA, stackB) {
  if (_objectIs(a, b)) {
    return true;
  }

  var typeA = type(a);

  if (typeA !== type(b)) {
    return false;
  }

  if (a == null || b == null) {
    return false;
  }

  if (typeof a['fantasy-land/equals'] === 'function' || typeof b['fantasy-land/equals'] === 'function') {
    return typeof a['fantasy-land/equals'] === 'function' && a['fantasy-land/equals'](b) && typeof b['fantasy-land/equals'] === 'function' && b['fantasy-land/equals'](a);
  }

  if (typeof a.equals === 'function' || typeof b.equals === 'function') {
    return typeof a.equals === 'function' && a.equals(b) && typeof b.equals === 'function' && b.equals(a);
  }

  switch (typeA) {
    case 'Arguments':
    case 'Array':
    case 'Object':
      if (typeof a.constructor === 'function' && _functionName(a.constructor) === 'Promise') {
        return a === b;
      }

      break;

    case 'Boolean':
    case 'Number':
    case 'String':
      if (!(typeof a === typeof b && _objectIs(a.valueOf(), b.valueOf()))) {
        return false;
      }

      break;

    case 'Date':
      if (!_objectIs(a.valueOf(), b.valueOf())) {
        return false;
      }

      break;

    case 'Error':
      return a.name === b.name && a.message === b.message;

    case 'RegExp':
      if (!(a.source === b.source && a.global === b.global && a.ignoreCase === b.ignoreCase && a.multiline === b.multiline && a.sticky === b.sticky && a.unicode === b.unicode)) {
        return false;
      }

      break;
  }

  var idx = stackA.length - 1;

  while (idx >= 0) {
    if (stackA[idx] === a) {
      return stackB[idx] === b;
    }

    idx -= 1;
  }

  switch (typeA) {
    case 'Map':
      if (a.size !== b.size) {
        return false;
      }

      return _uniqContentEquals(a.entries(), b.entries(), stackA.concat([a]), stackB.concat([b]));

    case 'Set':
      if (a.size !== b.size) {
        return false;
      }

      return _uniqContentEquals(a.values(), b.values(), stackA.concat([a]), stackB.concat([b]));

    case 'Arguments':
    case 'Array':
    case 'Object':
    case 'Boolean':
    case 'Number':
    case 'String':
    case 'Date':
    case 'Error':
    case 'RegExp':
    case 'Int8Array':
    case 'Uint8Array':
    case 'Uint8ClampedArray':
    case 'Int16Array':
    case 'Uint16Array':
    case 'Int32Array':
    case 'Uint32Array':
    case 'Float32Array':
    case 'Float64Array':
    case 'ArrayBuffer':
      break;

    default:
      return false;
  }

  var keysA = keys(a);

  if (keysA.length !== keys(b).length) {
    return false;
  }

  var extendedStackA = stackA.concat([a]);
  var extendedStackB = stackB.concat([b]);
  idx = keysA.length - 1;

  while (idx >= 0) {
    var key = keysA[idx];

    if (!(_has(key, b) && _equals(b[key], a[key], extendedStackA, extendedStackB))) {
      return false;
    }

    idx -= 1;
  }

  return true;
}

module.exports = _equals;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9lcXVhbHMuanMiXSwibmFtZXMiOlsiX2FycmF5RnJvbUl0ZXJhdG9yIiwicmVxdWlyZSIsIl9pbmNsdWRlc1dpdGgiLCJfZnVuY3Rpb25OYW1lIiwiX2hhcyIsIl9vYmplY3RJcyIsImtleXMiLCJ0eXBlIiwiX3VuaXFDb250ZW50RXF1YWxzIiwiYUl0ZXJhdG9yIiwiYkl0ZXJhdG9yIiwic3RhY2tBIiwic3RhY2tCIiwiYSIsImIiLCJlcSIsIl9hIiwiX2IiLCJfZXF1YWxzIiwic2xpY2UiLCJhSXRlbSIsInR5cGVBIiwiZXF1YWxzIiwiY29uc3RydWN0b3IiLCJ2YWx1ZU9mIiwibmFtZSIsIm1lc3NhZ2UiLCJzb3VyY2UiLCJnbG9iYWwiLCJpZ25vcmVDYXNlIiwibXVsdGlsaW5lIiwic3RpY2t5IiwidW5pY29kZSIsImlkeCIsImxlbmd0aCIsInNpemUiLCJlbnRyaWVzIiwiY29uY2F0IiwidmFsdWVzIiwia2V5c0EiLCJleHRlbmRlZFN0YWNrQSIsImV4dGVuZGVkU3RhY2tCIiwia2V5IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsa0JBQWtCLEdBRXRCQyxPQUFPLENBQUMsc0JBQUQsQ0FGUDs7QUFJQSxJQUFJQyxhQUFhLEdBRWpCRCxPQUFPLENBQUMsaUJBQUQsQ0FGUDs7QUFJQSxJQUFJRSxhQUFhLEdBRWpCRixPQUFPLENBQUMsaUJBQUQsQ0FGUDs7QUFJQSxJQUFJRyxJQUFJLEdBRVJILE9BQU8sQ0FBQyxRQUFELENBRlA7O0FBSUEsSUFBSUksU0FBUyxHQUViSixPQUFPLENBQUMsYUFBRCxDQUZQOztBQUlBLElBQUlLLElBQUksR0FFUkwsT0FBTyxDQUFDLFNBQUQsQ0FGUDs7QUFJQSxJQUFJTSxJQUFJLEdBRVJOLE9BQU8sQ0FBQyxTQUFELENBRlA7O0FBZUEsU0FBU08sa0JBQVQsQ0FBNEJDLFNBQTVCLEVBQXVDQyxTQUF2QyxFQUFrREMsTUFBbEQsRUFBMERDLE1BQTFELEVBQWtFO0FBQ2hFLE1BQUlD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TSxDQUFDMEIsTUFBUCxDQUFjLENBQUN4QixDQUFELENBQWQsQ0FBckI7QUFDQSxNQUFJNEIsY0FBYyxHQUFHN0IsTUFBTSxDQUFDeUIsTUFBUCxDQUFjLENBQUN2QixDQUFELENBQWQsQ0FBckI7QUFDQW1CLEVBQUFBLEdBQUcsR0FBR00sS0FBSyxDQUFDTCxNQUFOLEdBQWUsQ0FBckI7O0FBRUEsU0FBT0QsR0FBRyxJQUFJLENBQWQsRUFBaUI7QUFDZixRQUFJUyxHQUFHLEdBQUdILEtBQUssQ0FBQ04sR0FBRCxDQUFmOztBQUVBLFFBQUksRUFBRTdCLElBQUksQ0FBQ3NDLEdBQUQsRUFBTTVCLENBQU4sQ0FBSixJQUFnQkksT0FBTyxDQUFDSixDQUFDLENBQUM0QixHQUFELENBQUYsRUFBUzdCLENBQUMsQ0FBQzZCLEdBQUQsQ0FBVixFQUFpQkYsY0FBakIsRUFBaUNDLGNBQWpDLENBQXpCLENBQUosRUFBZ0Y7QUFDOUUsYUFBTyxLQUFQO0FBQ0Q7O0FBRURSLElBQUFBLEdBQUcsSUFBSSxDQUFQO0FBQ0Q7O0FBRUQsU0FBTyxJQUFQO0FBQ0Q7O0FBRURVLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjFCLE9BQWpCIiwic291cmNlc0NvbnRlbnQiOlsidmFyIF9hcnJheUZyb21JdGVyYXRvciA9XG4vKiNfX1BVUkVfXyovXG5yZXF1aXJlKFwiLi9fYXJyYXlGcm9tSXRlcmF0b3JcIik7XG5cbnZhciBfaW5jbHVkZXNXaXRoID1cbi8qI19fUFVSRV9fKi9cbnJlcXVpcmUoXCIuL19pbmNsdWRlc1dpdGhcIik7XG5cbnZhciBfZnVuY3Rpb25OYW1lID1cbi8qI19fUFVSRV9fKi9cbnJlcXVpcmUoXCIuL19mdW5jdGlvbk5hbWVcIik7XG5cbnZhciBfaGFzID1cbi8qI19fUFVSRV9fKi9cbnJlcXVpcmUoXCIuL19oYXNcIik7XG5cbnZhciBfb2JqZWN0SXMgPVxuLyojX19QVVJFX18qL1xucmVxdWlyZShcIi4vX29iamVjdElzXCIpO1xuXG52YXIga2V5cyA9XG4vKiNfX1BVUkVfXyovXG5yZXF1aXJlKFwiLi4va2V5c1wiKTtcblxudmFyIHR5cGUgPVxuLyojX19QVVJFX18qL1xucmVxdWlyZShcIi4uL3R5cGVcIik7XG4vKipcbiAqIHByaXZhdGUgX3VuaXFDb250ZW50RXF1YWxzIGZ1bmN0aW9uLlxuICogVGhhdCBmdW5jdGlvbiBpcyBjaGVja2luZyBlcXVhbGl0eSBvZiAyIGl0ZXJhdG9yIGNvbnRlbnRzIHdpdGggMiBhc3N1bXB0aW9uc1xuICogLSBpdGVyYXRvcnMgbGVuZ3RocyBhcmUgdGhlIHNhbWVcbiAqIC0gaXRlcmF0b3JzIHZhbHVlcyBhcmUgdW5pcXVlXG4gKlxuICogZmFsc2UtcG9zaXRpdmUgcmVzdWx0IHdpbGwgYmUgcmV0dXJuZWQgZm9yIGNvbXBhcmlzaW9uIG9mLCBlLmcuXG4gKiAtIFsxLDIsM10gYW5kIFsxLDIsMyw0XVxuICogLSBbMSwxLDFdIGFuZCBbMSwyLDNdXG4gKiAqL1xuXG5cbmZ1bmN0aW9uIF91bmlxQ29udGVudEVxdWFscyhhSXRlcmF0b3IsIGJJdGVyYXRvciwgc3RhY2tBLCBzdGFja0IpIHtcbiAgdmFyIGEgPSBfYXJyYXlGcm9tSXRlcmF0b3IoYUl0ZXJhdG9yKTtcblxuICB2YXIgYiA9IF9hcnJheUZyb21JdGVyYXRvcihiSXRlcmF0b3IpO1xuXG4gIGZ1bmN0aW9uIGVxKF9hLCBfYikge1xuICAgIHJldHVybiBfZXF1YWxzKF9hLCBfYiwgc3RhY2tBLnNsaWNlKCksIHN0YWNrQi5zbGljZSgpKTtcbiAgfSAvLyBpZiAqYSogYXJyYXkgY29udGFpbnMgYW55IGVsZW1lbnQgdGhhdCBpcyBub3QgaW5jbHVkZWQgaW4gKmIqXG5cblxuICByZXR1cm4gIV9pbmNsdWRlc1dpdGgoZnVuY3Rpb24gKGIsIGFJdGVtKSB7XG4gICAgcmV0dXJuICFfaW5jbHVkZXNXaXRoKGVxLCBhSXRlbSwgYik7XG4gIH0sIGIsIGEpO1xufVxuXG5mdW5jdGlvbiBfZXF1YWxzKGEsIGIsIHN0YWNrQSwgc3RhY2tCKSB7XG4gIGlmIChfb2JqZWN0SXMoYSwgYikpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHZhciB0eXBlQSA9IHR5cGUoYSk7XG5cbiAgaWYgKHR5cGVBICE9PSB0eXBlKGIpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYgKGEgPT0gbnVsbCB8fCBiID09IG51bGwpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAodHlwZW9mIGFbJ2ZhbnRhc3ktbGFuZC9lcXVhbHMnXSA9PT0gJ2Z1bmN0aW9uJyB8fCB0eXBlb2YgYlsnZmFudGFzeS1sYW5kL2VxdWFscyddID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBhWydmYW50YXN5LWxhbmQvZXF1YWxzJ10gPT09ICdmdW5jdGlvbicgJiYgYVsnZmFudGFzeS1sYW5kL2VxdWFscyddKGIpICYmIHR5cGVvZiBiWydmYW50YXN5LWxhbmQvZXF1YWxzJ10gPT09ICdmdW5jdGlvbicgJiYgYlsnZmFudGFzeS1sYW5kL2VxdWFscyddKGEpO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBhLmVxdWFscyA9PT0gJ2Z1bmN0aW9uJyB8fCB0eXBlb2YgYi5lcXVhbHMgPT09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gdHlwZW9mIGEuZXF1YWxzID09PSAnZnVuY3Rpb24nICYmIGEuZXF1YWxzKGIpICYmIHR5cGVvZiBiLmVxdWFscyA9PT0gJ2Z1bmN0aW9uJyAmJiBiLmVxdWFscyhhKTtcbiAgfVxuXG4gIHN3aXRjaCAodHlwZUEpIHtcbiAgICBjYXNlICdBcmd1bWVudHMnOlxuICAgIGNhc2UgJ0FycmF5JzpcbiAgICBjYXNlICdPYmplY3QnOlxuICAgICAgaWYgKHR5cGVvZiBhLmNvbnN0cnVjdG9yID09PSAnZnVuY3Rpb24nICYmIF9mdW5jdGlvbk5hbWUoYS5jb25zdHJ1Y3RvcikgPT09ICdQcm9taXNlJykge1xuICAgICAgICByZXR1cm4gYSA9PT0gYjtcbiAgICAgIH1cblxuICAgICAgYnJlYWs7XG5cbiAgICBjYXNlICdCb29sZWFuJzpcbiAgICBjYXNlICdOdW1iZXInOlxuICAgIGNhc2UgJ1N0cmluZyc6XG4gICAgICBpZiAoISh0eXBlb2YgYSA9PT0gdHlwZW9mIGIgJiYgX29iamVjdElzKGEudmFsdWVPZigpLCBiLnZhbHVlT2YoKSkpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgYnJlYWs7XG5cbiAgICBjYXNlICdEYXRlJzpcbiAgICAgIGlmICghX29iamVjdElzKGEudmFsdWVPZigpLCBiLnZhbHVlT2YoKSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBicmVhaztcblxuICAgIGNhc2UgJ0Vycm9yJzpcbiAgICAgIHJldHVybiBhLm5hbWUgPT09IGIubmFtZSAmJiBhLm1lc3NhZ2UgPT09IGIubWVzc2FnZTtcblxuICAgIGNhc2UgJ1JlZ0V4cCc6XG4gICAgICBpZiAoIShhLnNvdXJjZSA9PT0gYi5zb3VyY2UgJiYgYS5nbG9iYWwgPT09IGIuZ2xvYmFsICYmIGEuaWdub3JlQ2FzZSA9PT0gYi5pZ25vcmVDYXNlICYmIGEubXVsdGlsaW5lID09PSBiLm11bHRpbGluZSAmJiBhLnN0aWNreSA9PT0gYi5zdGlja3kgJiYgYS51bmljb2RlID09PSBiLnVuaWNvZGUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgYnJlYWs7XG4gIH1cblxuICB2YXIgaWR4ID0gc3RhY2tBLmxlbmd0aCAtIDE7XG5cbiAgd2hpbGUgKGlkeCA+PSAwKSB7XG4gICAgaWYgKHN0YWNrQVtpZHhdID09PSBhKSB7XG4gICAgICByZXR1cm4gc3RhY2tCW2lkeF0gPT09IGI7XG4gICAgfVxuXG4gICAgaWR4IC09IDE7XG4gIH1cblxuICBzd2l0Y2ggKHR5cGVBKSB7XG4gICAgY2FzZSAnTWFwJzpcbiAgICAgIGlmIChhLnNpemUgIT09IGIuc2l6ZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBfdW5pcUNvbnRlbnRFcXVhbHMoYS5lbnRyaWVzKCksIGIuZW50cmllcygpLCBzdGFja0EuY29uY2F0KFthXSksIHN0YWNrQi5jb25jYXQoW2JdKSk7XG5cbiAgICBjYXNlICdTZXQnOlxuICAgICAgaWYgKGEuc2l6ZSAhPT0gYi5zaXplKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIF91bmlxQ29udGVudEVxdWFscyhhLnZhbHVlcygpLCBiLnZhbHVlcygpLCBzdGFja0EuY29uY2F0KFthXSksIHN0YWNrQi5jb25jYXQoW2JdKSk7XG5cbiAgICBjYXNlICdBcmd1bWVudHMnOlxuICAgIGNhc2UgJ0FycmF5JzpcbiAgICBjYXNlICdPYmplY3QnOlxuICAgIGNhc2UgJ0Jvb2xlYW4nOlxuICAgIGNhc2UgJ051bWJlcic6XG4gICAgY2FzZSAnU3RyaW5nJzpcbiAgICBjYXNlICdEYXRlJzpcbiAgICBjYXNlICdFcnJvcic6XG4gICAgY2FzZSAnUmVnRXhwJzpcbiAgICBjYXNlICdJbnQ4QXJyYXknOlxuICAgIGNhc2UgJ1VpbnQ4QXJyYXknOlxuICAgIGNhc2UgJ1VpbnQ4Q2xhbXBlZEFycmF5JzpcbiAgICBjYXNlICdJbnQxNkFycmF5JzpcbiAgICBjYXNlICdVaW50MTZBcnJheSc6XG4gICAgY2FzZSAnSW50MzJBcnJheSc6XG4gICAgY2FzZSAnVWludDMyQXJyYXknOlxuICAgIGNhc2UgJ0Zsb2F0MzJBcnJheSc6XG4gICAgY2FzZSAnRmxvYXQ2NEFycmF5JzpcbiAgICBjYXNlICdBcnJheUJ1ZmZlcic6XG4gICAgICBicmVhaztcblxuICAgIGRlZmF1bHQ6XG4gICAgICAvLyBWYWx1ZXMgb2Ygb3RoZXIgdHlwZXMgYXJlIG9ubHkgZXF1YWwgaWYgaWRlbnRpY2FsLlxuICAgICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgdmFyIGtleXNBID0ga2V5cyhhKTtcblxuICBpZiAoa2V5c0EubGVuZ3RoICE9PSBrZXlzKGIpLmxlbmd0aCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciBleHRlbmRlZFN0YWNrQSA9IHN0YWNrQS5jb25jYXQoW2FdKTtcbiAgdmFyIGV4dGVuZGVkU3RhY2tCID0gc3RhY2tCLmNvbmNhdChbYl0pO1xuICBpZHggPSBrZXlzQS5sZW5ndGggLSAxO1xuXG4gIHdoaWxlIChpZHggPj0gMCkge1xuICAgIHZhciBrZXkgPSBrZXlzQVtpZHhdO1xuXG4gICAgaWYgKCEoX2hhcyhrZXksIGIpICYmIF9lcXVhbHMoYltrZXldLCBhW2tleV0sIGV4dGVuZGVkU3RhY2tBLCBleHRlbmRlZFN0YWNrQikpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWR4IC09IDE7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBfZXF1YWxzOyJdfQ==